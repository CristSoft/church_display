// church_display/app.py
from flask import Flask, render_template, send_from_directory, request
from flask_socketio import SocketIO, emit
import os

# Configurar Flask para servir la carpeta 'assets' como est√°tica
app = Flask(__name__, static_url_path='', static_folder='assets')
socketio = SocketIO(app, cors_allowed_origins="*", logger=True, engineio_logger=True)

# Restaurar la ruta personalizada para assets
@app.route('/assets/<path:filename>')
def assets(filename):
    print(f"[DEPURACI√ìN] Solicitando asset: {filename}")
    return send_from_directory('assets', filename)

@app.route('/css/<path:filename>')
def css(filename):
    print(f"[DEPURACI√ìN] Solicitando CSS: {filename}")
    return send_from_directory('src/css', filename)

@app.route('/src/js/<path:filename>')
def js(filename):
    print(f"[DEPURACI√ìN] Solicitando JS: {filename}")
    return send_from_directory('src/js', filename)

@app.route('/src/assets/<path:filename>')
def src_assets(filename):
    print(f"[DEPURACI√ìN] Solicitando src/assets: {filename}")
    return send_from_directory('src/assets', filename)

@app.route('/')
def control():
    return send_from_directory('.', 'index.html')

@app.route('/proyector')
def proyector():
    return send_from_directory('.', 'src/proyector.html')

@app.route('/proyector.html')
def proyector_html_redirect():
    return '', 301, {'Location': '/proyector'}

@app.route('/test_socketio.html')
def test_socketio():
    return send_from_directory('.', 'test_socketio.html')

@app.route('/diagnostico.html')
def diagnostico():
    return send_from_directory('.', 'diagnostico.html')

@app.route('/test_simple.html')
def test_simple():
    return send_from_directory('.', 'test_simple.html')

@app.route('/test_audio.html')
def test_audio():
    return send_from_directory('.', 'test_audio.html')

@app.route('/diagnostico_himnario.html')
def diagnostico_himnario():
    return send_from_directory('.', 'diagnostico_himnario.html')

@app.route('/test_fadeout.html')
def test_fadeout():
    return send_from_directory('.', 'test_fadeout.html')

@app.route('/test_audio_auto.html')
def test_audio_auto():
    return send_from_directory('.', 'test_audio_auto.html')

proyector_abierto = False  # Estado global del proyector

# Eventos de SocketIO
@socketio.on('connect')
def handle_connect():
    print(f'‚úÖ Cliente conectado: {request.sid}')
    # Enviar el estado actual del proyector al nuevo cliente
    emit('estadoProyector', {'abierto': proyector_abierto})

@socketio.on('disconnect')
def handle_disconnect():
    print(f'‚ùå Cliente desconectado: {request.sid}')

@socketio.on('update_text')
def on_update_text(data):
    print(f'üì§ Recibido update_text: {data}')
    # Reenviar a todos los clientes del proyector
    emit('update_text', data, broadcast=True, include_self=False)

@socketio.on('change_mode')
def on_change_mode(data):
    print(f'üì§ Recibido change_mode: {data}')
    # Reenviar a todos los clientes del proyector
    emit('change_mode', data, broadcast=True, include_self=False)

@socketio.on('config')
def on_config(data):
    print(f'üì§ Recibido config: {data}')
    # Reenviar a todos los clientes del proyector
    emit('config', data, broadcast=True, include_self=False)

@socketio.on('reproducirAudio')
def on_reproducir_audio(data):
    print(f'üì§ Recibido reproducirAudio: {data}')
    # Reenviar a todos los clientes del proyector
    emit('reproducirAudio', data, broadcast=True, include_self=False)

@socketio.on('detenerAudio')
def on_detener_audio(data):
    print(f'üì§ Recibido detenerAudio: {data}')
    # Reenviar a todos los clientes del proyector
    emit('detenerAudio', data, broadcast=True, include_self=False)

@socketio.on('audioTerminado')
def on_audio_terminado(data):
    print(f'üì§ Recibido audioTerminado: {data}')
    # Reenviar a todos los clientes del panel de control
    emit('audioTerminado', data, broadcast=True, include_self=False)

# --- NUEVO: Reenviar proyectorClick a todos los clientes ---
@socketio.on('proyectorClick')
def on_proyector_click():
    print(f'üì§ Recibido proyectorClick (reenviando a todos los clientes)')
    emit('proyectorClick', broadcast=True, include_self=False)

# --- NUEVO: Reenviar proyectorAbierto y proyectorCerrado a todos los clientes ---
@socketio.on('proyectorAbierto')
def on_proyector_abierto():
    global proyector_abierto
    proyector_abierto = True
    print(f'üì§ Recibido proyectorAbierto (reenviando a todos los clientes)')
    emit('proyectorAbierto', broadcast=True)  # include_self=True por defecto

@socketio.on('proyectorCerrado')
def on_proyector_cerrado():
    global proyector_abierto
    proyector_abierto = False
    print(f'üì§ Recibido proyectorCerrado (reenviando a todos los clientes)')
    emit('proyectorCerrado', broadcast=True)  # include_self=True por defecto

if __name__ == '__main__':
    print("üöÄ Iniciando servidor Flask-SocketIO para Church Display...")
    print("üì± Panel de control: http://localhost:8080/")
    print("üñ•Ô∏è  Ventana de proyecci√≥n: http://localhost:8080/proyector")
    print("üß™ Test SocketIO: http://localhost:8080/test_socketio.html")
    print("üîç Diagn√≥stico: http://localhost:8080/diagnostico.html")
    print("üß™ Test Simple: http://localhost:8080/test_simple.html")
    print("üéµ Test Audio: http://localhost:8080/test_audio.html")
    print("üîç Diagn√≥stico Himnario: http://localhost:8080/diagnostico_himnario.html")
    print("üéû Test Fadeout: http://localhost:8080/test_fadeout.html")
    print("üîä Test Audio Autom√°tico: http://localhost:8080/test_audio_auto.html")
    print("‚èπÔ∏è  Presiona Ctrl+C para detener el servidor")
    print("-" * 50)
    
    socketio.run(app, host='0.0.0.0', port=8080, debug=True) 



// church_display/herramientas\generador de himnario\txt-2-json.py
import json
import re
import os

def dividir_texto_por_caracteres(lineas_originales, max_chars):
    """
    Toma una lista de l√≠neas de texto y las agrupa en secciones
    sin exceder un n√∫mero m√°ximo de caracteres por secci√≥n.
    """
    if not lineas_originales:
        return []

    secciones_finales = []
    seccion_actual = []
    caracteres_actuales = 0

    for linea in lineas_originales:
        longitud_linea = len(linea)
        
        # Si la secci√≥n est√° vac√≠a, siempre a√±adimos la primera l√≠nea.
        if not seccion_actual:
            seccion_actual.append(linea)
            caracteres_actuales += longitud_linea
        # Si a√±adir la nueva l√≠nea excede el l√≠mite, cerramos la secci√≥n actual.
        elif caracteres_actuales + longitud_linea > max_chars:
            secciones_finales.append(seccion_actual)
            # Y empezamos una nueva secci√≥n con la l√≠nea actual.
            seccion_actual = [linea]
            caracteres_actuales = longitud_linea
        # Si cabe, la a√±adimos a la secci√≥n actual.
        else:
            seccion_actual.append(linea)
            caracteres_actuales += longitud_linea
            
    # No olvidar a√±adir la √∫ltima secci√≥n que qued√≥ abierta.
    if seccion_actual:
        secciones_finales.append(seccion_actual)
        
    return secciones_finales

def convertir_himno_txt_to_json(archivo_entrada, archivo_salida, max_chars_por_seccion=60):
    """
    Convierte un √∫nico archivo TXT de un himno, agrupando por caracteres.
    """
    try:
        with open(archivo_entrada, 'r', encoding='utf-8') as f:
            lineas = f.readlines()
    except FileNotFoundError:
        print(f"Error: El archivo de entrada '{archivo_entrada}' no fue encontrado.")
        return

    lineas = [linea.strip() for linea in lineas if linea.strip()]
    if not lineas:
        print(f"Aviso: El archivo '{archivo_entrada}' est√° vac√≠o. Omitiendo.")
        return

    titulo = lineas.pop(0)
    estrofas, coro_lines = {}, []
    parte_actual = None

    for linea in lineas:
        if re.match(r'^\d+$', linea):
            parte_actual = linea
            estrofas[parte_actual] = []
        elif linea.lower().startswith('coro'):
            parte_actual = "coro"
        elif parte_actual:
            if parte_actual == "coro": coro_lines.append(linea)
            else: estrofas[parte_actual].append(linea)

    datos_json = {"title": titulo, "sections": {}}
    contador_seccion = 1
    
    for numero_estrofa in sorted(estrofas.keys(), key=int):
        # Procesar estrofa
        secciones_estrofa = dividir_texto_por_caracteres(estrofas[numero_estrofa], max_chars_por_seccion)
        for texto_seccion in secciones_estrofa:
            datos_json["sections"][str(contador_seccion)] = {"verse": numero_estrofa, "text": texto_seccion}
            contador_seccion += 1

        # Procesar coro si existe
        if coro_lines:
            secciones_coro = dividir_texto_por_caracteres(coro_lines, max_chars_por_seccion)
            for texto_seccion in secciones_coro:
                datos_json["sections"][str(contador_seccion)] = {"verse": "coro", "text": texto_seccion}
                contador_seccion += 1

    with open(archivo_salida, 'w', encoding='utf-8') as f:
        json.dump(datos_json, f, indent=2, ensure_ascii=False)

def procesar_carpeta(carpeta_entrada, carpeta_salida, max_chars_por_seccion=60):
    """Funci√≥n principal que procesa todos los archivos .txt de una carpeta."""
    if not os.path.isdir(carpeta_entrada):
        print(f"Error: La carpeta de entrada '{carpeta_entrada}' no existe.")
        return

    os.makedirs(carpeta_salida, exist_ok=True)
    archivos_txt = [f for f in os.listdir(carpeta_entrada) if f.lower().endswith('.txt')]

    if not archivos_txt:
        print(f"No se encontraron archivos .txt en la carpeta '{carpeta_entrada}'.")
        return

    print(f"Iniciando conversi√≥n de {len(archivos_txt)} himnos...")
    
    for nombre_archivo in archivos_txt:
        ruta_entrada = os.path.join(carpeta_entrada, nombre_archivo)
        nombre_base = os.path.splitext(nombre_archivo)[0]
        ruta_salida = os.path.join(carpeta_salida, f"{nombre_base}.json")
        
        print(f"  - Convirtiendo: '{nombre_archivo}' -> '{nombre_base}.json'")
        convertir_himno_txt_to_json(ruta_entrada, ruta_salida, max_chars_por_seccion)
    
    print("\n--- Proceso completado ---")
    print(f"Todos los archivos han sido guardados en la carpeta '{carpeta_salida}'.")

# --- INSTRUCCIONES DE USO ---
if __name__ == "__main__":
    carpeta_entrada = "himnario-txt"
    carpeta_salida = "himnario-json"
    
    # ¬°AJUSTA ESTE VALOR!
    # L√≠mite de caracteres por secci√≥n. Un valor entre 55-65 funciona bien
    # para agrupar l√≠neas cortas de a dos, y dejar las largas solas.
    max_caracteres = 60

    procesar_carpeta(carpeta_entrada, carpeta_salida, max_caracteres)



// church_display/herramientas\generar_indice_himnos.py
#!/usr/bin/env python3
"""
Script para generar autom√°ticamente el √≠ndice de himnos
bas√°ndose en los archivos JSON disponibles en assets/himnos/letra/
"""

import os
import json
import re
from pathlib import Path

def extraer_info_himno(nombre_archivo):
    """Extrae n√∫mero y t√≠tulo del nombre del archivo"""
    # Patr√≥n: "001 - Cantad alegres al Se√±or.json"
    match = re.match(r'^(\d+)\s*-\s*(.+)\.json$', nombre_archivo)
    if match:
        numero = match.group(1).zfill(3)  # Rellenar con ceros a la izquierda
        titulo = match.group(2).strip()
        return numero, titulo
    return None, None

def leer_titulo_desde_json(ruta_archivo):
    """Lee el t√≠tulo desde el archivo JSON"""
    try:
        with open(ruta_archivo, 'r', encoding='utf-8') as f:
            data = json.load(f)
            return data.get('title', '')
    except Exception as e:
        print(f"Error al leer {ruta_archivo}: {e}")
        return None

def generar_indice_himnos():
    """Genera el √≠ndice de himnos bas√°ndose en los archivos disponibles"""
    
    # Ruta a los archivos de himnos
    ruta_himnos = Path("assets/himnos/letra")
    
    if not ruta_himnos.exists():
        print(f"Error: No se encontr√≥ el directorio {ruta_himnos}")
        return
    
    himnos = []
    
    # Obtener todos los archivos JSON
    archivos_json = list(ruta_himnos.glob("*.json"))
    archivos_json.sort()  # Ordenar alfab√©ticamente
    
    print(f"Encontrados {len(archivos_json)} archivos de himnos")
    
    for archivo in archivos_json:
        nombre_archivo = archivo.name
        
        # Extraer informaci√≥n del nombre del archivo
        numero, titulo = extraer_info_himno(nombre_archivo)
        
        if numero and titulo:
            # Intentar leer el t√≠tulo desde el JSON para verificar
            titulo_json = leer_titulo_desde_json(archivo)
            
            # Usar el t√≠tulo del JSON si est√° disponible, sino usar el del nombre del archivo
            titulo_final = titulo_json if titulo_json else titulo
            
            himno = {
                "number": numero,
                "title": titulo_final,
                "file": nombre_archivo
            }
            
            himnos.append(himno)
            print(f"  {numero}: {titulo_final}")
        else:
            print(f"  ‚ö†Ô∏è  No se pudo procesar: {nombre_archivo}")
    
    # Ordenar por n√∫mero
    himnos.sort(key=lambda x: int(x["number"]))
    
    # Generar el c√≥digo JavaScript
    codigo_js = """/**
 * Obtiene el √≠ndice de himnos disponibles.
 * @returns {Promise<Array<{number: string, title: string, file: string}>>}
 */
export async function getHymnIndex() {
  try {
    // √çndice generado autom√°ticamente
    const himnos = [
"""
    
    for himno in himnos:
        codigo_js += f'      {{ number: "{himno["number"]}", title: "{himno["title"]}", file: "{himno["file"]}" }},\n'
    
    codigo_js += """    ];
    
    console.log(`√çndice de himnos cargado: ${himnos.length} himnos`);
    return himnos;
  } catch (err) {
    console.error('Error al obtener el √≠ndice de himnos:', err);
    return [];
  }
}
"""
    
    # Guardar el c√≥digo en un archivo temporal
    with open("indice_himnos_generado.js", "w", encoding="utf-8") as f:
        f.write(codigo_js)
    
    print(f"\n‚úÖ √çndice generado con {len(himnos)} himnos")
    print("üìÅ Archivo generado: indice_himnos_generado.js")
    print("\nPara usar este √≠ndice:")
    print("1. Copia el contenido de indice_himnos_generado.js")
    print("2. Reemplaza la funci√≥n getHymnIndex() en js/dataManager.js")
    
    # Tambi√©n generar un JSON para referencia
    with open("indice_himnos.json", "w", encoding="utf-8") as f:
        json.dump(himnos, f, indent=2, ensure_ascii=False)
    
    print("üìÅ Archivo JSON generado: indice_himnos.json")

if __name__ == "__main__":
    generar_indice_himnos() 



// church_display/herramientas\generar_lista_biblias.py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Script para generar autom√°ticamente la lista de biblias disponibles
Escanea la carpeta assets/biblias y genera el archivo biblias-disponibles.json
"""

import os
import json
import glob

def generar_lista_biblias():
    """Genera la lista de biblias disponibles en assets/biblias"""
    
    # Ruta de la carpeta de biblias
    carpeta_biblias = "assets/biblias"
    
    # Verificar que la carpeta existe
    if not os.path.exists(carpeta_biblias):
        print(f"Error: La carpeta {carpeta_biblias} no existe")
        return
    
    # Buscar todos los archivos XML
    archivos_xml = glob.glob(os.path.join(carpeta_biblias, "*.xml"))
    
    if not archivos_xml:
        print(f"No se encontraron archivos XML en {carpeta_biblias}")
        return
    
    # Obtener solo los nombres de archivo (sin la ruta)
    nombres_archivos = [os.path.basename(archivo) for archivo in archivos_xml]
    
    # Diccionario de descripciones conocidas
    descripciones = {
        "es-DHH.xml": "Dios Habla Hoy",
        "es-NTV.xml": "Nueva Traducci√≥n Viviente", 
        "es-rv2015.xml": "Reina Valera 2015",
        "es-rv2020.xml": "Reina Valera 2020",
        "es-rv60.xml": "Reina Valera 1960",
        "rv2020_apocalipsis.xml": "Reina Valera 2020 - Apocalipsis",
        "rv2020_genesis_mateo.xml": "Reina Valera 2020 - G√©nesis y Mateo"
    }
    
    # Crear el objeto de datos
    datos = {
        "biblias": sorted(nombres_archivos),
        "descripciones": {}
    }
    
    # Agregar descripciones para archivos conocidos
    for archivo in nombres_archivos:
        if archivo in descripciones:
            datos["descripciones"][archivo] = descripciones[archivo]
        else:
            # Para archivos no conocidos, usar el nombre sin extensi√≥n
            datos["descripciones"][archivo] = archivo.replace('.xml', '')
    
    # Ruta del archivo de salida
    archivo_salida = os.path.join(carpeta_biblias, "biblias-disponibles.json")
    
    # Escribir el archivo JSON
    try:
        with open(archivo_salida, 'w', encoding='utf-8') as f:
            json.dump(datos, f, indent=2, ensure_ascii=False)
        
        print(f"Archivo generado exitosamente: {archivo_salida}")
        print(f"Biblias encontradas: {len(nombres_archivos)}")
        print("Lista de biblias:")
        for archivo in sorted(nombres_archivos):
            desc = datos["descripciones"][archivo]
            print(f"  - {archivo} -> {desc}")
            
    except Exception as e:
        print(f"Error al escribir el archivo: {e}")

if __name__ == "__main__":
    generar_lista_biblias() 



// church_display/index.html
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#181c20">
    <title>Church Display - Control</title>
    <link rel="stylesheet" href="/css/style.css">
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.1/socket.io.min.js"></script>
    
</head>
<body>
    <!-- Top Bar Sticky -->
    <div id="topBar">
      <span id="topBarTitulo">Biblia</span>
      <button id="btnCambiarVista" class="btn-cambiar-vista">
        <i class="fa-solid fa-list"></i>
        <span class="btn-cambiar-vista-text">Lista</span>
      </button>
    </div>
    
    <button id="abrirProyector" class="btn-abrir-proyector proyector-normal">Abrir Ventana de Proyecci√≥n</button>
    <!-- Script para deshabilitar el bot√≥n en m√≥viles -->
    <!--
    <script>
      // Deshabilitar el bot√≥n en m√≥viles solo visualmente (sin usar 'disabled')
      function esDispositivoMovil() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
      }
      document.addEventListener('DOMContentLoaded', function() {
        if (esDispositivoMovil()) {
          var btn = document.getElementById('abrirProyector');
          // btn.disabled = true; // Eliminado: solo CSS
          btn.style.opacity = '0.6';
          btn.style.filter = 'grayscale(0.5)';
          btn.style.cursor = 'not-allowed';
          btn.title = 'No disponible en dispositivos m√≥viles';
          btn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            return false;
          }, true);
        }
      });
    </script>
    -->
    <!-- Modal de configuraci√≥n -->
    <div id="configModal">
      <div class="config-modal-content">
        <button id="cerrarConfig" class="btn-cerrar-config">&times;</button>
        <h2 class="config-titulo">Configuraci√≥n</h2>
        <div id="sliderFontBibliaContainer" class="slider-font-biblia-container">
          <label for="sliderFontsizeBiblia">Tama√±o de fuente vers√≠culos (Biblia):</label><br>
          <input type="range" id="sliderFontsizeBiblia" min="1.5" max="8" step="0.1" value="5">
          <span id="fontsizeValueBiblia">5vw</span>
        </div>
        <div id="sliderFontHimnarioContainer" class="slider-font-himnario-container">
          <label for="sliderFontsizeHimnario">Tama√±o de fuente himnos (Himnario):</label><br>
          <input type="range" id="sliderFontsizeHimnario" min="2" max="10" step="0.1" value="5">
          <span id="fontsizeValueHimnario">5vw</span>
        </div>
        <div id="opcionSoloReferencia" class="opcion-solo-referencia">
          <label for="switchSoloReferencia">Solo mostrar referencia b√≠blica (modo Biblia):</label>
          <input type="checkbox" id="switchSoloReferencia">
        </div>

      </div>
    </div>
    <hr>
    <!-- Switch para Biblia/Himnario -->
    <!-- <div class="switch-container">
      <label class="switch-label" for="modoSwitch">Himnario</label>
      <input type="checkbox" id="modoSwitch" class="switch-input">
      <span class="slider"></span>
      <label class="switch-label" for="modoSwitch">Biblia</label>
    </div> -->

    <!-- FOOT NAVBAR estilo web app -->
    <nav id="footNavbar" class="foot-navbar">
      <button id="navHimnario" class="nav-btn nav-himnario" title="Himnario">
        <i class="fa-solid fa-music"></i>
        <span class="nav-btn-text">Himnario</span>
      </button>
      <button id="navBiblia" class="nav-btn nav-biblia" title="Biblia">
        <i class="fa-solid fa-book"></i>
        <span class="nav-btn-text">Biblia</span>
      </button>
      <button id="navConfig" class="nav-btn nav-config" title="Configuraci√≥n">
        <i class="fa-solid fa-cog"></i>
        <span class="nav-btn-text">Config</span>
      </button>
    </nav>

    <!-- Contenedor para la Biblia -->
    <div id="controlBiblia">
        <select id="versionBiblia"></select>
        <input type="text" id="buscarLibro" placeholder="Escribe un libro...">
        <div id="sugerenciasLibros"></div>
        <div class="grilla-label">Cap√≠tulos</div>
        <div id="grillaCapitulos"></div>
        <div class="grilla-label">Vers√≠culos</div>
        <div id="grillaVersiculos"></div>
    </div>

    <!-- Contenedor para el Himnario -->
    <div id="controlHimnario" style="display:none;">
        <input type="text" id="buscarHimno" placeholder="N¬∫ o T√≠tulo del himno...">
        <div id="listaHimnos"></div>
    </div>
    
    <!-- √Årea de vista previa -->
    <div id="vistaPreviaContainer">
      <div id="vistaPrevia" style="display:block;"></div>
      <div id="vistaProyector" class="mini-proyector mini-proyector-margin" style="display:none;width:100%;margin:0 auto;position:relative;background:#181c20;border-radius:12px;box-shadow:0 4px 24px #000a;overflow:hidden;display:flex;align-items:center;justify-content:center;">
        <video id="miniProyectorVideo" class="mini-proyector-video" autoplay loop muted playsinline style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:0;"></video>
        <div id="zonaRetroceder" style="position:absolute;left:0;top:0;width:50%;height:100%;cursor:pointer;z-index:2;"></div>
        <div id="zonaAvanzar" style="position:absolute;right:0;top:0;width:50%;height:100%;cursor:pointer;z-index:2;"></div>
        <div id="proyectorPreviewContent" class="mini-proyector-content" style="width:100%;text-align:center;padding:2em;font-size:2.5em;color:#fff;z-index:1;user-select:none;position:relative;"></div>
      </div>
      <button id="playHimnoMiniProyector" style="display:none;margin: 1.2em auto 0 auto; width: 90%; max-width: 340px; font-size: 1.3em; background: #28a745; color: #fff; border: none; border-radius: 8px; padding: 0.7em 0; box-shadow: 0 2px 8px #0003; cursor: pointer; transition: background 0.2s;">‚ñ∂Ô∏è Reproducir Himno</button>
    </div>

    <!-- Reproductor de audio para himnos -->
    <audio id="reproductorAudio" controls></audio>

    <footer id="botoneraNavegacion" class="botonera-navegacion" style="display:none;">
      <button id="anterior" class="btn-control">
        <i class="fa-solid fa-arrow-left"></i>
        <span class="btn-control-text">Anterior</span>
      </button>
      <button id="playHimnoFooter" style="display:none;">
        <i class="fa-solid fa-play"></i>
        <span class="btn-control-text">Play</span>
      </button>
      <button id="siguiente" class="btn-control">
        <span class="btn-control-text">Siguiente</span>
        <i class="fa-solid fa-arrow-right"></i>
      </button>
    </footer>

    <script src="/src/js/dataManager.js"></script>
    <script src="/src/js/main.js"></script>
    
    <!-- Script de prueba temporal -->
    <script>
        console.log('üöÄ Script de prueba iniciado');
        console.log('üì± URL actual:', window.location.href);
        console.log('üîå SocketIO disponible:', typeof io !== 'undefined' ? 'S√≠' : 'No');
        
        // Verificar si main.js se carg√≥ correctamente
        setTimeout(() => {
            console.log('üîç Verificando carga de main.js...');
            console.log('üîå Socket global:', typeof window.socket !== 'undefined' ? 'Existe' : 'No existe');
            console.log('üîå Socket conectado:', typeof window.socket !== 'undefined' && window.socket ? window.socket.connected : 'N/A');
            
            // Verificar si el bot√≥n de prueba existe
            const btnPrueba = document.getElementById('btnPrueba');
            console.log('üß™ Bot√≥n de prueba:', btnPrueba ? 'Existe' : 'No existe');
            
            if (btnPrueba) {
                console.log('üß™ Agregando evento de prueba directo...');
                btnPrueba.addEventListener('click', function() {
                    console.log('üß™ Bot√≥n clickeado (evento directo)');
                    console.log('üîç Estado del socket:', {
                        existe: typeof window.socket !== 'undefined',
                        socket: window.socket,
                        conectado: window.socket ? window.socket.connected : 'N/A'
                    });
                    
                    if (typeof window.socket !== 'undefined' && window.socket && window.socket.connected) {
                        console.log('‚úÖ Socket disponible, enviando mensaje...');
                        window.socket.emit('update_text', {
                            texto: 'üß™ Prueba directa desde HTML',
                            ref: 'Test Directo - ' + new Date().toLocaleTimeString(),
                            soloReferencia: false
                        });
                        console.log('‚úÖ Mensaje enviado (evento directo)');
                        this.textContent = '‚úÖ Enviado!';
                        this.style.background = '#28a745';
                        setTimeout(() => {
                            this.textContent = 'üß™ Probar SocketIO';
                            this.style.background = '#28a745';
                        }, 2000);
                    } else {
                        console.log('‚ùå Socket no disponible (evento directo)');
                        console.log('üîç Detalles del error:', {
                            socketDefinido: typeof window.socket !== 'undefined',
                            socketValor: window.socket,
                            conectado: window.socket ? window.socket.connected : 'N/A'
                        });
                        this.textContent = '‚ùå Error!';
                        this.style.background = '#dc3545';
                        setTimeout(() => {
                            this.textContent = 'üß™ Probar SocketIO';
                            this.style.background = '#28a745';
                        }, 2000);
                    }
                });
                console.log('‚úÖ Evento agregado al bot√≥n');
            } else {
                console.log('‚ùå No se encontr√≥ el bot√≥n de prueba');
            }
        }, 3000); // Aumentamos el tiempo para dar m√°s tiempo a que cargue main.js
    </script>

    <!-- --- ABRIR PROYECTOR EN SEGUNDA PANTALLA Y PANTALLA COMPLETA --- -->
    <script>
    document.getElementById('abrirProyector').addEventListener('click', async function() {
        const proyectorUrl = 'src/proyector.html';
        let features = 'toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=yes';
        let width = window.screen.width;
        let height = window.screen.height;
        let left = 0;
        let top = 0;

        // Intentar usar la Screen Enumeration API si est√° disponible
        if (navigator.getScreens && window.getScreenDetails) {
            try {
                const screens = await window.getScreenDetails();
                if (screens.screens && screens.screens.length > 1) {
                    // Buscar la pantalla secundaria (que no sea la actual)
                    const currentScreen = screens.currentScreen;
                    const secondary = screens.screens.find(s => s !== currentScreen);
                    if (secondary) {
                        width = secondary.width;
                        height = secondary.height;
                        left = secondary.availLeft || secondary.left || 0;
                        top = secondary.availTop || secondary.top || 0;
                    }
                }
            } catch (e) {
                // Si falla, usar la pantalla principal
            }
        } else if (window.screen && window.screen.availWidth && window.screen.availHeight) {
            // Fallback: usar la pantalla principal
            width = window.screen.availWidth;
            height = window.screen.availHeight;
            left = window.screen.availLeft || 0;
            top = window.screen.availTop || 0;
        }

        features += `,width=${width},height=${height},left=${left},top=${top}`;

        // Abrir la ventana del proyector
        const win = window.open(proyectorUrl, 'proyector', features);
        if (win) {
            win.focus();
            // Intentar pantalla completa al cargar
            win.onload = function() {
                if (win.document && win.document.documentElement && win.document.documentElement.requestFullscreen) {
                    win.document.documentElement.requestFullscreen();
                } else if (win.document && win.document.body && win.document.body.requestFullscreen) {
                    win.document.body.requestFullscreen();
                }
            };
        } else {
            alert('No se pudo abrir la ventana del proyector. Por favor, permite los popups.');
        }
    });
    </script>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // --- L√ìGICA FOOT NAVBAR ---
        const navHimnario = document.getElementById('navHimnario');
        const navBiblia = document.getElementById('navBiblia');
        const navConfig = document.getElementById('navConfig');
        const controlHimnario = document.getElementById('controlHimnario');
        const controlBiblia = document.getElementById('controlBiblia');
        const configModal = document.getElementById('configModal');
        const topBarTitulo = document.getElementById('topBarTitulo');
        const btnCambiarVista = document.getElementById('btnCambiarVista');
        const vistaPreviaContainer = document.getElementById('vistaPreviaContainer');
        const vistaPrevia = document.getElementById('vistaPrevia');
        const vistaProyector = document.getElementById('vistaProyector');
        
        // Estado inicial: Biblia
        let modoActual = 'biblia';
        window.modoActual = modoActual;
        
        function actualizarModo(modo) {
          // Quitar clase activa de todos
          navHimnario.classList.remove('active');
          navBiblia.classList.remove('active');
          // Poner clase activa solo al bot√≥n del modo actual
          if (modo === 'himnario') {
            navHimnario.classList.add('active');
          } else {
            navBiblia.classList.add('active');
          }
          // Usar la funci√≥n global de main.js para cambiar el modo
          if (typeof window.cambiarModoGlobal === 'function') {
            window.cambiarModoGlobal(modo);
          } else {
            // Fallback: l√≥gica local
            if (modo === 'himnario') {
              controlHimnario.style.display = '';
              controlBiblia.style.display = 'none';
            } else {
              controlHimnario.style.display = 'none';
              controlBiblia.style.display = '';
            }
          }
          modoActual = modo;
          window.modoActual = modo;
        }
        
        navHimnario.addEventListener('click', () => actualizarModo('himnario'));
        navBiblia.addEventListener('click', () => actualizarModo('biblia'));
        navConfig.addEventListener('click', () => {
          configModal.style.display = 'flex';
          // Nunca dejar activo el bot√≥n de config
          navHimnario.classList.remove('active');
          navBiblia.classList.remove('active');
        });
        
        // Cerrar modal config
        document.getElementById('cerrarConfig').addEventListener('click', () => {
          configModal.style.display = 'none';
        });
        
        // Inicializar modo
        actualizarModo('biblia');
      });
    </script>
</body>
</html>



// church_display/src\css\proyector.css
@font-face {
  font-family: 'RobotoSlab-Bold';
  src: url('/src/assets/fonts/RobotoSlab-Bold.ttf') format('truetype');
}

@font-face {
  font-family: 'Qwigley';
  src: url('/src/assets/fonts/Handlee-Regular.ttf') format('truetype');
}

body, html { margin: 0; padding: 0; overflow: hidden; font-family: sans-serif; color: white; }
#video-bg {
  position: fixed;
  right: 0;
  bottom: 0;
  min-width: 100%;
  min-height: 100%;
  z-index: -1;
  object-fit: cover;
  width: 100vw;
  height: 100vh;
}
#contenido { 
  display: flex; 
  flex-direction: column; 
  justify-content: center; 
  align-items: center; 
  text-align: center; 
  height: 100vh; 
  background-color: rgba(0, 0, 0, 0.4); /* Sombra para legibilidad */ 
  text-shadow: 2px 2px 8px black; 
  position: relative;
}

/* Contador de secci√≥n (arriba a la derecha) */
#contador-seccion {
  position: absolute;
  top: 20px;
  right: 20px;
  font-size: 2.5vw;
  font-weight: bold;
  opacity: 0;
  transition: opacity 0.3s ease-in-out;
}

#contador-seccion.visible {
  opacity: 1;
}

/* Indicador de estrofa (centrado arriba) */
#indicador-estrofa {
  position: relative;
  top: unset;
  left: unset;
  transform: none;
  font-size: 3.5vw; /* Reducido de 5vw a 3.5vw para modo himno */
  font-weight: bold;
  opacity: 0;
  transition: opacity 0.3s ease-in-out;
  margin-bottom: 0.5em;
  margin-top: 0.2em;
}

#indicador-estrofa.visible {
  opacity: 1;
}

#texto-principal { 
  font-size: 5vw;
  padding: 0 2em; 
  transition: opacity 0.3s ease-in-out;
  opacity: 1;
}

/* Regla para permitir override de estilos inline */
#texto-principal.override-font-size {
  font-size: var(--override-font-size) !important;
}

#referencia.override-font-size {
  font-size: var(--override-ref-font-size) !important;
}

#texto-principal.fade-out {
  opacity: 0;
}

/* Estilo especial para t√≠tulo de himno */
#texto-principal.titulo-himno {
  font-family: 'RobotoSlab-Bold', serif;
  font-size: 6vw;
}

#referencia {
  position: absolute;
  top: 20px;
  left: 20px;
  font-size: 1.8vw;
  font-weight: normal;
  opacity: 1;
  transition: opacity 0.3s ease-in-out;
  text-align: left;
  bottom: unset;
}



#referencia.fade-out {
  opacity: 0;
}

#texto-principal.versiculo-biblia {
  font-family: 'Qwigley', cursive;
  font-weight: bold;
}

/* ===== CONFIGURACIONES ESPEC√çFICAS POR MODO ===== */

/* Modo Vers√≠culo: Referencia arriba, centrada, con fondo de c√°psula y semitransparente */
#contenido.modo-versiculo #referencia {
  position: absolute;
  top: 0;
  left: 50%;
  bottom: unset;
  transform: translateX(-50%);
  font-size: 2.5vw !important; /* Mantener !important para CSS, pero los estilos inline tendr√°n prioridad */
  text-align: center;
  font-weight: bold;
  background: rgba(0,0,0,0.7);
  color: #fff;
  padding: 0.2em 2.0em 0.2em 2.0em; /* m√°s padding abajo para compensar el corte arriba */
  border-radius: 0 0 32px 32px / 0 0 50% 50%;
  box-shadow: 0 2px 16px 0 rgba(0,0,0,0.18);
  min-width: 320px;
  max-width: 90vw;
  white-space: nowrap;
  z-index: 10;
  letter-spacing: 0.03em;
  font-family: 'RobotoSlab-Bold', serif;
}

/* Modo Vers√≠culo: Contenedor del texto principal */
#contenido.modo-versiculo #texto-principal {
  position: relative;
  top: 90px; /* Comienza debajo de la referencia */
  max-height: calc(100vh - 90px); /* Altura m√°xima disponible */
  display: flex;
  align-items: center;
  justify-content: center;  
  padding: 0 2em;
  margin: 0;
  width: 100%;
  box-sizing: border-box;
  transition: font-size 0.3s ease-in-out;
}

/* Modo Himno: Indicador de verso/coro m√°s peque√±o */
#contenido.modo-himno #indicador-estrofa {
  font-size: 2.8vw; /* A√∫n m√°s peque√±o que 3.5vw */
}

/* Modo Himno: Referencia en posici√≥n original pero con estilo espec√≠fico */
#contenido.modo-himno #referencia {
  position: absolute;
  top: 20px;
  left: 20px;
  font-size: 2.3vw !important; /* M√°s grande que 1.8vw */
  text-align: left;
  bottom: unset;
  transform: none;
  font-weight: bold;
}

/* Modo Himno: Letra del himno en negrita */
#contenido.modo-himno #texto-principal {
  font-weight: bold;
}



// church_display/src\css\style.css
/* Variables */
/** Variable CSS para el color dorado principal */
:root {
  --color-gris-base:#23272b;
  /* --color-destacado: #ffd700; */
  --color-destacado: #64a8e7;
}


/* Tema oscuro general */
body {
  background: #181c20;
  color: #f1f1f1;
  font-family: 'Segoe UI', Arial, sans-serif;
  margin: 0;
  padding: 56px 1em 2em 1em; /* padding-top igual a la altura del topbar */
  display: block;
  align-items: center;
  align-content: center;
}

button,
select,
input[type="text"] {
  background: var(--color-gris-base);
  color: #f1f1f1;
  border: 1px solid #333;
  border-radius: 4px;
  padding: 0.5em 1em;
  margin: 0.2em 0.5em 0.2em 0;
  font-size: 1em;
}

button:hover,
select:focus,
input[type="text"]:focus {
  background: #2c3136;
  outline: none;
}

hr {
  border: 1px solid #222;
}

/* Switch moderno */
.switch-container {
  display: flex;
  align-items: center;
  gap: 0.5em;
  margin-bottom: 1em;
}

.switch-label {
  font-size: 1em;
  color: #aaa;
}

.switch-input {
  display: none;
}

.slider {
  width: 48px;
  height: 24px;
  background: #333;
  border-radius: 24px;
  position: relative;
  display: inline-block;
  margin: 0 0.5em;
  vertical-align: middle;
}

.slider::before {
  content: '';
  position: absolute;
  left: 4px;
  top: 4px;
  width: 16px;
  height: 16px;
  background: #f1f1f1;
  border-radius: 50%;
  transition: transform 0.2s;
}

.switch-input:checked+.slider::before {
  transform: translateX(24px);
  background: var(--color-destacado);
}

/* Paneles de control */
#controlBiblia,
#controlHimnario {
  margin-bottom: 1em;
  padding-bottom: 10px;
}

#controlBiblia[hidden],
#controlHimnario[hidden] {
  display: none !important;
}

/* Eliminar reglas din√°micas de margin-top para los controles */
body:not(.con-boton-proyector) #controlBiblia,
body:not(.con-boton-proyector) #controlHimnario {
  margin-top: 0;
}

/* Sugerencias de libros */
#sugerenciasLibros {
  background: var(--color-gris-base);
  border: 1px solid #333;
  border-radius: 4px;
  max-height: 180px;
  overflow-y: auto;
  margin-bottom: 0.5em;
  position: fixed;
  z-index: 1000;
  width: 250px;
  display: none;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

#sugerenciasLibros div {
  padding: 0.4em 1em;
  cursor: pointer;
  border-bottom: 1px solid #222;
}

#sugerenciasLibros div:last-child {
  border-bottom: none;
}

#sugerenciasLibros div:hover {
  background: #444;
}

#sugerenciasLibros div.selected {
  background: #0057b8;
  color: #fff;
}

/* Contenedor de b√∫squeda de libros */
#buscarLibro {
  position: relative;
  /* width: 250px; */
}

/* Contenedor de b√∫squeda de himnos */
#buscarHimno {
  /* width: 100%; */
  max-width: 300px;
}

/* Inputs de b√∫squeda m√°s anchos */
#buscarLibro,
#buscarHimno {
  width: 100%;
  max-width: 100vw;
  box-sizing: border-box;
  margin: 0 auto;
  padding-left: 0.5em;
  padding-right: 0.5em;
}

/* Grillas de cap√≠tulos y vers√≠culos */
#grillaCapitulos,
#grillaVersiculos {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(36px, 1fr));
  gap: 0.3em;
  margin: 0.5em 0;
  max-width: 400px;
}

#grillaCapitulos button,
#grillaVersiculos button {
  padding: 0.3em 0;
  font-size: 0.9em;
  border-radius: 4px;
  background: var(--color-gris-base);
  border: 1px solid #333;
  cursor: pointer;
  min-width: 36px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
}

#grillaCapitulos button:hover,
#grillaVersiculos button:hover {
  background: #2c3136;
  border-color: #555;
}

#grillaCapitulos button.selected,
#grillaVersiculos button.selected {
  background: #0057b8;
  color: #fff;
  border-color: #0057b8;
}

/* Lista de himnos */
#listaHimnos {
  max-height: 250px;
  overflow-y: auto;
  background: var(--color-gris-base);
  border: 1px solid #333;
  border-radius: 4px;
  margin-bottom: 0.5em;
}

#listaHimnos div {
  padding: 0.5em 1em;
  cursor: pointer;
  border-bottom: 1px solid #222;
}

#listaHimnos div:last-child {
  border-bottom: none;
}

#listaHimnos div.selected,
#listaHimnos div:hover {
  background: #0057b8;
  color: #fff;
}

/* Vista previa */
#vistaPrevia {
  background: var(--color-gris-base);
  border-radius: 8px;
  padding: 1em;
  padding-bottom: 150px;
  min-height: 120px;
  margin-bottom: 130px;
  box-shadow: 0 2px 8px #0004;
  display: flex;
  flex-direction: column;
  gap: 0.5em;
}

.card {
  background: #222;
  border-radius: 4px;
  padding: 0.7em 1em;
  margin: 0.2em 0;
  cursor: pointer;
  border: 2px solid transparent;
  transition: border 0.2s, background 0.2s;
}

.card.selected {
  border: 2px solid var(--color-destacado);
  background: #333;
}

/* Navegaci√≥n */
.nav-controls {
  display: flex;
  gap: 1em;
  justify-content: center;
  margin-bottom: 1em;
}

/* Reproductor de audio */
#audio {
  width: 100%;
  background: var(--color-gris-base);
  border-radius: 4px;
}

/* Responsive */
@media (max-width: 600px) {
  #vistaPrevia {
    padding: 0.5em;
    font-size: 0.95em;
  }

  .nav-controls {
    flex-direction: column;
    gap: 0.5em;
  }
}

.grilla-label {
  font-weight: bold;
  color: var(--color-destacado);
  margin-top: 0.7em;
  margin-bottom: 0.2em;
  font-size: 1.05em;
  letter-spacing: 0.5px;
}

.app-footer {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 60px;
  background: #181c20;
  box-shadow: 0 -2px 12px #0008;
  padding: 0.7em 1em;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 2em;
  z-index: 2000;
}

.app-footer button {
  font-size: 1.1em;
  padding: 0.6em 1.4em;
  border-radius: 6px;
  background: var(--color-gris-base);
  color: var(--color-destacado);
  border: 1px solid #333;
  transition: background 0.2s, color 0.2s;
}

.app-footer button:hover {
  background: #2c3136;
  color: #fff;
}

@media (max-width: 600px) {
  .app-footer {
    flex-direction: column;
    gap: 0.7em;
    padding: 0.7em 0.2em;
  }

  .app-footer button {
    width: 100%;
    font-size: 1em;
  }
}

/* --- Panel de configuraci√≥n --- */
#configModal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.6);
  z-index: 2000;
  justify-content: center;
  align-items: center;
}

#configModal[open] {
  display: flex;
}

#configModal>div {
  background: var(--color-gris-base);
  color: #fff;
  border-radius: 10px;
  padding: 2em;
  min-width: 300px;
  max-width: 90vw;
  box-shadow: 0 8px 32px #000a;
  position: relative;
  display: flex;
  flex-direction: column;
  gap: 1.2em;
}

#cerrarConfig {
  position: absolute;
  top: 10px;
  right: 10px;
  background: none;
  border: none;
  color: var(--color-destacado);
  font-size: 1.5em;
  cursor: pointer;
}

#btnConfig {
  position: absolute;
  top: 16px;
  right: 16px;
  background: none;
  border: none;
  cursor: pointer;
  z-index: 1001;
  padding: 0.2em;
  border-radius: 50%;
  transition: background 0.2s;
}

#btnConfig:hover {
  background: #333;
}

#sliderFontBibliaContainer,
#sliderFontHimnarioContainer {
  margin-bottom: 1.5em;
}

#sliderFontsizeBiblia,
#sliderFontsizeHimnario {
  width: 180px;
  margin-top: 0.5em;
}

#fontsizeValueBiblia,
#fontsizeValueHimnario {
  color: var(--color-destacado);
  font-weight: bold;
  margin-left: 0.5em;
}

#opcionSoloReferencia label {
  margin-right: 0.5em;
}

.audio-mode-btn {
  background: var(--color-gris-base);
  color: var(--color-destacado);
  border: 2px solid #333;
  border-radius: 8px;
  padding: 0.4em 0.7em;
  font-size: 1em;
  cursor: pointer;
  min-width: 60px;
  min-height: 48px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  transition: background 0.2s, border 0.2s, color 0.2s;
}

.audio-mode-btn.selected {
  background: var(--color-destacado);
  color: var(--color-gris-base);
  border-color: var(--color-destacado);
}

.audio-mode-btn:not(.selected):hover {
  background: #2c3136;
  color: #fff;
}

/* Estilos espec√≠ficos para dispositivos m√≥viles */
@media (max-width: 768px) {
  body {
    padding: 1em 0.5em;
    font-size: 14px;
  }

  /* Botones m√°s grandes para touch */
  button,
  select,
  input[type="text"] {
    padding: 0.8em 1em;
    font-size: 16px;
    /* Evita zoom en iOS */
    min-height: 44px;
    /* Tama√±o m√≠nimo para touch */
  }

  /* Switch m√°s grande */
  .slider {
    width: 60px;
    height: 30px;
  }

  .slider::before {
    width: 22px;
    height: 22px;
    top: 4px;
    left: 4px;
  }

  .switch-input:checked+.slider::before {
    transform: translateX(30px);
  }

  /* Sugerencias de libros m√°s anchas */
  #sugerenciasLibros {
    width: calc(100% - 2em);
    max-width: none;
    left: 1em;
    right: 1em;
  }

  /* Grillas m√°s grandes */
  #grillaCapitulos,
  #grillaVersiculos {
    grid-template-columns: repeat(auto-fit, minmax(50px, 1fr));
    gap: 0.5em;
  }

  #grillaCapitulos button,
  #grillaVersiculos button {
    min-width: 50px;
    height: 44px;
    font-size: 16px;
  }

  /* Lista de himnos m√°s alta */
  #listaHimnos {
    max-height: 300px;
  }

  /* Vista previa m√°s compacta */
  #vistaPrevia {
    min-height: 100px;
    padding: 0.8em;
  }

  .card {
    padding: 0.8em 1em;
    font-size: 14px;
  }

  /* Footer m√°s espaciado */
  .app-footer {
    padding: 1em 0.5em;
    gap: 0.5em;
  }

  .app-footer button {
    padding: 0.8em 1.2em;
    font-size: 16px;
    min-height: 44px;
  }

  /* Modal de configuraci√≥n m√°s compacto */
  #configModal>div {
    padding: 1.5em;
    margin: 1em;
    max-width: calc(100vw - 2em);
  }

  /* Botones de modo de audio m√°s grandes */
  .audio-mode-btn {
    padding: 1em 0.8em;
    min-height: 60px;
    font-size: 14px;
  }

  

  /* Select de versi√≥n b√≠blica m√°s ancho */
  #versionBiblia {
    width: 100%;
    max-width: 100vw;
    box-sizing: border-box;
    margin: 0 auto;
    margin-bottom: 0.5em;  
    padding-top: 0.5em;
    padding-left: 0.5em;
    padding-right: 0.5em;    

    /* width: calc(100% - 1em);
    max-width: none; */
  }
}

/* Estilos para pantallas muy peque√±as */
@media (max-width: 480px) {
  body {
    padding: 0.5em 0.3em;
    font-size: 13px;
  }

  /* Grillas m√°s compactas */
  #grillaCapitulos,
  #grillaVersiculos {
    grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
    gap: 0.3em;
  }

  #grillaCapitulos button,
  #grillaVersiculos button {
    min-width: 40px;
    height: 40px;
    font-size: 14px;
  }

  /* Footer m√°s compacto */
  .app-footer {
    padding: 0.8em 0.3em;
  }

  .app-footer button {
    padding: 0.6em 1em;
    font-size: 14px;
  }

  /* Vista previa m√°s compacta */
  #vistaPrevia {
    min-height: 80px;
    padding: 0.6em;
  }

  .card {
    padding: 0.6em 0.8em;
    font-size: 13px;
  }
}

/* Mejoras para orientaci√≥n horizontal en m√≥viles */
@media (max-width: 768px) and (orientation: landscape) {
  body {
    padding: 0.5em;
  }

  /* Layout m√°s compacto */
  #controlBiblia,
  #controlHimnario {
    margin-bottom: 0.5em;
  }

  /* Grillas m√°s peque√±as para aprovechar el espacio */
  #grillaCapitulos,
  #grillaVersiculos {
    grid-template-columns: repeat(auto-fit, minmax(35px, 1fr));
    gap: 0.2em;
  }

  #grillaCapitulos button,
  #grillaVersiculos button {
    min-width: 35px;
    height: 35px;
    font-size: 12px;
  }

  /* Lista de himnos m√°s compacta */
  #listaHimnos {
    max-height: 200px;
  }

  /* Footer m√°s compacto */
  .app-footer {
    padding: 0.5em;
  }
}

#reproductorAudio {
  opacity: 0;
  width: 100%;
  margin-top: 1em;
  background: var(--color-gris-base);
  border-radius: 4px;
}

#abrirProyector {
  width: 100%;
  font-weight: bold;
  align-content: center;
  padding-top: 20px;
  background-color: lightgreen;
  color: #050f08be;
}

#abrirProyector.proyector-abierto {
  background-color: #dc3545 !important;
  color: #fff !important;
}
#abrirProyector.proyector-normal {
  background-color: lightgreen !important;
  color: #050f08be !important;
}


/* --- FOOT NAVBAR ACTIVE BUTTON --- */
.nav-btn.active {
  background: var(--color-destacado) !important;
  color: var(--color-gris-base) !important;
  border-radius: 8px;
  box-shadow: 0 2px 8px #0003;
  transition: background 0.2s, color 0.2s;
}

/* Mini proyector igual al proyector real */
.mini-proyector {
  position: relative;
  background: #181c20;
  border-radius: 12px;
  box-shadow: 0 4px 24px #000a;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
}

.mini-proyector-video {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: 0;
}

.mini-proyector-content {
  position: relative;
  z-index: 1;
  width: 100%;
  text-align: center;
  color: #fff;
  text-shadow: 0 2px 8px #000, 0 0 2px var(--color-destacado);
  font-family: 'Merriweather', 'Roboto Slab', serif;
  padding: 2em 1em;
  font-size: 2.2em;
  line-height: 1.2;
  user-select: none;
  pointer-events: none;
}

.mini-proyector-content .referencia {
  display: block;
  font-size: 0.5em;
  color: var(--color-destacado);
  margin-bottom: 0.5em;
  text-shadow: 0 1px 4px #000;
  font-weight: bold;
  letter-spacing: 1px;
}

.mini-proyector {
  aspect-ratio: 16/9;
  width: 100%;
  max-width: 900px;
}

.mini-proyector-margin {
  margin-bottom: min(22vh, 120px);
}

body {
  padding-bottom: min(22vh, 120px);
}

.app-footer {
  position: fixed;
  left: 0;
  bottom: 0;
  width: 100vw;
  z-index: 5000;
  background: var(--color-gris-base);
  box-shadow: 0 -2px 12px #000a;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1em;
  padding: 0.5em 0;
}

.botonera-navegacion {
  position: fixed;
  left: 0;
  bottom: 96px;
  /* Altura del foot navbar */
  width: 100vw;
  z-index: 4000;
  background: var(--color-gris-base);
  box-shadow: 0 -2px 12px #000a;
  display: block;
  justify-content: center;
  align-items: center;
  gap: 1em;  
  padding: 0.5em 0;
  padding-bottom: 1.5em;
  border-top: 1px solid #222;
  border-bottom: 1px solid #111;
  transition: bottom 0.2s;
}

@media (max-width: 600px) {
  .botonera-navegacion {
    bottom: 56px;
  }
}

.btn-control{
  display: flex;
  width: 100%;
  text-align: center;
  align-items: center;
}

/* --- Estilos migrados desde index.html --- */
#topBar {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 56px;
  background: var(--color-gris-base);
  color: var(--color-destacado);
  display: flex;
  align-items: center;
  justify-content: space-between;
  z-index: 4000;
  padding: 0 1.2em;
  box-shadow: 0 2px 12px #000a;
}

#topBarTitulo {
  font-size: 1.5em;
  font-weight: bold;
}
.btn-cambiar-vista {
  background: none;
  border: none;
  color: var(--color-destacado);
  font-size: 1.5em;
  cursor: pointer;
  outline: none;
  display: flex;
  align-items: center;
  gap: 0.5em;
}
.btn-cambiar-vista-text {
  font-size: 0.9em;
}
.btn-abrir-proyector {
  /* Puedes personalizar m√°s si lo deseas */
}
#configModal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.6);
  z-index: 2000;
  justify-content: center;
  align-items: center;
}
.config-modal-content {
  background: var(--color-gris-base);
  color: #fff;
  border-radius: 10px;
  padding: 2em;
  min-width: 300px;
  max-width: 90vw;
  box-shadow: 0 8px 32px #000a;
  position: relative;
}
.btn-cerrar-config {
  position: absolute;
  top: 10px;
  right: 10px;
  background: none;
  border: none;
  color: var(--color-destacado);
  font-size: 1.5em;
  cursor: pointer;
}
.config-titulo {
  margin-top: 0;
  color: var(--color-destacado);
}
.slider-font-biblia-container,
.slider-font-himnario-container,
.opcion-solo-referencia {
  margin-bottom: 1.5em;
}

/* --- Estilos migrados del navbar inferior de index.html --- */
.foot-navbar {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100vw;
  height: 64px;
  background: var(--color-gris-base);
  display: flex;
  justify-content: space-around;
  align-items: center;
  z-index: 5000;
  box-shadow: 0 -2px 12px #000a;
}
.nav-btn {
  background: none;
  border: none;
  color: var(--color-destacado);
  font-size: 2em;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  cursor: pointer;
  outline: none;
}
.nav-btn-text {
  font-size: 0.7em;
}

/* --- Estilos para los botones de navegaci√≥n inferiores --- */
.btn-control {
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  width: 100%;
  text-align: center;
  gap: 0.5em;
  font-size: 1.1em;
  padding: 0.5em 1.2em;
  background: none;
  border: none;
  color: var(--color-destacado);
  cursor: pointer;
  border-radius: 6px;
  transition: background 0.2s;
}
.btn-control:hover {
  background: var(--color-gris-base);
  color: #fffbe7;
}
.btn-control-text {
  display: inline-block;
  text-align: center;
}
.btn-control i {
  font-size: 1.2em;
  vertical-align: middle;
}
#anterior i {
  margin-right: 0.4em;
}
#siguiente i {
  margin-left: 0.4em;
}
#playHimnoFooter i {
  margin-right: 0.4em;
}

@media (max-width: 600px) {
  body {
    padding-top: 64px !important; /* Asegura espacio suficiente para el topbar en m√≥vil */
  }
}

@media (max-width: 768px) {
  /* Eliminar la deshabilitaci√≥n visual del bot√≥n en m√≥viles para permitir el cambio de color por JS */
  /* #abrirProyector {
    pointer-events: none;
    opacity: 0.6;
    filter: grayscale(0.5);
    cursor: not-allowed;
  } */
}



// church_display/src\js\dataManager.js
// dataManager.js - Script normal (no m√≥dulo)

console.log('üìö dataManager.js cargando...');

/**
 * Obtiene la lista de versiones de la Biblia disponibles.
 * @returns {Promise<Array<{file: string, description: string}>>}
 */
async function getBibleVersions() {
  try {
    // Crear un archivo de √≠ndice que liste las biblias disponibles
    // Como no podemos leer el directorio directamente desde el navegador,
    // crearemos un archivo JSON que contenga la lista de biblias
    const response = await fetch('/src/assets/biblias/biblias-disponibles.json');
    if (response.ok) {
      const data = await response.json();
      const biblias = data.biblias || [];
      const descripciones = data.descripciones || {};
      
      // Convertir archivos XML a JSON
      return biblias.map(file => ({
        file: file.replace('.xml', '.json'),
        description: descripciones[file] || file.replace('.xml', '').replace('.json', '')
      }));
    }
    
    // Fallback: lista hardcodeada basada en los archivos JSON disponibles
    const fallbackBiblias = [
      'es-DHH.json',
      'es-NTV.json', 
      'es-rv2015.json',
      'es-rv2020.json',
      'es-rv60.json'
    ];
    
    const fallbackDescripciones = {
      'es-DHH.json': 'Dios Habla Hoy',
      'es-NTV.json': 'Nueva Traducci√≥n Viviente',
      'es-rv2015.json': 'Reina Valera 2015',
      'es-rv2020.json': 'Reina Valera 2020',
      'es-rv60.json': 'Reina Valera 1960'
    };
    
    return fallbackBiblias.map(file => ({
      file: file,
      description: fallbackDescripciones[file] || file.replace('.json', '')
    }));
  } catch (error) {
    console.error('Error al cargar las versiones de la Biblia:', error);
    // Fallback: lista hardcodeada basada en los archivos JSON disponibles
    const fallbackBiblias = [
      'es-DHH.json',
      'es-NTV.json', 
      'es-rv2015.json',
      'es-rv2020.json',
      'es-rv60.json'
    ];
    
    const fallbackDescripciones = {
      'es-DHH.json': 'Dios Habla Hoy',
      'es-NTV.json': 'Nueva Traducci√≥n Viviente',
      'es-rv2015.json': 'Reina Valera 2015',
      'es-rv2020.json': 'Reina Valera 2020',
      'es-rv60.json': 'Reina Valera 1960'
    };
    
    return fallbackBiblias.map(file => ({
      file: file,
      description: fallbackDescripciones[file] || file.replace('.json', '')
    }));
  }
}

/**
 * Carga y parsea un archivo XML de una Biblia.
 * @param {string} versionFileName - Nombre del archivo XML (ej. 'RVR1960.xml')
 * @returns {Promise<Object>} Objeto con la estructura { Libro: [ [ {verse, text}, ... ], ... ] }
 */
async function parseBible(versionFileName) {
  try {
    const response = await fetch(`/src/assets/biblias/${versionFileName}`);
    
    if (!response.ok) {
      console.error(`Error al cargar el archivo JSON: ${response.status} ${response.statusText}`);
      return null;
    }
    
    const bibleData = await response.json();
    const bible = {};
    
    console.log(`Cargando Biblia desde JSON: ${versionFileName}`);
    console.log(`Encontrados ${Object.keys(bibleData).length} libros en el JSON`);
    
    // Procesar cada libro
    for (const [bookName, chapters] of Object.entries(bibleData)) {
      console.log(`Procesando libro: ${bookName}`);
      bible[bookName] = [];
      
      // Procesar cada cap√≠tulo
      for (const [chapterNumber, verses] of Object.entries(chapters)) {
        const chapterArr = [];
        
        // Procesar cada vers√≠culo
        for (const [verseNumber, verseText] of Object.entries(verses)) {
          const verseNum = parseInt(verseNumber);
          if (!isNaN(verseNum) && verseText && verseText.trim()) {
            chapterArr.push({ 
              verse: verseNum, 
              text: verseText.trim() 
            });
          }
        }
        
        // Ordenar vers√≠culos por n√∫mero
        chapterArr.sort((a, b) => a.verse - b.verse);
        bible[bookName].push(chapterArr);
      }
    }
    
    console.log('Biblia cargada exitosamente:', Object.keys(bible));
    return bible;
  } catch (err) {
    console.error('Error al parsear la Biblia JSON:', err);
    return null;
  }
}

/**
 * Obtiene el √≠ndice de himnos disponibles.
 * @returns {Promise<Array<{number: string, title: string, file: string}>>}
 */
async function getHymnIndex() {
  try {
    // Lista hardcodeada de himnos basada en los archivos disponibles
    // Esto es una soluci√≥n temporal hasta que se implemente un sistema de indexaci√≥n din√°mica
    const himnos = [
      { number: "001", title: "Cantad alegres al Se√±or", file: "001 - Cantad alegres al Se√±or.json" },
      { number: "002", title: "Da gloria al Se√±or", file: "002 - Da gloria al Se√±or.json" },
      { number: "003", title: "Unidos en esp√≠ritu", file: "003 - Unidos en esp√≠ritu.json" },
      { number: "004", title: "Alabanzas sin cesar", file: "004 - Alabanzas sin cesar.json" },
      { number: "005", title: "A ti, glorioso Dios", file: "005 - A ti, glorioso Dios.json" },
      { number: "006", title: "¬°Hosanna!", file: "006 - ¬°Hosanna!.json" },
      { number: "007", title: "Oh Dios, mi soberano Rey", file: "007 - Oh Dios, mi soberano Rey.json" },
      { number: "008", title: "¬°Suenen dulces himnos!", file: "008 - ¬°Suenen dulces himnos!.json" },
      { number: "009", title: "Alabemos al Se√±or", file: "009 - Alabemos al Se√±or.json" },
      { number: "010", title: "Alaba al Dios de Abraham", file: "010 - Alaba al Dios de Abraham.json" },
      { number: "011", title: "Alma, bendice al Se√±or", file: "011 - Alma, bendice al Se√±or.json" },
      { number: "012", title: "Todos juntos reunidos", file: "012 - Todos juntos reunidos.json" },
      { number: "013", title: "Al Dios invisible", file: "013 - Al Dios invisible.json" },
      { number: "014", title: "Engrandecido sea Dios", file: "014 - Engrandecido sea Dios.json" },
      { number: "015", title: "Lo√°moste, ¬°oh Dios!", file: "015 - Lo√°moste, ¬°oh Dios!.json" },
      { number: "016", title: "A nuestro Padre Dios", file: "016 - A nuestro Padre Dios.json" },
      { number: "017", title: "Oh Padre, eterno Dios", file: "017 - Oh Padre, eterno Dios.json" },
      { number: "018", title: "Load al Padre", file: "018 - Load al Padre.json" },
      { number: "019", title: "Padre nuestro", file: "019 - Padre nuestro.json" },
      { number: "020", title: "A Dios, el Padre celestial", file: "020 - A Dios, el Padre celestial.json" },
      { number: "021", title: "Gloria sea al Padre", file: "021 - Gloria sea al Padre.json" },
      { number: "022", title: "Jehov√° est√° en su santo templo", file: "022 - Jehov√° est√° en su santo templo.json" },
      { number: "023", title: "¬°Silencio! ¬°Silencio!", file: "023 - ¬°Silencio! ¬°Silencio!.json" },
      { number: "024", title: "Imploramos tu presencia", file: "024 - Imploramos tu presencia.json" },
      { number: "025", title: "Siento la presencia del Se√±or", file: "025 - Siento la presencia del Se√±or.json" },
      { number: "026", title: "Aqu√≠ reunidos", file: "026 - Aqu√≠ reunidos.json" },
      { number: "027", title: "¬°Oh Pastor divino, escucha!", file: "027 - ¬°Oh Pastor divino, escucha!.json" },
      { number: "028", title: "Tu pueblo jubiloso", file: "028 - Tu pueblo jubiloso.json" },
      { number: "029", title: "Del culto el tiempo llega", file: "029 - Del culto el tiempo llega.json" },
      { number: "030", title: "Abre mis ojos", file: "030 - Abre mis ojos.json" },
      { number: "031", title: "¬°Oh, Se√±or! al orar", file: "031 - ¬°Oh, Se√±or! al orar.json" },
      { number: "032", title: "Nos reunimos en tu santuario", file: "032 - Nos reunimos en tu santuario.json" },
      { number: "033", title: "Tu presencia, Padre amante, invocamos", file: "033 - Tu presencia, Padre amante, invocamos.json" },
      { number: "034", title: "En momentos as√≠", file: "034 - En momentos as√≠.json" },
      { number: "035", title: "Oye, oh Se√±or", file: "035 - Oye, oh Se√±or.json" },
      { number: "036", title: "¬°Oh, Dios, que oyes cada oraci√≥n!", file: "036 - ¬°Oh, Dios, que oyes cada oraci√≥n!.json" },
      { number: "037", title: "Dios os guarde", file: "037 - Dios os guarde.json" },
      { number: "038", title: "Que Dios te guarde", file: "038 - Que Dios te guarde.json" },
      { number: "039", title: "Despide hoy tu grey", file: "039 - Despide hoy tu grey.json" },
      { number: "040", title: "Shalom", file: "040 - Shalom.json" },
      { number: "041", title: "Gracia, amor y comuni√≥n", file: "041 - Gracia, amor y comuni√≥n.json" },
      { number: "042", title: "Queda, Se√±or", file: "042 - Queda, Se√±or.json" },
      { number: "043", title: "Agua de vida", file: "043 - Agua de vida.json" },
      { number: "044", title: "Desp√≠denos con tu bendici√≥n", file: "044 - Desp√≠denos con tu bendici√≥n.json" },
      { number: "045", title: "Despu√©s, Se√±or", file: "045 - Despu√©s, Se√±or.json" },
      { number: "046", title: "Hoy amanece", file: "046 - Hoy amanece.json" },
      { number: "047", title: "Por la ma√±ana", file: "047 - Por la ma√±ana.json" },
      { number: "048", title: "Oh Dios, si he ofendido un coraz√≥n", file: "048 - Oh Dios, si he ofendido un coraz√≥n.json" },
      { number: "049", title: "Cristo, ya la noche cierra", file: "049 - Cristo, ya la noche cierra.json" },
      { number: "050", title: "Baja el sol", file: "050 - Baja el sol.json" },
      { number: "051", title: "Nuestro sol se pone ya", file: "051 - Nuestro sol se pone ya.json" },
      { number: "052", title: "Se√±or Jes√∫s, el d√≠a ya se fue", file: "052 - Se√±or Jes√∫s, el d√≠a ya se fue.json" },
      { number: "053", title: "¬°Oh amor de Dios!", file: "053 - ¬°Oh amor de Dios!.json" },
      { number: "054", title: "Tan bueno es Dios", file: "054 - Tan bueno es Dios.json" },
      { number: "055", title: "Grande, Se√±or, es tu misericordia", file: "055 - Grande, Se√±or, es tu misericordia.json" },
      { number: "056", title: "De tal manera am√≥", file: "056 - De tal manera am√≥.json" },
      { number: "057", title: "Mi Dios me ama", file: "057 - Mi Dios me ama.json" },
      { number: "058", title: "Grande es el amor divino", file: "058 - Grande es el amor divino.json" },
      { number: "059", title: "Mirad qu√© amor", file: "059 - Mirad qu√© amor.json" },
      { number: "060", title: "¬°Santo! ¬°Santo! ¬°Santo! Tu gloria llena", file: "060 - ¬°Santo! ¬°Santo! ¬°Santo! Tu gloria llena.json" },
      { number: "061", title: "Santo, Santo, Santo, Dios Omnipotente", file: "061 - Santo, Santo, Santo, Dios Omnipotente.json" },
      { number: "062", title: "Santo, Santo, Santo, Santo es el Se√±or", file: "062 - Santo, Santo, Santo, Santo es el Se√±or.json" },
      { number: "063", title: "Al Rey adorad", file: "063 - Al Rey adorad.json" },
      { number: "064", title: "Yo canto el poder de Dios", file: "064 - Yo canto el poder de Dios.json" },
      { number: "065", title: "El mundo es de mi Dios", file: "065 - El mundo es de mi Dios.json" },
      { number: "066", title: "¬øSabes cu√°ntos?", file: "066 - ¬øSabes cu√°ntos.json" },
      { number: "067", title: "¬°Se√±or, yo te conozco!", file: "067 - ¬°Se√±or, yo te conozco!.json" },
      { number: "068", title: "Todo lo que ha creado Dios", file: "068 - Todo lo que ha creado Dios.json" },
      { number: "069", title: "Se√±or, mi Dios", file: "069 - Se√±or, mi Dios.json" },
      { number: "070", title: "¬°Nuestro Dios reina!", file: "070 - ¬°Nuestro Dios reina!.json" },
      { number: "071", title: "Cada cosa hermosa", file: "071 - Cada cosa hermosa.json" },
      { number: "072", title: "Fue un milagro", file: "072 - Fue un milagro.json" },
      { number: "073", title: "La creaci√≥n", file: "073 - La creaci√≥n.json" },
      { number: "074", title: "Himno al Creador", file: "074 - Himno al Creador.json" },
      { number: "075", title: "Grande es Jehov√°", file: "075 - Grande es Jehov√°.json" },
      { number: "076", title: "Eterno Dios, mi Creador", file: "076 - Eterno Dios, mi Creador.json" },
      { number: "077", title: "Sea exaltado", file: "077 - Sea exaltado.json" },
      { number: "078", title: "¬°Al mundo paz!", file: "078 - ¬°Al mundo paz!.json" },
      { number: "079", title: "Se oye un canto en alta esfera", file: "079 - Se oye un canto en alta esfera.json" },
      { number: "080", title: "Venid, pastorcillos", file: "080 - Venid, pastorcillos.json" },
      { number: "081", title: "Noche de paz", file: "081 - Noche de paz.json" },
      { number: "082", title: "Ya repican las campanas", file: "082 - Ya repican las campanas.json" },
      { number: "083", title: "La primera Navidad", file: "083 - La primera Navidad.json" },
      { number: "084", title: "Ve, dilo en las monta√±as", file: "084 - Ve, dilo en las monta√±as.json" },
      { number: "085", title: "All√° en el pesebre", file: "085 - All√° en el pesebre.json" },
      { number: "086", title: "A medianoche en Bel√©n", file: "086 - A medianoche en Bel√©n.json" },
      { number: "087", title: "Venid, fieles todos", file: "087 - Venid, fieles todos.json" },
      { number: "088", title: "Oh, aldehuela de Bel√©n", file: "088 - Oh, aldehuela de Bel√©n.json" },
      { number: "089", title: "Cristianos, alegraos hoy", file: "089 - Cristianos, alegraos hoy.json" },
      { number: "090", title: "Somos del oriente", file: "090 - Somos del oriente.json" },
      { number: "091", title: "¬øQu√© ni√±o es este?", file: "091 - ¬øQu√© ni√±o es este.json" },
      { number: "092", title: "Angeles cantando est√°n", file: "092 - Angeles cantando est√°n.json" },
      { number: "093", title: "Hubo Uno que quiso", file: "093 - Hubo Uno que quiso.json" },
      { number: "094", title: "Sangr√≥ mi soberano Dios", file: "094 - Sangr√≥ mi soberano Dios.json" },
      { number: "095", title: "Un d√≠a", file: "095 - Un d√≠a.json" },
      { number: "096", title: "Al contemplar la excelsa cruz", file: "096 - Al contemplar la excelsa cruz.json" },
      { number: "097", title: "En el monte Calvario", file: "097 - En el monte Calvario.json" },
      { number: "098", title: "Rostro divino", file: "098 - Rostro divino.json" },
      { number: "099", title: "Jam√°s podr√° alguien separarnos", file: "099 - Jam√°s podr√° alguien separarnos.json" },
      { number: "100", title: "¬°Dulces momentos!", file: "100 - ¬°Dulces momentos!.json" },
      { number: "101", title: "Cabeza sacrosanta", file: "101 - Cabeza sacrosanta.json" },
      { number: "102", title: "Cordero de Dios", file: "102 - Cordero de Dios.json" },
      { number: "103", title: "Jes√∫s resucitado", file: "103 - Jes√∫s resucitado.json" },
      { number: "104", title: "La tumba le encerr√≥", file: "104 - La tumba le encerr√≥.json" },
      { number: "105", title: "Cristo ha resucitado", file: "105 - Cristo ha resucitado.json" },
      { number: "106", title: "Tuya es la gloria", file: "106 - Tuya es la gloria.json" },
      { number: "107", title: "Canto el gran amor", file: "107 - Canto el gran amor.json" },
      { number: "108", title: "Amigo fiel es Cristo", file: "108 - Amigo fiel es Cristo.json" },
      { number: "109", title: "Un buen amigo tengo yo", file: "109 - Un buen amigo tengo yo.json" },
      { number: "110", title: "Cristo es el mejor amigo", file: "110 - Cristo es el mejor amigo.json" },
      { number: "111", title: "Como Jes√∫s no hay otro amigo", file: "111 - Como Jes√∫s no hay otro amigo.json" },
      { number: "112", title: "Ning√∫n otro me am√≥ cual Cristo", file: "112 - Ning√∫n otro me am√≥ cual Cristo.json" },
      { number: "113", title: "Amor que no me dejar√°s", file: "113 - Amor que no me dejar√°s.json" },
      { number: "114", title: "Dime la antigua historia", file: "114 - Dime la antigua historia.json" },
      { number: "115", title: "¬°Oh, cu√°n grande amor!", file: "115 - ¬°Oh, cu√°n grande amor!.json" },
      { number: "116", title: "Cristo est√° a mi lado", file: "116 - Cristo est√° a mi lado.json" },
      { number: "117", title: "No s√© por qu√©", file: "117 - No s√© por qu√©.json" },
      { number: "118", title: "Cuando est√©s cansado y abatido", file: "118 - Cuando est√©s cansado y abatido.json" },
      { number: "119", title: "De su trono, mi Jes√∫s", file: "119 - De su trono, mi Jes√∫s.json" },
      { number: "120", title: "¬°Cu√°nto me alegra!", file: "120 - ¬°Cu√°nto me alegra!.json" },
      { number: "121", title: "Es Jesucristo la vida, la luz", file: "121 - Es Jesucristo la vida, la luz.json" },
      { number: "122", title: "Divino pastor", file: "122 - Divino pastor.json" },
      { number: "123", title: "¬°Cu√°nto nos ama Jes√∫s!", file: "123 - ¬°Cu√°nto nos ama Jes√∫s!.json" },
      { number: "124", title: "Ama el Pastor sus ovejas", file: "124 - Ama el Pastor sus ovejas.json" },
      { number: "125", title: "Infinito amor de Cristo", file: "125 - Infinito amor de Cristo.json" },
      { number: "126", title: "Abrigadas y salvas en el redil", file: "126 - Abrigadas y salvas en el redil.json" },
      { number: "127", title: "Cristo, nombre dulce", file: "127 - Cristo, nombre dulce.json" },
      { number: "128", title: "¬°Tu nombre es dulce, buen Jes√∫s!", file: "128 - ¬°Tu nombre es dulce, buen Jes√∫s!.json" },
      { number: "129", title: "Cual Jes√∫s no hay otro nombre", file: "129 - Cual Jes√∫s no hay otro nombre.json" },
      { number: "130", title: "Cristo, Cristo, Cristo", file: "130 - Cristo, Cristo, Cristo.json" },
      { number: "131", title: "Bendito es el nombre de Jes√∫s", file: "131 - Bendito es el nombre de Jes√∫s.json" },
      { number: "132", title: "Dulce, hermoso nombre es Jes√∫s", file: "132 - Dulce, hermoso nombre es Jes√∫s.json" },
      { number: "133", title: "Venid, con c√°nticos venid", file: "133 - Venid, con c√°nticos venid.json" },
      { number: "134", title: "Cual mirra fragante", file: "134 - Cual mirra fragante.json" },
      { number: "135", title: "Cristo, nombre sublime", file: "135 - Cristo, nombre sublime.json" },
      { number: "136", title: "¬°Oh, cu√°nto amo a Cristo!", file: "136 - ¬°Oh, cu√°nto amo a Cristo!.json" },
      { number: "137", title: "De Jes√∫s el nombre invoca", file: "137 - De Jes√∫s el nombre invoca.json" },
      { number: "138", title: "De mi amante Salvador", file: "138 - De mi amante Salvador.json" },
      { number: "139", title: "La tierna voz del Salvador", file: "139 - La tierna voz del Salvador.json" },
      { number: "140", title: "Te quiero, te quiero", file: "140 - Te quiero, te quiero.json" },
      { number: "141", title: "¬°Alabadle!", file: "141 - ¬°Alabadle!.json" },
      { number: "142", title: "Venid, cantad de gozo en plenitud", file: "142 - Venid, cantad de gozo en plenitud.json" },
      { number: "143", title: "Digno eres t√∫", file: "143 - Digno eres t√∫.json" },
      { number: "144", title: "Mi Salvador", file: "144 - Mi Salvador.json" },
      { number: "145", title: "Con acentos de alegr√≠a", file: "145 - Con acentos de alegr√≠a.json" },
      { number: "146", title: "Ni en la tierra", file: "146 - Ni en la tierra.json" },
      { number: "147", title: "A Dios sea gloria", file: "147 - A Dios sea gloria.json" },
      { number: "148", title: "Solo Cristo", file: "148 - Solo Cristo.json" },
      { number: "149", title: "Junto a la cruz do Jes√∫s muri√≥", file: "149 - Junto a la cruz do Jes√∫s muri√≥.json" },
      { number: "150", title: "A Cristo doy mi canto", file: "150 - A Cristo doy mi canto.json" },
      { number: "151", title: "Por eso lo amo", file: "151 - Por eso lo amo.json" },
      { number: "152", title: "A ti, Jes√∫s", file: "152 - A ti, Jes√∫s.json" },
      { number: "153", title: "Ved a Cristo", file: "153 - Ved a Cristo.json" },
      { number: "154", title: "Dad gloria al Cordero Rey", file: "154 - Dad gloria al Cordero Rey.json" },
      { number: "155", title: "En Sion Jes√∫s hoy reina", file: "155 - En Sion Jes√∫s hoy reina.json" },
      { number: "156", title: "A Cristo coronad", file: "156 - A Cristo coronad.json" },
      { number: "157", title: "¬°Majestad!", file: "157 - ¬°Majestad!.json" },
      { number: "158", title: "Amanece ya la ma√±ana de oro", file: "158 - Amanece ya la ma√±ana de oro.json" },
      { number: "159", title: "Yo espero la ma√±ana", file: "159 - Yo espero la ma√±ana.json" },
      { number: "160", title: "Viene otra vez nuestro Salvador", file: "160 - Viene otra vez nuestro Salvador.json" },
      { number: "161", title: "¬°Oh! cu√°n gratas las nuevas", file: "161 - ¬°Oh! cu√°n gratas las nuevas.json" },
      { number: "162", title: "En presencia estar de Cristo", file: "162 - En presencia estar de Cristo.json" },
      { number: "163", title: "Cristo viene, esto es cierto", file: "163 - Cristo viene, esto es cierto.json" },
      { number: "164", title: "Jes√∫s pronto volver√°", file: "164 - Jes√∫s pronto volver√°.json" },
      { number: "165", title: "¬°Vendr√° el Se√±or!", file: "165 - ¬°Vendr√° el Se√±or!.json" },
      { number: "166", title: "Siervos de Dios, la trompeta tocad", file: "166 - Siervos de Dios, la trompeta tocad.json" },
      { number: "167", title: "¬øQui√©n en deslumbrante gloria?", file: "167 - ¬øQui√©n en deslumbrante gloria.json" },
      { number: "168", title: "El Rey que viene", file: "168 - El Rey que viene.json" },
      { number: "169", title: "Cuando suene la trompeta", file: "169 - Cuando suene la trompeta.json" },
      { number: "170", title: "La segunda venida de Cristo", file: "170 - La segunda venida de Cristo.json" },
      { number: "171", title: "¬øHas o√≠do el mensaje?", file: "171 - ¬øHas o√≠do el mensaje.json" },
      { number: "172", title: "Promesa dulce", file: "172 - Promesa dulce.json" },
      { number: "173", title: "¬øSer√° al albor?", file: "173 - ¬øSer√° al albor.json" },
      { number: "174", title: "Mira los hitos", file: "174 - Mira los hitos.json" },
      { number: "175", title: "Ved a Cristo, que se acerca", file: "175 - Ved a Cristo, que se acerca.json" },
      { number: "176", title: "T√∫ ver√°s al Rey viniendo", file: "176 - T√∫ ver√°s al Rey viniendo.json" },
      { number: "177", title: "Los tres mensajes ang√©licos", file: "177 - Los tres mensajes ang√©licos.json" },
      { number: "178", title: "Contempl√© la gloria", file: "178 - Contempl√© la gloria.json" },
      { number: "179", title: "¬°Cristo viene! Aquel d√≠a se acerca", file: "179 - ¬°Cristo viene! Aquel d√≠a se acerca.json" },
      { number: "180", title: "S√≠, lo veremos", file: "180 - S√≠, lo veremos.json" },
      { number: "181", title: "Una esperanza", file: "181 - Una esperanza.json" },
      { number: "182", title: "Veremos a Cristo", file: "182 - Veremos a Cristo.json" },
      { number: "183", title: "No me olvid√© de ti", file: "183 - No me olvid√© de ti.json" },
      { number: "184", title: "Nunca te rindas", file: "184 - Nunca te rindas.json" },
      { number: "185", title: "Al cielo voy", file: "185 - Al cielo voy.json" },
      { number: "186", title: "Hace a√±os escuch√©", file: "186 - Hace a√±os escuch√©.json" },
      { number: "187", title: "Aunque anochezca", file: "187 - Aunque anochezca.json" },
      { number: "188", title: "Gran alegr√≠a", file: "188 - Gran alegr√≠a.json" },
      { number: "189", title: "Cristo muy pronto vendr√°", file: "189 - Cristo muy pronto vendr√°.json" },
      { number: "190", title: "Santo Esp√≠ritu de Cristo", file: "190 - Santo Esp√≠ritu de Cristo.json" },
      { number: "191", title: "La nueva proclamad", file: "191 - La nueva proclamad.json" },
      { number: "192", title: "Llena mi ser", file: "192 - Llena mi ser.json" },
      { number: "193", title: "Dios nos ha dado promesa", file: "193 - Dios nos ha dado promesa.json" },
      { number: "194", title: "Vive en m√≠", file: "194 - Vive en m√≠.json" },
      { number: "195", title: "Abre mis ojos a la luz", file: "195 - Abre mis ojos a la luz.json" },
      { number: "196", title: "Santo Esp√≠ritu de Dios", file: "196 - Santo Esp√≠ritu de Dios.json" },
      { number: "197", title: "Dulce Esp√≠ritu", file: "197 - Dulce Esp√≠ritu.json" },
      { number: "198", title: "Desciende, Esp√≠ritu de amor", file: "198 - Desciende, Esp√≠ritu de amor.json" },
      { number: "199", title: "Movidos por tu Esp√≠ritu", file: "199 - Movidos por tu Esp√≠ritu.json" },
      { number: "200", title: "Baut√≠zanos hoy", file: "200 - Baut√≠zanos hoy.json" },
      { number: "201", title: "Canci√≥n del Esp√≠ritu", file: "201 - Canci√≥n del Esp√≠ritu.json" },
      { number: "202", title: "Danos el fuego", file: "202 - Danos el fuego.json" },
      { number: "203", title: "Santo Esp√≠ritu llena mi vida", file: "203 - Santo Esp√≠ritu llena mi vida.json" },
      { number: "204", title: "Oh, cant√°dmelas otra vez", file: "204 - Oh, cant√°dmelas otra vez.json" },
      { number: "205", title: "Dadme la Biblia", file: "205 - Dadme la Biblia.json" },
      { number: "206", title: "Padre, tu Palabra es mi delicia", file: "206 - Padre, tu Palabra es mi delicia.json" },
      { number: "207", title: "Dios nos habla", file: "207 - Dios nos habla.json" },
      { number: "208", title: "¬°Santa Biblia!", file: "208 - ¬°Santa Biblia!.json" },
      { number: "209", title: "La Biblia nos habla de Cristo", file: "209 - La Biblia nos habla de Cristo.json" },
      { number: "210", title: "Huye cual ave", file: "210 - Huye cual ave.json" },
      { number: "211", title: "Fija tus ojos en Cristo", file: "211 - Fija tus ojos en Cristo.json" },
      { number: "212", title: "A tu puerta Cristo est√°", file: "212 - A tu puerta Cristo est√°.json" },
      { number: "213", title: "Tierno y amante, Jes√∫s nos invita", file: "213 - Tierno y amante, Jes√∫s nos invita.json" },
      { number: "214", title: "Mientras Jes√∫s te llama", file: "214 - Mientras Jes√∫s te llama.json" },
      { number: "215", title: "Con voz benigna te llama Jes√∫s", file: "215 - Con voz benigna te llama Jes√∫s.json" },
      { number: "216", title: "Dios al pr√≥digo llama", file: "216 - Dios al pr√≥digo llama.json" },
      { number: "217", title: "Bienvenida da Jes√∫s", file: "217 - Bienvenida da Jes√∫s.json" },
      { number: "218", title: "A Jesucristo ven sin tardar", file: "218 - A Jesucristo ven sin tardar.json" },
      { number: "219", title: "Tan triste y tan lejos de Dios", file: "219 - Tan triste y tan lejos de Dios.json" },
      { number: "220", title: "All√° la puerta abierta est√°", file: "220 - All√° la puerta abierta est√°.json" },
      { number: "221", title: "Puertas abiertas encontrar√°n", file: "221 - Puertas abiertas encontrar√°n.json" },
      { number: "222", title: "Del trono celestial", file: "222 - Del trono celestial.json" },
      { number: "223", title: "O√≠ la voz del Salvador", file: "223 - O√≠ la voz del Salvador.json" },
      { number: "224", title: "O√≠ la voz del buen Jes√∫s", file: "224 - O√≠ la voz del buen Jes√∫s.json" },
      { number: "225", title: "Un hombre llegose de noche a Jes√∫s", file: "225 - Un hombre llegose de noche a Jes√∫s.json" },
      { number: "226", title: "Buscad primero", file: "226 - Buscad primero.json" },
      { number: "227", title: "Preste o√≠dos el humano", file: "227 - Preste o√≠dos el humano.json" },
      { number: "228", title: "Me buscar√©is y me hallar√©is", file: "228 - Me buscar√©is y me hallar√©is.json" },
      { number: "229", title: "¬øHas pensado lo que puede costar?", file: "229 - ¬øHas pensado lo que puede costar.json" },
      { number: "230", title: "Abre tu coraz√≥n", file: "230 - Abre tu coraz√≥n.json" },
      { number: "231", title: "Todo en el altar", file: "231 - Todo en el altar.json" },
      { number: "232", title: "Entr√©gate en oraci√≥n", file: "232 - Entr√©gate en oraci√≥n.json" },
      { number: "233", title: "Ven a la Fuente de vida", file: "233 - Ven a la Fuente de vida.json" },
      { number: "234", title: "¬øTemes que en la lucha?", file: "234 - ¬øTemes que en la lucha.json" },
      { number: "235", title: "La raz√≥n de vivir", file: "235 - La raz√≥n de vivir.json" },
      { number: "236", title: "A Jes√∫s entrega todo", file: "236 - A Jes√∫s entrega todo.json" },
      { number: "237", title: "Jes√∫s hoy espera entrar en tu ser", file: "237 - Jes√∫s hoy espera entrar en tu ser.json" },
      { number: "238", title: "Yo escucho, buen Jes√∫s", file: "238 - Yo escucho, buen Jes√∫s.json" },
      { number: "239", title: "De Dios vagaba lejos yo", file: "239 - De Dios vagaba lejos yo.json" },
      { number: "240", title: "Te ruego, oh Dios", file: "240 - Te ruego, oh Dios.json" },
      { number: "241", title: "Perd√≥n te ruego, mi Se√±or y Dios", file: "241 - Perd√≥n te ruego, mi Se√±or y Dios.json" },
      { number: "242", title: "Una es, Se√±or, mi petici√≥n", file: "242 - Una es, Se√±or, mi petici√≥n.json" },
      { number: "243", title: "Entrego todo a Cristo", file: "243 - Entrego todo a Cristo.json" },
      { number: "244", title: "Padre, Dios", file: "244 - Padre, Dios.json" },
      { number: "245", title: "C√∫mplase, oh Cristo, tu voluntad", file: "245 - C√∫mplase, oh Cristo, tu voluntad.json" },
      { number: "246", title: "Te quiero, mi Se√±or", file: "246 - Te quiero, mi Se√±or.json" },
      { number: "247", title: "Yo te seguir√©", file: "247 - Yo te seguir√©.json" },
      { number: "248", title: "Que mi vida entera est√©", file: "248 - Que mi vida entera est√©.json" },
      { number: "249", title: "Tal como soy", file: "249 - Tal como soy.json" },
      { number: "250", title: "Padre, a tus pies me postro", file: "250 - Padre, a tus pies me postro.json" },
      { number: "251", title: "No yo, sino √©l", file: "251 - No yo, sino √©l.json" },
      { number: "252", title: "Dejo el mundo", file: "252 - Dejo el mundo.json" },
      { number: "253", title: "Tuyo soy, Jes√∫s", file: "253 - Tuyo soy, Jes√∫s.json" },
      { number: "254", title: "Anhelo ser limpio", file: "254 - Anhelo ser limpio.json" },
      { number: "255", title: "Oh Cristo, te adoro", file: "255 - Oh Cristo, te adoro.json" },
      { number: "256", title: "Jes√∫s, yo he prometido", file: "256 - Jes√∫s, yo he prometido.json" },
      { number: "257", title: "¬°Oh! ven, te invito, Cristo", file: "257 - ¬°Oh! ven, te invito, Cristo.json" },
      { number: "258", title: "T√∫ dejaste tu trono", file: "258 - T√∫ dejaste tu trono.json" },
      { number: "259", title: "Mi esp√≠ritu, alma y cuerpo", file: "259 - Mi esp√≠ritu, alma y cuerpo.json" },
      { number: "260", title: "Junto a la cruz de Cristo", file: "260 - Junto a la cruz de Cristo.json" },
      { number: "261", title: "Salvador, a ti me rindo", file: "261 - Salvador, a ti me rindo.json" },
      { number: "262", title: "Los tesoros del mundo", file: "262 - Los tesoros del mundo.json" },
      { number: "263", title: "Entra en este coraz√≥n", file: "263 - Entra en este coraz√≥n.json" },
      { number: "264", title: "Un d√≠a m√°s por Cristo", file: "264 - Un d√≠a m√°s por Cristo.json" },
      { number: "265", title: "La senda ancha dejar√©", file: "265 - La senda ancha dejar√©.json" },
      { number: "266", title: "Vivo por Cristo", file: "266 - Vivo por Cristo.json" },
      { number: "267", title: "A la cruz de Cristo voy", file: "267 - A la cruz de Cristo voy.json" },
      { number: "268", title: "Puedo o√≠r tu voz llamando", file: "268 - Puedo o√≠r tu voz llamando.json" },
      { number: "269", title: "Prefiero a mi Cristo", file: "269 - Prefiero a mi Cristo.json" },
      { number: "270", title: "Meditar en Jes√∫s", file: "270 - Meditar en Jes√∫s.json" },
      { number: "271", title: "Hoy me llama el mundo en vano", file: "271 - Hoy me llama el mundo en vano.json" },
      { number: "272", title: "De esclavitud", file: "272 - De esclavitud.json" },
      { number: "273", title: "Tu vida, oh Salvador", file: "273 - Tu vida, oh Salvador.json" },
      { number: "274", title: "¬øQu√© te dar√©, Maestro?", file: "274 - ¬øQu√© te dar√©, Maestro.json" },
      { number: "275", title: "Humilde oraci√≥n", file: "275 - Humilde oraci√≥n.json" },
      { number: "276", title: "Con nuestras mentes", file: "276 - Con nuestras mentes.json" },
      { number: "277", title: "Amarte m√°s", file: "277 - Amarte m√°s.json" },
      { number: "278", title: "¬øPuede el mundo ver a Jes√∫s en m√≠?", file: "278 - ¬øPuede el mundo ver a Jes√∫s en m√≠.json" },
      { number: "279", title: "Transf√≥rmame a tu imagen", file: "279 - Transf√≥rmame a tu imagen.json" },
      { number: "280", title: "Ser semejante a Jes√∫s", file: "280 - Ser semejante a Jes√∫s.json" },
      { number: "281", title: "He decidido seguir a Cristo", file: "281 - He decidido seguir a Cristo.json" },
      { number: "282", title: "¬°Brilla, Jes√∫s!", file: "282 - ¬°Brilla, Jes√∫s!.json" },
      { number: "283", title: "Ven, Se√±or Jes√∫s", file: "283 - Ven, Se√±or Jes√∫s.json" },
      { number: "284", title: "Me dice el Salvador", file: "284 - Me dice el Salvador.json" },
      { number: "285", title: "Conf√≠o en Jesucristo", file: "285 - Conf√≠o en Jesucristo.json" },
      { number: "286", title: "Hay una fuente sin igual", file: "286 - Hay una fuente sin igual.json" },
      { number: "287", title: "Rey de mi vida", file: "287 - Rey de mi vida.json" },
      { number: "288", title: "Al contemplarte, mi Salvador", file: "288 - Al contemplarte, mi Salvador.json" },
      { number: "289", title: "¬øQu√© me puede dar perd√≥n?", file: "289 - ¬øQu√© me puede dar perd√≥n.json" },
      { number: "290", title: "Fuente de la vida eterna", file: "290 - Fuente de la vida eterna.json" },
      { number: "291", title: "Perdido, fui a mi Jes√∫s", file: "291 - Perdido, fui a mi Jes√∫s.json" },
      { number: "292", title: "Por fe en Cristo, el Redentor", file: "292 - Por fe en Cristo, el Redentor.json" },
      { number: "293", title: "¬øQuieres ser salvo de toda maldad?", file: "293 - ¬øQuieres ser salvo de toda maldad.json" },
      { number: "294", title: "En Jes√∫s por fe conf√≠o", file: "294 - En Jes√∫s por fe conf√≠o.json" },
      { number: "295", title: "Las manos, Padre", file: "295 - Las manos, Padre.json" },
      { number: "296", title: "Comprado con sangre por Cristo", file: "296 - Comprado con sangre por Cristo.json" },
      { number: "297", title: "Salvado con sangre por Cristo", file: "297 - Salvado con sangre por Cristo.json" },
      { number: "298", title: "Al Calvario, solo, Jes√∫s ascendi√≥", file: "298 - Al Calvario, solo, Jes√∫s ascendi√≥.json" },
      { number: "299", title: "Hay vida en mirar", file: "299 - Hay vida en mirar.json" },
      { number: "300", title: "Lejos de mi Padre Dios", file: "300 - Lejos de mi Padre Dios.json" },
      { number: "301", title: "Cristo es mi amante Salvador", file: "301 - Cristo es mi amante Salvador.json" },
      { number: "302", title: "Grato es contar la historia", file: "302 - Grato es contar la historia.json" },
      { number: "303", title: "Sublime gracia", file: "303 - Sublime gracia.json" },
      { number: "304", title: "Mi Redentor, el Rey de gloria", file: "304 - Mi Redentor, el Rey de gloria.json" },
      { number: "305", title: "Maravillosa su gracia es", file: "305 - Maravillosa su gracia es.json" },
      { number: "306", title: "Lleg√≥ Jes√∫s", file: "306 - Lleg√≥ Jes√∫s.json" },
      { number: "307", title: "Roca de la eternidad", file: "307 - Roca de la eternidad.json" },
      { number: "308", title: "Dios descendi√≥", file: "308 - Dios descendi√≥.json" },
      { number: "309", title: "La voz de Jes√∫s", file: "309 - La voz de Jes√∫s.json" },
      { number: "310", title: "Cristo, centro de mi vida", file: "310 - Cristo, centro de mi vida.json" },
      { number: "311", title: "Cuando junte Jes√∫s las naciones", file: "311 - Cuando junte Jes√∫s las naciones.json" },
      { number: "312", title: "D√≠a grande viene", file: "312 - D√≠a grande viene.json" },
      { number: "313", title: "La hora del Juicio", file: "313 - La hora del Juicio.json" },
      { number: "314", title: "Cristo, Rey omnipotente", file: "314 - Cristo, Rey omnipotente.json" },
      { number: "315", title: "El Juicio empez√≥", file: "315 - El Juicio empez√≥.json" },
      { number: "316", title: "Hay un mundo feliz m√°s all√°", file: "316 - Hay un mundo feliz m√°s all√°.json" },
      { number: "317", title: "En el hogar do nunca habr√°", file: "317 - En el hogar do nunca habr√°.json" },
      { number: "318", title: "En la mansi√≥n de mi Se√±or", file: "318 - En la mansi√≥n de mi Se√±or.json" },
      { number: "319", title: "Cuando mi lucha termine al final", file: "319 - Cuando mi lucha termine al final.json" },
      { number: "320", title: "Jam√°s se dice 'adi√≥s' all√°", file: "320 - Jam√°s se dice adi√≥s all√°.json" },
      { number: "321", title: "All√° sobre montes", file: "321 - All√° sobre montes.json" },
      { number: "322", title: "Busquemos la patria", file: "322 - Busquemos la patria.json" },
      { number: "323", title: "He de conocerle entonces", file: "323 - He de conocerle entonces.json" },
      { number: "324", title: "Pronto yo ver√© a Jes√∫s", file: "324 - Pronto yo ver√© a Jes√∫s.json" },
      { number: "325", title: "No puede el mundo ser mi hogar", file: "325 - No puede el mundo ser mi hogar.json" },
      { number: "326", title: "Un d√≠a yo he de faltar", file: "326 - Un d√≠a yo he de faltar.json" },
      { number: "327", title: "Jerusal√©n, mi amado hogar", file: "327 - Jerusal√©n, mi amado hogar.json" },
      { number: "328", title: "¬øNos veremos junto al r√≠o?", file: "328 - ¬øNos veremos junto al r√≠o.json" },
      { number: "329", title: "En la c√©lica morada", file: "329 - En la c√©lica morada.json" },
      { number: "330", title: "Hay un feliz Ed√©n", file: "330 - Hay un feliz Ed√©n.json" },
      { number: "331", title: "La ma√±ana gloriosa", file: "331 - La ma√±ana gloriosa.json" },
      { number: "332", title: "En la tierra adonde ir√©", file: "332 - En la tierra adonde ir√©.json" },
      { number: "333", title: "Aunque en esta vida", file: "333 - Aunque en esta vida.json" },
      { number: "334", title: "Cu√°nto anhelo llegar", file: "334 - Cu√°nto anhelo llegar.json" },
      { number: "335", title: "Mi hogar celestial", file: "335 - Mi hogar celestial.json" },
      { number: "336", title: "Del bello pa√≠s he le√≠do", file: "336 - Del bello pa√≠s he le√≠do.json" },
      { number: "337", title: "Nunca m√°s adi√≥s", file: "337 - Nunca m√°s adi√≥s.json" },
      { number: "338", title: "Las riberas de dicha inmortal", file: "338 - Las riberas de dicha inmortal.json" },
      { number: "339", title: "A veces oigo un himno", file: "339 - A veces oigo un himno.json" },
      { number: "340", title: "¬°Oh, qu√© m√∫sica divina!", file: "340 - ¬°Oh, qu√© m√∫sica divina!.json" },
      { number: "341", title: "M√°s cerca del hogar", file: "341 - M√°s cerca del hogar.json" },
      { number: "342", title: "Despu√©s del r√≠o", file: "342 - Despu√©s del r√≠o.json" },
      { number: "343", title: "Quiero llegar a ser parte del cielo", file: "343 - Quiero llegar a ser parte del cielo.json" },
      { number: "344", title: "Entonad un himno", file: "344 - Entonad un himno.json" },
      { number: "345", title: "Canta, y tus penas se ir√°n", file: "345 - Canta, y tus penas se ir√°n.json" },
      { number: "346", title: "¬°Feliz el d√≠a!", file: "346 - ¬°Feliz el d√≠a!.json" },
      { number: "347", title: "Con gozo canto al Se√±or", file: "347 - Con gozo canto al Se√±or.json" },
      { number: "348", title: "Dicha grande", file: "348 - Dicha grande.json" },
      { number: "349", title: "Gran gozo hay en mi alma hoy", file: "349 - Gran gozo hay en mi alma hoy.json" },
      { number: "350", title: "Andando en la luz de Dios", file: "350 - Andando en la luz de Dios.json" },
      { number: "351", title: "Yo tengo gozo", file: "351 - Yo tengo gozo.json" },
      { number: "352", title: "Gozaos, Cristo es Rey", file: "352 - Gozaos, Cristo es Rey.json" },
      { number: "353", title: "Suenan melod√≠as en mi ser", file: "353 - Suenan melod√≠as en mi ser.json" },
      { number: "354", title: "Voy caminando", file: "354 - Voy caminando.json" },
      { number: "355", title: "Yo voy feliz", file: "355 - Yo voy feliz.json" },
      { number: "356", title: "Gozo es conocer a Cristo", file: "356 - Gozo es conocer a Cristo.json" },
      { number: "357", title: "Jes√∫s, t√∫ eres mi alegr√≠a", file: "357 - Jes√∫s, t√∫ eres mi alegr√≠a.json" },
      { number: "358", title: "En el seno de mi alma", file: "358 - En el seno de mi alma.json" },
      { number: "359", title: "Regocijaos siempre", file: "359 - Regocijaos siempre.json" },
      { number: "360", title: "En Jesucristo, m√°rtir de paz", file: "360 - En Jesucristo, m√°rtir de paz.json" },
      { number: "361", title: "Percibe mi alma un son", file: "361 - Percibe mi alma un son.json" },
      { number: "362", title: "Con sin igual amor", file: "362 - Con sin igual amor.json" },
      { number: "363", title: "Hay un canto nuevo en mi ser", file: "363 - Hay un canto nuevo en mi ser.json" },
      { number: "364", title: "Jes√∫s da paz", file: "364 - Jes√∫s da paz.json" },
      { number: "365", title: "Elevemos al Se√±or", file: "365 - Elevemos al Se√±or.json" },
      { number: "366", title: "En Cristo hallo amigo", file: "366 - En Cristo hallo amigo.json" },
      { number: "367", title: "Gracias, Dios", file: "367 - Gracias, Dios.json" },
      { number: "368", title: "Padre amado", file: "368 - Padre amado.json" },
      { number: "369", title: "Gratitud y alabanza", file: "369 - Gratitud y alabanza.json" },
      { number: "370", title: "Por la excelsa majestad", file: "370 - Por la excelsa majestad.json" },
      { number: "371", title: "Jes√∫s te ama", file: "371 - Jes√∫s te ama.json" },
      { number: "372", title: "¬øC√≥mo agradecer?", file: "372 - ¬øC√≥mo agradecer.json" },
      { number: "373", title: "Mi Redentor es Cristo", file: "373 - Mi Redentor es Cristo.json" },
      { number: "374", title: "Dulce comuni√≥n", file: "374 - Dulce comuni√≥n.json" },
      { number: "375", title: "Sed puros y santos", file: "375 - Sed puros y santos.json" },
      { number: "376", title: "Dulce oraci√≥n", file: "376 - Dulce oraci√≥n.json" },
      { number: "377", title: "A los pies de Jesucristo", file: "377 - A los pies de Jesucristo.json" },
      { number: "378", title: "¬°Oh, qu√© amigo nos es Cristo!", file: "378 - ¬°Oh, qu√© amigo nos es Cristo!.json" },
      { number: "379", title: "Habla, Se√±or, a mi alma", file: "379 - Habla, Se√±or, a mi alma.json" },
      { number: "380", title: "Ando con Cristo", file: "380 - Ando con Cristo.json" },
      { number: "381", title: "De ma√±ana veo su faz", file: "381 - De ma√±ana veo su faz.json" },
      { number: "382", title: "A solas al huerto yo voy", file: "382 - A solas al huerto yo voy.json" },
      { number: "383", title: "Habla a tu Dios de ma√±ana", file: "383 - Habla a tu Dios de ma√±ana.json" },
      { number: "384", title: "El jard√≠n de oraci√≥n", file: "384 - El jard√≠n de oraci√≥n.json" },
      { number: "385", title: "Hablando con Jes√∫s", file: "385 - Hablando con Jes√∫s.json" },
      { number: "386", title: "Hay un lugar de paz", file: "386 - Hay un lugar de paz.json" },
      { number: "387", title: "Aparte del mundo", file: "387 - Aparte del mundo.json" },
      { number: "388", title: "Debo decir a Cristo", file: "388 - Debo decir a Cristo.json" },
      { number: "389", title: "Conversar con Jesucristo", file: "389 - Conversar con Jesucristo.json" },
      { number: "390", title: "Soy yo, Se√±or", file: "390 - Soy yo, Se√±or.json" },
      { number: "391", title: "¬øLe importar√° a Jes√∫s?", file: "391 - ¬øLe importar√° a Jes√∫s.json" },
      { number: "392", title: "Hay quien vela mis pisadas", file: "392 - Hay quien vela mis pisadas.json" },
      { number: "393", title: "Mi fe contempla a ti", file: "393 - Mi fe contempla a ti.json" },
      { number: "394", title: "¬°Cu√°n firme cimiento!", file: "394 - ¬°Cu√°n firme cimiento!.json" },
      { number: "395", title: "¬°Oh, cu√°n dulce es fiar en Cristo!", file: "395 - ¬°Oh, cu√°n dulce es fiar en Cristo!.json" },
      { number: "396", title: "¬°Oh qu√© Salvador!", file: "396 - ¬°Oh qu√© Salvador!.json" },
      { number: "397", title: "Oh buen Se√±or, velada est√°", file: "397 - Oh buen Se√±or, velada est√°.json" },
      { number: "398", title: "Cuando sopla airada la tempestad", file: "398 - Cuando sopla airada la tempestad.json" },
      { number: "399", title: "En estos tiempos", file: "399 - En estos tiempos.json" },
      { number: "400", title: "Castillo fuerte es nuestro Dios", file: "400 - Castillo fuerte es nuestro Dios.json" },
      { number: "401", title: "Eterna Roca es mi Jes√∫s", file: "401 - Eterna Roca es mi Jes√∫s.json" },
      { number: "402", title: "¬°Oh!, salvo en la Roca", file: "402 - ¬°Oh!, salvo en la Roca.json" },
      { number: "403", title: "Cuando en la lucha", file: "403 - Cuando en la lucha.json" },
      { number: "404", title: "A cualquiera parte", file: "404 - A cualquiera parte.json" },
      { number: "405", title: "S√© qui√©n es Jes√∫s", file: "405 - S√© qui√©n es Jes√∫s.json" },
      { number: "406", title: "Jes√∫s es mi luz", file: "406 - Jes√∫s es mi luz.json" },
      { number: "407", title: "Muy cerca de mi Redentor", file: "407 - Muy cerca de mi Redentor.json" },
      { number: "408", title: "Cristo me ayuda por √©l a vivir", file: "408 - Cristo me ayuda por √©l a vivir.json" },
      { number: "409", title: "Si mi d√©bil fe flaqueare", file: "409 - Si mi d√©bil fe flaqueare.json" },
      { number: "410", title: "Cuando te quiero", file: "410 - Cuando te quiero.json" },
      { number: "411", title: "Bajo sus alas", file: "411 - Bajo sus alas.json" },
      { number: "412", title: "Todas las promesas", file: "412 - Todas las promesas.json" },
      { number: "413", title: "Si la carga es pesada", file: "413 - Si la carga es pesada.json" },
      { number: "414", title: "¬°Oh, buen Maestro, despierta!", file: "414 - ¬°Oh, buen Maestro, despierta!.json" },
      { number: "415", title: "Salvo en los tiernos brazos", file: "415 - Salvo en los tiernos brazos.json" },
      { number: "416", title: "¬°Oh!, tenga yo la ardiente fe", file: "416 - ¬°Oh!, tenga yo la ardiente fe.json" },
      { number: "417", title: "Dame la fe de mi Jes√∫s", file: "417 - Dame la fe de mi Jes√∫s.json" },
      { number: "418", title: "Padre, yo vengo a ti", file: "418 - Padre, yo vengo a ti.json" },
      { number: "419", title: "Por la justicia de Jes√∫s", file: "419 - Por la justicia de Jes√∫s.json" },
      { number: "420", title: "Nunca desmayes", file: "420 - Nunca desmayes.json" },
      { number: "421", title: "Cari√±oso Salvador", file: "421 - Cari√±oso Salvador.json" },
      { number: "422", title: "Nada puede ya faltarme", file: "422 - Nada puede ya faltarme.json" },
      { number: "423", title: "Pertenezco a mi Rey", file: "423 - Pertenezco a mi Rey.json" },
      { number: "424", title: "¬øC√≥mo podr√© estar triste?", file: "424 - ¬øC√≥mo podr√© estar triste.json" },
      { number: "425", title: "D√≠a en d√≠a", file: "425 - D√≠a en d√≠a.json" },
      { number: "426", title: "Tengo paz", file: "426 - Tengo paz.json" },
      { number: "427", title: "Lleva todo tu pesar a Cristo", file: "427 - Lleva todo tu pesar a Cristo.json" },
      { number: "428", title: "Su oveja soy", file: "428 - Su oveja soy.json" },
      { number: "429", title: "√âl puede", file: "429 - √âl puede.json" },
      { number: "430", title: "Solo no estoy", file: "430 - Solo no estoy.json" },
      { number: "431", title: "A √©l mis problema le doy", file: "431 - A √©l mis problema le doy.json" },
      { number: "432", title: "Como el ciervo", file: "432 - Como el ciervo.json" },
      { number: "433", title: "Conmigo marcha un √°ngel", file: "433 - Conmigo marcha un √°ngel.json" },
      { number: "434", title: "Jes√∫s es mi vida", file: "434 - Jes√∫s es mi vida.json" },
      { number: "435", title: "Dios sabe, Dios oye, Dios ve", file: "435 - Dios sabe, Dios oye, Dios ve.json" },
      { number: "436", title: "√âl vive hoy", file: "436 - √âl vive hoy.json" },
      { number: "437", title: "Tu presencia, Padre amado, da consuelo", file: "437 - Tu presencia, Padre amado, da consuelo.json" },
      { number: "438", title: "Mira hacia Dios", file: "438 - Mira hacia Dios.json" },
      { number: "439", title: "¬°Oh!, qui√©n pudiera andar con Dios", file: "439 - ¬°Oh!, qui√©n pudiera andar con Dios.json" },
      { number: "440", title: "Quiero, Jes√∫s, contigo andar", file: "440 - Quiero, Jes√∫s, contigo andar.json" },
      { number: "441", title: "Jes√∫s, te necesito", file: "441 - Jes√∫s, te necesito.json" },
      { number: "442", title: "¬°Oh! ¬°Maestro y Salvador!", file: "442 - ¬°Oh! ¬°Maestro y Salvador!.json" },
      { number: "443", title: "Hay un lugar do quiero estar, cerca de ti", file: "443 - Hay un lugar do quiero estar, cerca de ti.json" },
      { number: "444", title: "No me pases", file: "444 - No me pases.json" },
      { number: "445", title: "M√°s de Jes√∫s", file: "445 - M√°s de Jes√∫s.json" },
      { number: "446", title: "M√°s cerca, oh Dios, de ti", file: "446 - M√°s cerca, oh Dios, de ti.json" },
      { number: "447", title: "M√°s santidad dame", file: "447 - M√°s santidad dame.json" },
      { number: "448", title: "Salvador, mi bien eterno", file: "448 - Salvador, mi bien eterno.json" },
      { number: "449", title: "Cristo, mi piloto s√©", file: "449 - Cristo, mi piloto s√©.json" },
      { number: "450", title: "¬°Oh Jes√∫s, Pastor divino!", file: "450 - ¬°Oh Jes√∫s, Pastor divino!.json" },
      { number: "451", title: "Cerca, m√°s cerca", file: "451 - Cerca, m√°s cerca.json" },
      { number: "452", title: "Contigo quiero andar", file: "452 - Contigo quiero andar.json" },
      { number: "453", title: "C√≥mo ser cual Cristo", file: "453 - C√≥mo ser cual Cristo.json" },
      { number: "454", title: "Yo quisiera andar con Cristo", file: "454 - Yo quisiera andar con Cristo.json" },
      { number: "455", title: "Mi mano ten", file: "455 - Mi mano ten.json" },
      { number: "456", title: "Como la mujer de junto al pozo", file: "456 - Como la mujer de junto al pozo.json" },
      { number: "457", title: "More en m√≠ la belleza del Salvador", file: "457 - More en m√≠ la belleza del Salvador.json" },
      { number: "458", title: "Orad por m√≠", file: "458 - Orad por m√≠.json" },
      { number: "459", title: "H√°blame m√°s de Cristo", file: "459 - H√°blame m√°s de Cristo.json" },
      { number: "460", title: "Quiero estar cerca de Cristo", file: "460 - Quiero estar cerca de Cristo.json" },
      { number: "461", title: "A tu lado anhelo estar", file: "461 - A tu lado anhelo estar.json" },
      { number: "462", title: "Dame a Cristo", file: "462 - Dame a Cristo.json" },
      { number: "463", title: "Mi oraci√≥n", file: "463 - Mi oraci√≥n.json" },
      { number: "464", title: "Ven, insp√≠ranos", file: "464 - Ven, insp√≠ranos.json" },
      { number: "465", title: "Ven junto a m√≠", file: "465 - Ven junto a m√≠.json" },
      { number: "466", title: "Gu√≠ame, ¬°oh Salvador!", file: "466 - Gu√≠ame, ¬°oh Salvador!.json" },
      { number: "467", title: "¬°Siempre el Salvador conmigo!", file: "467 - ¬°Siempre el Salvador conmigo!.json" },
      { number: "468", title: "Paso a paso Dios me gu√≠a", file: "468 - Paso a paso Dios me gu√≠a.json" },
      { number: "469", title: "Jes√∫s me gu√≠a", file: "469 - Jes√∫s me gu√≠a.json" },
      { number: "470", title: "Gu√≠ame, Dios", file: "470 - Gu√≠ame, Dios.json" },
      { number: "471", title: "Cond√∫ceme, Maestro", file: "471 - Cond√∫ceme, Maestro.json" },
      { number: "472", title: "Jes√∫s, mi gu√≠a es", file: "472 - Jes√∫s, mi gu√≠a es.json" },
      { number: "473", title: "H√°blame, y hablar√©", file: "473 - H√°blame, y hablar√©.json" },
      { number: "474", title: "¬øQu√© me importan?", file: "474 - ¬øQu√© me importan.json" },
      { number: "475", title: "El camino es escabroso", file: "475 - El camino es escabroso.json" },
      { number: "476", title: "¬øMuy lejos el hogar est√°?", file: "476 - ¬øMuy lejos el hogar est√°.json" },
      { number: "477", title: "Los que aman al Se√±or", file: "477 - Los que aman al Se√±or.json" },
      { number: "478", title: "S√© fiel siempre, hermano", file: "478 - S√© fiel siempre, hermano.json" },
      { number: "479", title: "De la mano, Se√±or", file: "479 - De la mano, Se√±or.json" },
      { number: "480", title: "Digno eres, oh Se√±or", file: "480 - Digno eres, oh Se√±or.json" },
      { number: "481", title: "Voy al cielo", file: "481 - Voy al cielo.json" },
      { number: "482", title: "Quiero cantar", file: "482 - Quiero cantar.json" },
      { number: "483", title: "Cuando al cielo lleguemos", file: "483 - Cuando al cielo lleguemos.json" },
      { number: "484", title: "Busca al Se√±or", file: "484 - Busca al Se√±or.json" },
      { number: "485", title: "Unidos en verdad", file: "485 - Unidos en verdad.json" },
      { number: "486", title: "En los pasos de Jes√∫s", file: "486 - En los pasos de Jes√∫s.json" },
      { number: "487", title: "Cristo, eres justo Rey", file: "487 - Cristo, eres justo Rey.json" },
      { number: "488", title: "Al andar con Jes√∫s", file: "488 - Al andar con Jes√∫s.json" },
      { number: "489", title: "Solo anhelo, Cristo amado", file: "489 - Solo anhelo, Cristo amado.json" },
      { number: "490", title: "Mejor que los sacrificios", file: "490 - Mejor que los sacrificios.json" },
      { number: "491", title: "Lev√°ntate, cristiano", file: "491 - Lev√°ntate, cristiano.json" },
      { number: "492", title: "¬°Trabajad! ¬°Trabajad!", file: "492 - ¬°Trabajad! ¬°Trabajad!.json" },
      { number: "493", title: "Hoy quiero trabajar contigo", file: "493 - Hoy quiero trabajar contigo.json" },
      { number: "494", title: "Cerca un alma agobiada est√°", file: "494 - Cerca un alma agobiada est√°.json" },
      { number: "495", title: "Mi deber", file: "495 - Mi deber.json" },
      { number: "496", title: "Sus manos somos", file: "496 - Sus manos somos.json" },
      { number: "497", title: "Manos", file: "497 - Manos.json" },
      { number: "498", title: "Puedes demostrar con tus manos", file: "498 - Puedes demostrar con tus manos.json" },
      { number: "499", title: "Jes√∫s anduvo por aqu√≠", file: "499 - Jes√∫s anduvo por aqu√≠.json" },
      { number: "500", title: "Hazme tu siervo", file: "500 - Hazme tu siervo.json" },
      { number: "501", title: "Mi vida al servicio de Dios", file: "501 - Mi vida al servicio de Dios.json" },
      { number: "502", title: "Brilla en el sitio donde est√©s", file: "502 - Brilla en el sitio donde est√©s.json" },
      { number: "503", title: "Oh Dios, que deseas la vida", file: "503 - Oh Dios, que deseas la vida.json" },
      { number: "504", title: "Se√±or de todos", file: "504 - Se√±or de todos.json" },
      { number: "505", title: "Hijo del reino", file: "505 - Hijo del reino.json" },
      { number: "506", title: "¬°De pie, de pie, cristianos!", file: "506 - ¬°De pie, de pie, cristianos!.json" },
      { number: "507", title: "Tentado, no cedas", file: "507 - Tentado, no cedas.json" },
      { number: "508", title: "Contendamos siempre por nuestra fe", file: "508 - Contendamos siempre por nuestra fe.json" },
      { number: "509", title: "¬°Firmes! ¬°Fuertes!", file: "509 - ¬°Firmes! ¬°Fuertes!.json" },
      { number: "510", title: "¬øQui√©n est√° por Cristo?", file: "510 - ¬øQui√©n est√° por Cristo.json" },
      { number: "511", title: "Marchar√© en la divina luz", file: "511 - Marchar√© en la divina luz.json" },
      { number: "512", title: "Nunca est√©is desanimados", file: "512 - Nunca est√©is desanimados.json" },
      { number: "513", title: "Honra al hombre de valor", file: "513 - Honra al hombre de valor.json" },
      { number: "514", title: "¬°Despertad, despertad, oh cristianos!", file: "514 - ¬°Despertad, despertad, oh cristianos!.json" },
      { number: "515", title: "Despliegue el cristiano su santa bandera", file: "515 - Despliegue el cristiano su santa bandera.json" },
      { number: "516", title: "¬°Firmes y adelante!", file: "516 - ¬°Firmes y adelante!.json" },
      { number: "517", title: "De pie, oh grey de Dios", file: "517 - De pie, oh grey de Dios.json" },
      { number: "518", title: "Jes√∫s est√° buscando voluntarios hoy", file: "518 - Jes√∫s est√° buscando voluntarios hoy.json" },
      { number: "519", title: "Despierta, hermano, sin demorar", file: "519 - Despierta, hermano, sin demorar.json" },
      { number: "520", title: "¬°Adelante! manda el Se√±or", file: "520 - ¬°Adelante! manda el Se√±or.json" },
      { number: "521", title: "Al Cristo ved", file: "521 - Al Cristo ved.json" },
      { number: "522", title: "Suenen las palabras", file: "522 - Suenen las palabras.json" },
      { number: "523", title: "Los sabios dan su ciencia", file: "523 - Los sabios dan su ciencia.json" },
      { number: "524", title: "Tra√≠an en silencio presentes al Se√±or", file: "524 - Tra√≠an en silencio presentes al Se√±or.json" },
      { number: "525", title: "Con gratitud, llegamos", file: "525 - Con gratitud, llegamos.json" },
      { number: "526", title: "Oh, mi patria, te prometo hoy", file: "526 - Oh, mi patria, te prometo hoy.json" },
      { number: "527", title: "Se√±or Jehov√°, omnipotente Dios", file: "527 - Se√±or Jehov√°, omnipotente Dios.json" },
      { number: "528", title: "Por monta√±as, muy cansado", file: "528 - Por monta√±as, muy cansado.json" },
      { number: "529", title: "Iglesia de Cristo", file: "529 - Iglesia de Cristo.json" },
      { number: "530", title: "Somos un peque√±o pueblo muy feliz", file: "530 - Somos un peque√±o pueblo muy feliz.json" },
      { number: "531", title: "La familia de Dios", file: "531 - La familia de Dios.json" },
      { number: "532", title: "Sagrado es el amor", file: "532 - Sagrado es el amor.json" },
      { number: "533", title: "Cu√°n bueno y agradable", file: "533 - Cu√°n bueno y agradable.json" },
      { number: "534", title: "En tu nombre comenzamos", file: "534 - En tu nombre comenzamos.json" },
      { number: "535", title: "Las faenas terminadas", file: "535 - Las faenas terminadas.json" },
      { number: "536", title: "En sombras de la tarde", file: "536 - En sombras de la tarde.json" },
      { number: "537", title: "S√°bado santo", file: "537 - S√°bado santo.json" },
      { number: "538", title: "Hoy es d√≠a de reposo", file: "538 - Hoy es d√≠a de reposo.json" },
      { number: "539", title: "¬°Oh, d√≠a delicioso!", file: "539 - ¬°Oh, d√≠a delicioso!.json" },
      { number: "540", title: "Ya asoma el sol brillante", file: "540 - Ya asoma el sol brillante.json" },
      { number: "541", title: "Se√±or, reposamos", file: "541 - Se√±or, reposamos.json" },
      { number: "542", title: "Amo tu s√°bado", file: "542 - Amo tu s√°bado.json" },
      { number: "543", title: "No te olvides nunca del d√≠a del Se√±or", file: "543 - No te olvides nunca del d√≠a del Se√±or.json" },
      { number: "544", title: "Hoy el s√°bado glorioso", file: "544 - Hoy el s√°bado glorioso.json" },
      { number: "545", title: "Santo d√≠a", file: "545 - Santo d√≠a.json" },
      { number: "546", title: "Santo s√°bado, bendito", file: "546 - Santo s√°bado, bendito.json" },
      { number: "547", title: "S√°bado es", file: "547 - S√°bado es.json" },
      { number: "548", title: "Mi coraz√≥n se llena de alegr√≠a", file: "548 - Mi coraz√≥n se llena de alegr√≠a.json" },
      { number: "549", title: "Ya el fin se acerca", file: "549 - Ya el fin se acerca.json" },
      { number: "550", title: "D√≠a santo del Se√±or", file: "550 - D√≠a santo del Se√±or.json" },
      { number: "551", title: "Embajador soy de mi Rey", file: "551 - Embajador soy de mi Rey.json" },
      { number: "552", title: "¬°Oh!, cu√°nto necesita", file: "552 - ¬°Oh!, cu√°nto necesita.json" },
      { number: "553", title: "¬øOs pusisteis a arar?", file: "553 - ¬øOs pusisteis a arar.json" },
      { number: "554", title: "Con Cristo avanza hoy", file: "554 - Con Cristo avanza hoy.json" },
      { number: "555", title: "Hoy gozoso medito", file: "555 - Hoy gozoso medito.json" },
      { number: "556", title: "Yo quiero siempre brillar", file: "556 - Yo quiero siempre brillar.json" },
      { number: "557", title: "¬øQu√© est√°s haciendo por Cristo?", file: "557 - ¬øQu√© est√°s haciendo por Cristo.json" },
      { number: "558", title: "Ama a tus pr√≥jimos", file: "558 - Ama a tus pr√≥jimos.json" },
      { number: "559", title: "No te d√© temor", file: "559 - No te d√© temor.json" },
      { number: "560", title: "Cristo est√° buscando obreros", file: "560 - Cristo est√° buscando obreros.json" },
      { number: "561", title: "Oigo del Se√±or la voz llamando", file: "561 - Oigo del Se√±or la voz llamando.json" },
      { number: "562", title: "Esparcid la luz de Cristo", file: "562 - Esparcid la luz de Cristo.json" },
      { number: "563", title: "Escuchad, Jes√∫s nos dice", file: "563 - Escuchad, Jes√∫s nos dice.json" },
      { number: "564", title: "Pronto la noche viene", file: "564 - Pronto la noche viene.json" },
      { number: "565", title: "¬°Ve, ve oh Sion!", file: "565 - ¬°Ve, ve oh Sion!.json" },
      { number: "566", title: "Centinelas del Maestro", file: "566 - Centinelas del Maestro.json" },
      { number: "567", title: "Si en valles de peligros", file: "567 - Si en valles de peligros.json" },
      { number: "568", title: "Hay lugar en la amplia vi√±a", file: "568 - Hay lugar en la amplia vi√±a.json" },
      { number: "569", title: "Id Y predicad el evangelio", file: "569 - Id Y predicad el evangelio.json" },
      { number: "570", title: "Voluntario del Se√±or", file: "570 - Voluntario del Se√±or.json" },
      { number: "571", title: "La historia de Cristo contemos", file: "571 - La historia de Cristo contemos.json" },
      { number: "572", title: "Pescadores de hombres", file: "572 - Pescadores de hombres.json" },
      { number: "573", title: "Te env√≠o a ti", file: "573 - Te env√≠o a ti.json" },
      { number: "574", title: "Testimonio", file: "574 - Testimonio.json" },
      { number: "575", title: "Tocad trompeta ya", file: "575 - Tocad trompeta ya.json" },
      { number: "576", title: "Proclamo hoy que soy cristiano", file: "576 - Proclamo hoy que soy cristiano.json" },
      { number: "577", title: "Yo quiero trabajar", file: "577 - Yo quiero trabajar.json" },
      { number: "578", title: "El pueblo que conoce a su Dios", file: "578 - El pueblo que conoce a su Dios.json" },
      { number: "579", title: "La fuente veo", file: "579 - La fuente veo.json" },
      { number: "580", title: "Las aguas del bautismo", file: "580 - Las aguas del bautismo.json" },
      { number: "581", title: "El Pan de vida soy", file: "581 - El Pan de vida soy.json" },
      { number: "582", title: "Hoy venimos cual hermanos", file: "582 - Hoy venimos cual hermanos.json" },
      { number: "583", title: "La Cena de la Comuni√≥n", file: "583 - La Cena de la Comuni√≥n.json" },
      { number: "584", title: "Am√©monos, hermanos", file: "584 - Am√©monos, hermanos.json" },
      { number: "585", title: "De rodillas partimos hoy el pan", file: "585 - De rodillas partimos hoy el pan.json" },
      { number: "586", title: "En memoria de m√≠", file: "586 - En memoria de m√≠.json" },
      { number: "587", title: "Te dedicamos, oh Se√±or", file: "587 - Te dedicamos, oh Se√±or.json" },
      { number: "588", title: "Ven, alma que lloras", file: "588 - Ven, alma que lloras.json" },
      { number: "589", title: "Perfecto amor", file: "589 - Perfecto amor.json" },
      { number: "590", title: "Gu√≠a a ti, Se√±or", file: "590 - Gu√≠a a ti, Se√±or.json" },
      { number: "591", title: "Todo es bello en el hogar", file: "591 - Todo es bello en el hogar.json" },
      { number: "592", title: "Si Dios est√°, ¬°feliz hogar!", file: "592 - Si Dios est√°, ¬°feliz hogar!.json" },
      { number: "593", title: "Hogar de mis recuerdos", file: "593 - Hogar de mis recuerdos.json" },
      { number: "594", title: "Se√±or, gracias por mi hogar", file: "594 - Se√±or, gracias por mi hogar.json" },
      { number: "595", title: "Feliz hogar", file: "595 - Feliz hogar.json" },
      { number: "596", title: "Edificamos familias", file: "596 - Edificamos familias.json" },
      { number: "597", title: "Oraci√≥n por un ni√±o", file: "597 - Oraci√≥n por un ni√±o.json" },
      { number: "598", title: "Cristo, yo te seguir√©", file: "598 - Cristo, yo te seguir√©.json" },
      { number: "599", title: "En este bello d√≠a", file: "599 - En este bello d√≠a.json" },
      { number: "600", title: "Cuando venga Jesucristo", file: "600 - Cuando venga Jesucristo.json" },
      { number: "601", title: "Cuando leo en la Biblia", file: "601 - Cuando leo en la Biblia.json" },
      { number: "602", title: "Es el amor divino", file: "602 - Es el amor divino.json" },
      { number: "603", title: "Yo temprano busco a Cristo", file: "603 - Yo temprano busco a Cristo.json" },
      { number: "604", title: "Bellas las manitas son", file: "604 - Bellas las manitas son.json" },
      { number: "605", title: "Jes√∫s tiene tiempo", file: "605 - Jes√∫s tiene tiempo.json" },
      { number: "606", title: "Llama Jes√∫s, el Buen Pastor", file: "606 - Llama Jes√∫s, el Buen Pastor.json" },
      { number: "607", title: "N√≠tido rayo por Cristo", file: "607 - N√≠tido rayo por Cristo.json" },
      { number: "608", title: "Corazones siempre alegres", file: "608 - Corazones siempre alegres.json" },
      { number: "609", title: "¬°Oh j√≥venes, venid!", file: "609 - ¬°Oh j√≥venes, venid!.json" },
      { number: "610", title: "Escuchamos tu llamada", file: "610 - Escuchamos tu llamada.json" },
      { number: "611", title: "Oh, juventud del Rey", file: "611 - Oh, juventud del Rey.json" },
      { number: "612", title: "Jes√∫s te necesita hoy", file: "612 - Jes√∫s te necesita hoy.json" },
    ];
    
    return [...himnos];
  } catch (err) {
    console.error('Error al obtener el √≠ndice de himnos:', err);
    return [];
  }
}

/**
 * Carga la letra de un himno espec√≠fico.
 * @param {string} hymnFileName - Nombre del archivo JSON del himno
 * @returns {Promise<Object>} Objeto con la letra del himno
 */
async function parseHymn(hymnFileName) {
  try {
    const response = await fetch(`/src/assets/himnos/letra/${hymnFileName}`);
    if (!response.ok) throw new Error('No se pudo cargar el himno');
    const data = await response.json();
    
    // Extraer el n√∫mero del nombre del archivo (ej: "246 - Te quiero, mi Se√±or.json" -> "246")
    const numeroMatch = hymnFileName.match(/^(\d+)/);
    const numero = numeroMatch ? numeroMatch[1] : '';
    
    // Usar el t√≠tulo original del JSON sin filtrar
    const tituloOriginal = data.title || 'Himno';
    
    // Convertir la estructura de sections a estrofas
    const himno = {
      titulo: tituloOriginal, // Usar el t√≠tulo original sin filtrar
      numero: numero, // Usar el n√∫mero extra√≠do del nombre del archivo
      estrofas: [],
      sections: data.sections || {}
    };
    
    // Agregar el t√≠tulo como primera estrofa (√≠ndice 0)
    const tituloLimpio = tituloOriginal.replace(/^Himno\s*#?\d*\s*/, '').trim();
    himno.estrofas.push({
      verso: 'titulo',
      texto: `${numero} | ${tituloLimpio}`,
      sectionKey: 'titulo'
    });
    
    // Procesar las secciones y convertirlas a estrofas (empezando desde √≠ndice 1)
    if (data.sections) {
      const sectionKeys = Object.keys(data.sections).sort((a, b) => parseInt(a) - parseInt(b));
      
      sectionKeys.forEach(sectionKey => {
        const section = data.sections[sectionKey];
        if (section && section.text && Array.isArray(section.text)) {
          // Unir las l√≠neas de texto en una sola estrofa
          const textoCompleto = section.text.join('\n');
          
          himno.estrofas.push({
            verso: section.verse || sectionKey,
            texto: textoCompleto,
            sectionKey: sectionKey
          });
        }
      });
    }
    
    console.log('üìñ Himno cargado:', {
      numero: himno.numero,
      titulo: himno.titulo,
      estrofas: himno.estrofas.length,
      estructura: himno.estrofas.map((e, i) => `${i}: ${e.verso}`)
    });
    
    return himno;
  } catch (err) {
    console.error('Error al cargar el himno:', err);
    return null;
  }
}

// Hacer las funciones disponibles globalmente
console.log('üåê Haciendo funciones disponibles globalmente...');
window.getBibleVersions = getBibleVersions;
window.parseBible = parseBible;
window.getHymnIndex = getHymnIndex;
window.parseHymn = parseHymn;
console.log('‚úÖ dataManager.js cargado completamente');



// church_display/src\js\main.js
// main.js - Script normal (no m√≥dulo)

// Funci√≥n para detectar el modo actual (debe estar al inicio)
function esModoBiblia() {
  return window.modoActual === 'biblia';
}

console.log('üöÄ main.js iniciando...');

// Variables globales
let proyectorWindow = null;
let proyectorPendienteClick = false;
let socket = null; // Esta ser√° global
let bibliaActual = null;
let indiceHimnos = [];
let capituloActivo = null;
let versiculoActivoIndex = -1;
let estrofaActivaIndex = -1;
let libroActivo = null;
let himnoActivo = null;
// √çndices de selecci√≥n para navegaci√≥n con teclado
let libroSugeridoIndex = -1;
let himnoSugeridoIndex = -1;

// Referencias a elementos del DOM
let elementos = {};

// --- NUEVO: Referencias para la UI mejorada ---
let topBarTitulo = null;
let btnCambiarVista = null;
let vistaPreviaContainer = null;
let vistaPrevia = null;
let vistaProyector = null;
let zonaRetroceder = null;
let zonaAvanzar = null;
let proyectorPreviewContent = null;
let vistaActual = 'lista'; // 'lista' o 'proyector'

// Variable global para saber si est√° sonando el himno
let himnoSonando = false;
let fadeOutTimeout = null;
// Modo de audio: 'cantado', 'instrumental', 'soloLetra'
let audioMode = 'cantado';

let miniProyectorVideo = null;
let miniProyectorAspect = 16/9; // Valor por defecto
let miniProyectorContainer = null;

console.log('üì¶ Variables globales inicializadas');

/**
 * Inicializa SocketIO
 */
function inicializarSocketIO() {
  console.log('üîå Iniciando SocketIO...');
  console.log('üîç SocketIO disponible:', typeof io !== 'undefined' ? 'S√≠' : 'No');
  
  try {
    // Conectar a SocketIO
    console.log('üì° Creando conexi√≥n SocketIO...');
    socket = io();
    // Hacer socket global
    window.socket = socket;
    
    console.log('üì° SocketIO creado:', socket);
    console.log('üåê Socket global asignado:', window.socket);
    
    // Eventos de conexi√≥n
    socket.on('connect', () => {
      console.log('‚úÖ Conectado al servidor SocketIO - ID:', socket.id);
      console.log('üåê URL del servidor:', window.location.hostname + ':' + window.location.port);
    });
    
    socket.on('disconnect', () => {
      console.log('‚ùå Desconectado del servidor SocketIO');
    });
    
    socket.on('connect_error', (error) => {
      console.error('‚ùå Error de conexi√≥n SocketIO:', error);
      console.error('üîç Detalles del error:', {
        message: error.message,
        description: error.description,
        context: error.context
      });
    });
    
    // Agregar m√°s eventos para debugging
    socket.on('error', (error) => {
      console.error('‚ùå Error general de SocketIO:', error);
    });
    
    // Evento para cuando el audio termina naturalmente
    socket.on('audioTerminado', (data) => {
      console.log('üì• Audio terminado naturalmente:', data);
      himnoSonando = false;
      actualizarBotonPlayHimno();
    });
    // Evento para cuando el proyector recibe un click
    socket.on('proyectorClick', () => {
      console.log('Evento proyectorClick recibido en el panel de control');
      proyectorPendienteClick = false;
      const boton = document.getElementById('abrirProyector');
      if (boton) {
        boton.style.display = 'none';
        boton.style.pointerEvents = '';
        boton.style.cursor = '';
      }
    });

    // Handler de proyectorAbierto
    socket.on('proyectorAbierto', () => {
      proyectorPendienteClick = true;
      const boton = document.getElementById('abrirProyector');
      if (boton) {
        boton.classList.add('proyector-abierto');
        boton.classList.remove('proyector-normal');
        boton.style.display = '';
        boton.textContent = 'No olvides hacer click en el proyector';
        boton.style.pointerEvents = 'none';
        boton.style.cursor = 'not-allowed';
      }
      actualizarVisibilidadBotonProyector();
    });
    // Handler de proyectorCerrado
    socket.on('proyectorCerrado', () => {
      proyectorPendienteClick = false;
      const boton = document.getElementById('abrirProyector');
      if (boton) {
        boton.classList.remove('proyector-abierto');
        boton.classList.add('proyector-normal');
        boton.style.display = '';
        boton.textContent = 'Abrir Ventana de Proyecci√≥n';
        boton.style.pointerEvents = '';
        boton.style.cursor = '';
      }
      actualizarVisibilidadBotonProyector();
    });

    // Estado inicial del proyector
    socket.on('estadoProyector', (data) => {
      const boton = document.getElementById('abrirProyector');
      if (data && typeof data.abierto !== 'undefined' && boton) {
        if (data.abierto) {
          proyectorPendienteClick = true;
          boton.classList.add('proyector-abierto');
          boton.classList.remove('proyector-normal');
          boton.style.display = '';
          boton.textContent = 'No olvides hacer click en el proyector';
          boton.style.pointerEvents = 'none';
          boton.style.cursor = 'not-allowed';
        } else {
          proyectorPendienteClick = false;
          boton.classList.remove('proyector-abierto');
          boton.classList.add('proyector-normal');
          boton.style.display = '';
          boton.textContent = 'Abrir Ventana de Proyecci√≥n';
          boton.style.pointerEvents = '';
          boton.style.cursor = '';
        }
        actualizarVisibilidadBotonProyector();
      }
    });

    console.log('üîå SocketIO inicializado correctamente');
  } catch (error) {
    console.error('‚ùå Error al inicializar SocketIO:', error);
  }
}

/**
 * Env√≠a mensaje al proyector
 */
function enviarMensajeProyector(tipo, data) {
  console.log('üì§ Intentando enviar mensaje:', { tipo, data });
  console.log('üîå Estado del socket:', {
    existe: !!socket,
    conectado: socket ? socket.connected : false,
    id: socket ? socket.id : 'N/A'
  });
  
  if (!socket) {
    console.error('‚ùå SocketIO no inicializado');
    return false;
  }
  
  if (!socket.connected) {
    console.error('‚ùå SocketIO no conectado');
    return false;
  }
  
  try {
    socket.emit(tipo, data);
    console.log(`‚úÖ Mensaje enviado exitosamente: ${tipo}`, data);
    return true;
  } catch (error) {
    console.error('‚ùå Error al enviar mensaje:', error);
    return false;
  }
}

/**
 * Env√≠a un vers√≠culo al proyector
 */
function enviarVersiculoAlProyector(versiculoIndex) {
  if (!bibliaActual || !libroActivo || capituloActivo === null || versiculoIndex < 0) {
    console.warn('‚ö†Ô∏è No hay vers√≠culo v√°lido para enviar');
    return;
  }

  const versiculo = bibliaActual[libroActivo][capituloActivo][versiculoIndex];
  const referencia = `${libroActivo} ${capituloActivo + 1}:${versiculo.verse}`;
  
  // Obtener configuraci√≥n
  let config = JSON.parse(localStorage.getItem('proyectorConfig')) || { fontsizeBiblia: 5, fontsizeHimnario: 5, soloReferencia: false };
  if (config.soloReferencia) {
    enviarMensajeProyector('update_text', {
      texto: referencia,
      ref: '',
      soloReferencia: true
    });
  } else {
    enviarMensajeProyector('update_text', {
      texto: versiculo.text,
      ref: referencia,
      soloReferencia: false
    });
  }
}

/**
 * Env√≠a una estrofa al proyector
 */
function enviarEstrofaAlProyector(estrofaIndex) {
  if (!himnoActivo || estrofaIndex < 0) {
    console.warn('‚ö†Ô∏è No hay estrofa v√°lida para enviar');
    return;
  }

  const estrofa = himnoActivo.estrofas[estrofaIndex];
  const esTitulo = estrofaIndex === 0;
  
  // Usar el t√≠tulo tal cual viene del JSON
  const tituloLimpio = himnoActivo.titulo;
  
  // Debug: Log para verificar el t√≠tulo
  console.log('üîç Debug t√≠tulo:', {
    tituloLimpio: tituloLimpio,
    numero: himnoActivo.numero
  });
  
  if (esTitulo) {
    // Es el t√≠tulo del himno
    enviarMensajeProyector('update_text', {
      texto: `${himnoActivo.numero} | ${tituloLimpio}`,
      ref: `Himno ${himnoActivo.numero} - ${tituloLimpio}`,
      himnoData: {
        esTitulo: true,
        numero: himnoActivo.numero,
        titulo: tituloLimpio,
        totalEstrofas: himnoActivo.estrofas.length
      }
    });
  } else {
    // Es una estrofa
    const textoEstrofa = estrofa.texto; // Usar el texto de la estrofa
    const versoText = estrofa.verso === 'coro' ? 'Coro' : `Verso ${estrofa.verso}`;
    const ref = `${himnoActivo.numero} | ${tituloLimpio} - ${versoText}`;
    
    enviarMensajeProyector('update_text', {
      texto: textoEstrofa,
      ref: ref,
      himnoData: {
        esTitulo: false,
        numero: himnoActivo.numero,
        titulo: tituloLimpio,
        verso: estrofa.verso,
        estrofaIndex: estrofaIndex,
        totalEstrofas: himnoActivo.estrofas.length,
        seccionActual: estrofaIndex, // El √≠ndice real de la estrofa
        totalSecciones: himnoActivo.estrofas.length - 1 // -1 porque la primera es el t√≠tulo
      }
    });
  }
  
  console.log('üì§ Estrofa enviada al proyector:', {
    index: estrofaIndex,
    esTitulo: esTitulo,
    texto: esTitulo ? `${himnoActivo.numero} | ${tituloLimpio}` : estrofa.texto,
    verso: esTitulo ? 'T√≠tulo' : estrofa.verso
  });
}

/**
 * Inicializa la aplicaci√≥n
 */
async function inicializar() {
  console.log('üöÄ Funci√≥n inicializar() ejecut√°ndose...');
  
  // Inicializar SocketIO primero
  console.log('üîå Llamando a inicializarSocketIO()...');
  inicializarSocketIO();
  
  console.log('üìã Obteniendo referencias a elementos del DOM...');
  // Obtener referencias a elementos del DOM
  elementos = {
    abrirProyector: document.getElementById('abrirProyector'),
    controlBiblia: document.getElementById('controlBiblia'),
    controlHimnario: document.getElementById('controlHimnario'),
    versionBiblia: document.getElementById('versionBiblia'),
    buscarLibro: document.getElementById('buscarLibro'),
    sugerenciasLibros: document.getElementById('sugerenciasLibros'),
    grillaCapitulos: document.getElementById('grillaCapitulos'),
    grillaVersiculos: document.getElementById('grillaVersiculos'),
    buscarHimno: document.getElementById('buscarHimno'),
    listaHimnos: document.getElementById('listaHimnos'),
    vistaPrevia: document.getElementById('vistaPrevia'),
    anterior: document.getElementById('anterior'),
    siguiente: document.getElementById('siguiente'),
    reproductorAudio: document.getElementById('reproductorAudio'),
    btnCantado: document.getElementById('btnCantado'),
    btnInstrumental: document.getElementById('btnInstrumental'),
    btnSoloLetra: document.getElementById('btnSoloLetra')
  };

  // --- NUEVO: Referencias para la UI mejorada ---
  topBarTitulo = document.getElementById('topBarTitulo');
  btnCambiarVista = document.getElementById('btnCambiarVista');
  vistaPreviaContainer = document.getElementById('vistaPreviaContainer');
  vistaPrevia = document.getElementById('vistaPrevia');
  vistaProyector = document.getElementById('vistaProyector');
  zonaRetroceder = document.getElementById('zonaRetroceder');
  zonaAvanzar = document.getElementById('zonaAvanzar');
  proyectorPreviewContent = document.getElementById('proyectorPreviewContent');
  vistaActual = 'lista';

  miniProyectorVideo = document.getElementById('miniProyectorVideo');
  miniProyectorContainer = document.getElementById('vistaProyector');

  // Escuchar relaci√≥n de aspecto del proyector real
  if (window.socket) {
    window.socket.on('aspect_ratio', (data) => {
      if (data && data.aspect) {
        miniProyectorAspect = data.aspect;
        ajustarRelacionAspectoMiniProyector();
      }
    });
  }

  // Estado inicial: solo la lista visible
  if (vistaPrevia) vistaPrevia.style.display = 'block';
  if (vistaProyector) vistaProyector.style.display = 'none';
  actualizarTopBarTitulo();

  // Bot√≥n para alternar vista
  if (btnCambiarVista) {
    btnCambiarVista.addEventListener('click', () => {
      alternarVistaPrevisualizacion();
    });
  }
  // Zonas de navegaci√≥n en modo proyector
  if (zonaRetroceder) {
    zonaRetroceder.addEventListener('click', () => navegar(-1));
  }
  if (zonaAvanzar) {
    zonaAvanzar.addEventListener('click', () => navegar(1));
  }

  console.log('‚úÖ Referencias a elementos obtenidas');

  // --- Configuraci√≥n Panel ---
  const configModal = document.getElementById('configModal');
  const cerrarConfig = document.getElementById('cerrarConfig');
  const sliderFontsizeBiblia = document.getElementById('sliderFontsizeBiblia');
  const fontsizeValueBiblia = document.getElementById('fontsizeValueBiblia');
  const sliderFontsizeHimnario = document.getElementById('sliderFontsizeHimnario');
  const fontsizeValueHimnario = document.getElementById('fontsizeValueHimnario');
  const switchSoloReferencia = document.getElementById('switchSoloReferencia');
  const opcionSoloReferencia = document.getElementById('opcionSoloReferencia');
  const sliderFontBibliaContainer = document.getElementById('sliderFontBibliaContainer');
  const sliderFontHimnarioContainer = document.getElementById('sliderFontHimnarioContainer');

  // Cargar configuraci√≥n guardada
  let config = JSON.parse(localStorage.getItem('proyectorConfig')) || { fontsizeBiblia: 5, fontsizeHimnario: 5, soloReferencia: false };
  sliderFontsizeBiblia.value = config.fontsizeBiblia || 5;
  fontsizeValueBiblia.textContent = (config.fontsizeBiblia || 5) + 'vw';
  sliderFontsizeHimnario.value = config.fontsizeHimnario || 5;
  fontsizeValueHimnario.textContent = (config.fontsizeHimnario || 5) + 'vw';
  switchSoloReferencia.checked = !!config.soloReferencia;

  // Mostrar/ocultar sliders seg√∫n modo
  function actualizarOpcionesModo() {
    const esBiblia = esModoBiblia();
    opcionSoloReferencia.style.display = esBiblia ? '' : 'none';
    sliderFontBibliaContainer.style.display = esBiblia ? '' : 'none';
    sliderFontHimnarioContainer.style.display = esBiblia ? 'none' : '';
  }
  
  // Hacer la funci√≥n global para poder llamarla desde otras funciones
  window.actualizarOpcionesModo = actualizarOpcionesModo;
  
  actualizarOpcionesModo();

  // Cerrar modal
  cerrarConfig.addEventListener('click', () => {
    configModal.style.display = 'none';
  });
  configModal.addEventListener('click', (e) => {
    if (e.target === configModal) configModal.style.display = 'none';
  });

  // Slider de fuente Biblia
  sliderFontsizeBiblia.addEventListener('input', () => {
    fontsizeValueBiblia.textContent = sliderFontsizeBiblia.value + 'vw';
    config.fontsizeBiblia = parseFloat(sliderFontsizeBiblia.value);
    guardarYEnviarConfig();
  });

  // Slider de fuente Himnario
  sliderFontsizeHimnario.addEventListener('input', () => {
    fontsizeValueHimnario.textContent = sliderFontsizeHimnario.value + 'vw';
    config.fontsizeHimnario = parseFloat(sliderFontsizeHimnario.value);
    guardarYEnviarConfig();
  });
  // Switch solo referencia
  switchSoloReferencia.addEventListener('change', () => {
    config.soloReferencia = switchSoloReferencia.checked;
    guardarYEnviarConfig();
  });
  

  function guardarYEnviarConfig() {
    localStorage.setItem('proyectorConfig', JSON.stringify(config));
    // Enviar config al proyector seg√∫n modo
    const esBiblia = esModoBiblia();
    const configEnviar = {
      fontsize: esBiblia ? config.fontsizeBiblia : config.fontsizeHimnario,
      soloReferencia: esBiblia ? config.soloReferencia : null
    };
    console.log('üîß guardarYEnviarConfig llamada:', {
      config,
      esBiblia,
      configEnviar
    });
    enviarMensajeProyector('config', configEnviar);
  }
  // Enviar config inicial al abrir proyector
  if (proyectorWindow && !proyectorWindow.closed) {
    const esBiblia = esModoBiblia();
    const configEnviar = {
      fontsize: esBiblia ? config.fontsizeBiblia : config.fontsizeHimnario,
      soloReferencia: esBiblia ? config.soloReferencia : null
    };
    enviarMensajeProyector('config', configEnviar);
  }
  // Enviar config cada vez que se abre el proyector
  const originalAbrirProyector = abrirProyector;
  window.abrirProyector = function() {
    originalAbrirProyector();
    setTimeout(() => {
      const esBiblia = esModoBiblia();
      const configEnviar = {
        fontsize: esBiblia ? config.fontsizeBiblia : config.fontsizeHimnario,
        soloReferencia: esBiblia ? config.soloReferencia : null
      };
      enviarMensajeProyector('config', configEnviar);
    }, 500);
  };

  // Configurar eventos
  configurarEventos();

  // Cargar datos iniciales
  await cargarDatosIniciales();
  
  // Establecer modo inicial
  cambiarModo();

  // Inicializar modo de audio
  inicializarAudioMode();
  
  console.log('‚úÖ Funci√≥n inicializar() completada exitosamente');
  console.log('üîå Estado final del socket:', {
    existe: typeof window.socket !== 'undefined',
    socket: window.socket,
    conectado: window.socket ? window.socket.connected : 'N/A'
  });
}

/**
 * Configura todos los event listeners
 */
function configurarEventos() {
  // Bot√≥n abrir proyector
  elementos.abrirProyector.addEventListener('click', abrirProyector);

  // Eventos modo Biblia
  elementos.versionBiblia.addEventListener('change', cambiarVersionBiblia);
  elementos.buscarLibro.addEventListener('keyup', function(e) {
    if (["ArrowUp", "ArrowDown", "Enter"].includes(e.key)) return;
    filtrarLibros();
  });
  elementos.sugerenciasLibros.addEventListener('click', seleccionarLibro);
  // Navegaci√≥n con teclado en sugerencias de libros
  elementos.buscarLibro.addEventListener('keydown', manejarTeclasSugerenciasLibros);
  elementos.grillaCapitulos.addEventListener('click', seleccionarCapitulo);
  elementos.grillaVersiculos.addEventListener('click', seleccionarVersiculo);

  // Eventos modo Himnario
  elementos.buscarHimno.addEventListener('keyup', function(e) {
    if (["ArrowUp", "ArrowDown", "Enter"].includes(e.key)) return;
    filtrarHimnos();
  });
  elementos.listaHimnos.addEventListener('click', seleccionarHimno);
  // Navegaci√≥n con teclado en lista de himnos
  elementos.buscarHimno.addEventListener('keydown', manejarTeclasListaHimnos);

  // Navegaci√≥n
  elementos.anterior.addEventListener('click', () => navegar(-1));
  elementos.siguiente.addEventListener('click', () => navegar(1));

  // Bot√≥n de play del himno
  const playHimnoFooter = document.getElementById('playHimnoFooter');
  if (playHimnoFooter) {
    playHimnoFooter.addEventListener('click', reproducirHimno);
  }

  // Delegaci√≥n de eventos para cards din√°micas
  elementos.vistaPrevia.addEventListener('click', manejarClicCard);
  
  // Ocultar sugerencias cuando se hace clic fuera
  document.addEventListener('click', (event) => {
    if (!elementos.buscarLibro.contains(event.target) && !elementos.sugerenciasLibros.contains(event.target)) {
      elementos.sugerenciasLibros.style.display = 'none';
    }
  });

  // En configurarEventos, agregar este event listener:
  elementos.buscarLibro.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
      // Si ya hay libro, cap√≠tulo y vers√≠culo v√°lidos, lanzar al proyector
      const texto = elementos.buscarLibro.value.toLowerCase().trim();
      // Expresi√≥n regular para extraer: libro, cap√≠tulo y vers√≠culo
      const regex = /^(\d+\s)?([\w√°√©√≠√≥√∫√º√±]+)(?:[\s,:\.]+(\d+))?(?:[\s,:\.]+(\d+))?$/i;
      const match = texto.match(regex);
      let nombreLibro = texto;
      let cap = null;
      let vers = null;
      if (match) {
        nombreLibro = (match[1] ? match[1] : '') + match[2];
        nombreLibro = nombreLibro.trim();
        cap = match[3] ? parseInt(match[3], 10) : null;
        vers = match[4] ? parseInt(match[4], 10) : null;
      }
      const libros = Object.keys(bibliaActual);
      const libro = libros.find(l => l.toLowerCase() === nombreLibro);
      if (libro && cap && vers && bibliaActual[libro] && bibliaActual[libro][cap - 1] && bibliaActual[libro][cap - 1][vers - 1]) {
        libroActivo = libro;
        capituloActivo = cap - 1;
        versiculoActivoIndex = vers - 1;
        renderizarGrillaCapitulos(libro);
        // Resaltar cap√≠tulo
        elementos.grillaCapitulos.querySelectorAll('button').forEach((btn, idx) => {
          btn.classList.toggle('selected', idx === capituloActivo);
        });
        cargarCapitulo(libro, capituloActivo);
        renderizarGrillaVersiculos();
        // Resaltar vers√≠culo
        elementos.grillaVersiculos.querySelectorAll('button').forEach((btn, idx) => {
          btn.classList.toggle('selected', idx === versiculoActivoIndex);
        });
        resaltarCard(versiculoActivoIndex);
        enviarVersiculoAlProyector(versiculoActivoIndex);
        e.preventDefault();
      }
    }
  });
}

/**
 * Carga los datos iniciales de la aplicaci√≥n
 */
async function cargarDatosIniciales() {
  console.log('üìö Iniciando carga de datos iniciales...');
  try {
    // Cargar versiones de Biblia
    console.log('üìñ Cargando versiones de Biblia...');
    console.log('üîç getBibleVersions disponible:', typeof getBibleVersions !== 'undefined' ? 'S√≠' : 'No');
    
    const versiones = await getBibleVersions();
    console.log('‚úÖ Versiones de Biblia cargadas:', versiones);
    
    elementos.versionBiblia.innerHTML = '<option value="">Selecciona una versi√≥n</option>';
    let rv60Index = -1;
    versiones.forEach((version, idx) => {
      const option = document.createElement('option');
      option.value = version.file;
      option.textContent = version.description;
      elementos.versionBiblia.appendChild(option);
      if (version.file === 'es-rv60.json') rv60Index = idx + 1; // +1 por el option vac√≠o
    });
    // Seleccionar por defecto Reina Valera 1960 si existe
    if (rv60Index > 0) {
      elementos.versionBiblia.selectedIndex = rv60Index;
      await cambiarVersionBiblia();
    }
    
    // Cargar √≠ndice de himnos
    console.log('üéµ Cargando √≠ndice de himnos...');
    console.log('üîç getHymnIndex disponible:', typeof getHymnIndex !== 'undefined' ? 'S√≠' : 'No');
    
    indiceHimnos = await getHymnIndex();
    console.log('‚úÖ √çndice de himnos cargado:', indiceHimnos ? indiceHimnos.length + ' himnos' : 'No disponible');
    
    console.log('‚úÖ Datos iniciales cargados exitosamente');
  } catch (error) {
    console.error('‚ùå Error al cargar datos iniciales:', error);
    console.error('üîç Detalles del error:', {
      message: error.message,
      stack: error.stack
    });
  }
}

/**
 * Detecta si el dispositivo es m√≥vil
 */
function esDispositivoMovil() {
  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
         window.innerWidth <= 768;
}

/**
 * Abre la ventana de proyecci√≥n
 */
function abrirProyector() {
  const esMovil = esDispositivoMovil();
  
  if (esMovil) {
    // Si es m√≥vil, abrir autom√°ticamente en nueva pesta√±a
    const nuevaPestana = window.open('proyector.html', '_blank');
    
    // Mostrar instrucciones en la p√°gina actual
    mostrarInstruccionesMovil();
    
    // Cambiar el texto del bot√≥n SOLO por socket
    actualizarVisibilidadBotonProyector();
    // Emitir evento para sincronizar con otros paneles
    if (window.socket) {
      window.socket.emit('proyectorAbierto');
    }
  } else {
    // Si es PC, comportamiento normal
    if (proyectorWindow && !proyectorWindow.closed) {
      proyectorWindow.focus();
    } else {
      proyectorWindow = window.open('proyector.html', 'proyector', 'width=800,height=600');
      proyectorPendienteClick = true;
      // NO cambiar el bot√≥n aqu√≠, solo emitir el evento
      if (window.socket) {
        window.socket.emit('proyectorAbierto');
      }
      // Monitorea si la ventana se cierra manualmente
      const checkInterval = setInterval(() => {
        if (!proyectorWindow || proyectorWindow.closed) {
          clearInterval(checkInterval);
          proyectorWindow = null;
          proyectorPendienteClick = false;
          // Restaura el bot√≥n SOLO por socket
          if (window.socket) {
            window.socket.emit('proyectorCerrado');
          }
        }
      }, 1000);
    }
  }
}

/**
 * Muestra instrucciones para dispositivos m√≥viles
 */
function mostrarInstruccionesMovil() {
  // Crear o actualizar el elemento de instrucciones
  let instrucciones = document.getElementById('instrucciones-movil');
  if (!instrucciones) {
    instrucciones = document.createElement('div');
    instrucciones.id = 'instrucciones-movil';
    instrucciones.style.cssText = `
      background: #17a2b8;
      color: white;
      padding: 1em;
      margin: 1em 0;
      border-radius: 8px;
      text-align: center;
      font-size: 14px;
    `;
    
    // Insertar despu√©s del bot√≥n
    const boton = document.getElementById('abrirProyector');
    if (boton && boton.parentNode) {
      boton.parentNode.insertBefore(instrucciones, boton.nextSibling);
    }
  }
  
  instrucciones.innerHTML = `
    <strong>üì± Control M√≥vil Activo</strong><br>
    ‚úÖ Ventana de proyecci√≥n abierta en la PC<br>
    üéØ Ahora puedes controlar desde tu celular<br>
    <small>La proyecci√≥n aparecer√° en la nueva pesta√±a de la PC</small>
  `;
  
  // Ocultar despu√©s de 5 segundos
  setTimeout(() => {
    if (instrucciones) {
      instrucciones.style.display = 'none';
    }
  }, 5000);
}

/**
 * Cambia entre modo Biblia e Himnario
 */
function cambiarModo() {
  const esBiblia = esModoBiblia();
  
  // Limpiar todo ANTES de cambiar el modo
  limpiarVistaPrevia();
  limpiarProyector();
  limpiarCamposBusqueda();
  
  if (esBiblia) {
    elementos.controlBiblia.style.display = 'block';
    elementos.controlHimnario.style.display = 'none';
    enviarMensajeProyector('change_mode', { videoSrc: '/src/assets/videos/verso-bg.mp4' });
    ocultarPlayFooter();
  } else {
    elementos.controlBiblia.style.display = 'none';
    elementos.controlHimnario.style.display = 'block';
    enviarMensajeProyector('change_mode', { videoSrc: '/src/assets/videos/himno-bg.mp4' });
  }
  
  // Actualizar opciones del panel de configuraci√≥n seg√∫n el modo
  if (typeof window.actualizarOpcionesModo === 'function') {
    window.actualizarOpcionesModo();
  }
  
  // Enviar configuraci√≥n actualizada seg√∫n el modo
  const config = JSON.parse(localStorage.getItem('proyectorConfig')) || { fontsizeBiblia: 5, fontsizeHimnario: 5, soloReferencia: false };
  const configEnviar = {
    fontsize: esBiblia ? config.fontsizeBiblia : config.fontsizeHimnario,
    soloReferencia: esBiblia ? config.soloReferencia : null
  };
  enviarMensajeProyector('config', configEnviar);
  actualizarTopBarTitulo();
  actualizarVistaProyector();
}

/**
 * Funci√≥n global para cambiar modo desde el foot navbar
 * Esta funci√≥n se puede llamar desde index.html
 */
function cambiarModoGlobal(modo) {
  console.log('üîÑ Cambiando modo global a:', modo);
  
  // Actualizar el estado global
  window.modoActual = modo;
  
  // Limpiar todo ANTES de cambiar el modo
  limpiarVistaPrevia();
  limpiarProyector();
  limpiarCamposBusqueda();
  
  // Actualizar la interfaz
  if (modo === 'himnario') {
    elementos.controlHimnario.style.display = 'block';
    elementos.controlBiblia.style.display = 'none';
    enviarMensajeProyector('change_mode', { videoSrc: '/src/assets/videos/himno-bg.mp4' });
    console.log('üéµ Modo Himnario activado - Video: /src/assets/videos/himno-bg.mp4');
  } else {
    elementos.controlBiblia.style.display = 'block';
    elementos.controlHimnario.style.display = 'none';
    enviarMensajeProyector('change_mode', { videoSrc: '/src/assets/videos/verso-bg.mp4' });
    ocultarPlayFooter();
    console.log('üìñ Modo Biblia activado - Video: /src/assets/videos/verso-bg.mp4');
  }
  
  // Actualizar opciones del panel de configuraci√≥n seg√∫n el modo
  if (typeof window.actualizarOpcionesModo === 'function') {
    window.actualizarOpcionesModo();
  }
  
  // Enviar configuraci√≥n actualizada seg√∫n el modo
  const config = JSON.parse(localStorage.getItem('proyectorConfig')) || { fontsizeBiblia: 5, fontsizeHimnario: 5, soloReferencia: false };
  const configEnviar = {
    fontsize: modo === 'biblia' ? config.fontsizeBiblia : config.fontsizeHimnario,
    soloReferencia: modo === 'biblia' ? config.soloReferencia : null
  };
  enviarMensajeProyector('config', configEnviar);
  actualizarTopBarTitulo();
  actualizarVistaProyector();
  
  console.log('‚úÖ Cambio de modo completado');
}

/**
 * Cambia la versi√≥n de la Biblia
 */
async function cambiarVersionBiblia() {
  const version = elementos.versionBiblia.value;
  if (!version) return;

  try {
    console.log('Cargando versi√≥n de Biblia:', version);
    bibliaActual = await parseBible(version);
    if (bibliaActual) {
      console.log('Biblia cargada exitosamente. Libros disponibles:', Object.keys(bibliaActual));
      limpiarGrillas();
      mostrarSugerenciasLibros();
    } else {
      console.error('No se pudo cargar la Biblia');
    }
  } catch (error) {
    console.error('Error al cargar la Biblia:', error);
  }
}

/**
 * Filtra libros seg√∫n el texto ingresado
 */
function filtrarLibros() {
  if (!bibliaActual) return;
  const texto = elementos.buscarLibro.value.toLowerCase().trim();
  if (texto.length === 0) {
    elementos.sugerenciasLibros.style.display = 'none';
    libroSugeridoIndex = -1;
    return;
  }

  // Expresi√≥n regular para extraer: libro, cap√≠tulo y vers√≠culo
  const regex = /^(\d+\s)?([\w√°√©√≠√≥√∫√º√±]+)(?:[\s,:\.]+(\d+))?(?:[\s,:\.]+(\d+))?$/i;
  const match = texto.match(regex);
  let nombreLibro = texto;
  let cap = null;
  let vers = null;
  if (match) {
    nombreLibro = (match[1] ? match[1] : '') + match[2];
    nombreLibro = nombreLibro.trim();
    cap = match[3] ? parseInt(match[3], 10) : null;
    vers = match[4] ? parseInt(match[4], 10) : null;
  }

  // Buscar libros que coincidan con el nombre
  const libros = Object.keys(bibliaActual);
  const filtrados = libros.filter(libro => 
    libro.toLowerCase().includes(nombreLibro)
  );
  libroSugeridoIndex = filtrados.length > 0 ? 0 : -1;

  // Si el input termina con un espacio despu√©s del nombre del libro (ignorando el espacio entre n√∫mero y nombre)
  const terminaConEspacio = /^(\d+\s)?[\w√°√©√≠√≥√∫√º√±]+\s$/i.test(elementos.buscarLibro.value);
  if (terminaConEspacio) {
    elementos.sugerenciasLibros.style.display = 'none';
  } else {
    mostrarSugerenciasLibros(filtrados);
  }

  // Selecci√≥n autom√°tica de libro/cap√≠tulo/vers√≠culo en tiempo real
  const libro = libros.find(l => l.toLowerCase() === nombreLibro);
  if (libro) {
    if (libroActivo !== libro) {
      libroActivo = libro;
      renderizarGrillaCapitulos(libro);
    }
    if (cap && bibliaActual[libro] && bibliaActual[libro][cap - 1]) {
      capituloActivo = cap - 1;
      // Resaltar cap√≠tulo
      elementos.grillaCapitulos.querySelectorAll('button').forEach((btn, idx) => {
        btn.classList.toggle('selected', idx === capituloActivo);
      });
      cargarCapitulo(libro, capituloActivo);
      renderizarGrillaVersiculos();
      if (vers && bibliaActual[libro][cap - 1][vers - 1]) {
        versiculoActivoIndex = vers - 1;
        elementos.grillaVersiculos.querySelectorAll('button').forEach((btn, idx) => {
          btn.classList.toggle('selected', idx === versiculoActivoIndex);
        });
        resaltarCard(versiculoActivoIndex);
      } else {
        versiculoActivoIndex = -1;
        elementos.grillaVersiculos.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
      }
    } else {
      capituloActivo = null;
      elementos.grillaCapitulos.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
      elementos.grillaVersiculos.innerHTML = '';
    }
  } else {
    capituloActivo = null;
    elementos.grillaCapitulos.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
    elementos.grillaVersiculos.innerHTML = '';
  }
}

/**
 * Muestra sugerencias de libros
 */
function mostrarSugerenciasLibros(libros = null) {
  elementos.sugerenciasLibros.innerHTML = '';
  if (!bibliaActual) return;
  const librosAMostrar = libros || Object.keys(bibliaActual).slice(0, 10);
  librosAMostrar.forEach((libro, idx) => {
    const div = document.createElement('div');
    div.textContent = libro;
    div.dataset.libro = libro;
    if (idx === libroSugeridoIndex) div.classList.add('selected');
    elementos.sugerenciasLibros.appendChild(div);
  });
  if (librosAMostrar.length > 0) {
    elementos.sugerenciasLibros.style.display = 'block';
    // Posicionar las sugerencias debajo del input
    const inputRect = elementos.buscarLibro.getBoundingClientRect();
    elementos.sugerenciasLibros.style.top = (inputRect.bottom + 5) + 'px';
    elementos.sugerenciasLibros.style.left = inputRect.left + 'px';
    // Asegurar resaltado visual correcto despu√©s de renderizar
    const sugerencias = Array.from(elementos.sugerenciasLibros.querySelectorAll('div'));
    sugerencias.forEach((div, idx) => {
      if (idx === libroSugeridoIndex) {
        div.classList.add('selected');
      } else {
        div.classList.remove('selected');
      }
    });
  } else {
    elementos.sugerenciasLibros.style.display = 'none';
  }
}

/**
 * Selecciona un libro
 */
function seleccionarLibro(event) {
  let target = event.target;
  // Permitir selecci√≥n por teclado
  if (event.type === 'keydown' && event.selectedDiv) {
    target = event.selectedDiv;
  }
  if (target && target.dataset.libro) {
    const libro = target.dataset.libro;
    libroActivo = libro;
    elementos.buscarLibro.value = libro;
    elementos.sugerenciasLibros.style.display = 'none';
    renderizarGrillaCapitulos(libro);
    libroSugeridoIndex = -1;
  }
}

/**
 * Renderiza la grilla de cap√≠tulos
 */
function renderizarGrillaCapitulos(libro) {
  elementos.grillaCapitulos.innerHTML = '';
  const cap√≠tulos = bibliaActual[libro];
  
  cap√≠tulos.forEach((capitulo, index) => {
    const button = document.createElement('button');
    button.textContent = index + 1;
    button.dataset.capitulo = index;
    elementos.grillaCapitulos.appendChild(button);
  });
}

/**
 * Selecciona un cap√≠tulo
 */
function seleccionarCapitulo(event) {
  if (event.target.dataset.capitulo) {
    const capituloIndex = parseInt(event.target.dataset.capitulo);
    capituloActivo = capituloIndex;
    
    // Resaltar cap√≠tulo seleccionado
    elementos.grillaCapitulos.querySelectorAll('button').forEach(btn => {
      btn.classList.remove('selected');
    });
    event.target.classList.add('selected');
    
    cargarCapitulo(libroActivo, capituloIndex);
    renderizarGrillaVersiculos();
  }
}

/**
 * Carga un cap√≠tulo en la vista previa
 */
function cargarCapitulo(libro, capituloIndex) {
  elementos.vistaPrevia.innerHTML = '';
  const cap√≠tulo = bibliaActual[libro][capituloIndex];
  
  cap√≠tulo.forEach((versiculo, index) => {
    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.versiculo = index;
    card.innerHTML = `<strong>${versiculo.verse}</strong> ${versiculo.text}`;
    elementos.vistaPrevia.appendChild(card);
  });
}

/**
 * Renderiza la grilla de vers√≠culos
 */
function renderizarGrillaVersiculos() {
  elementos.grillaVersiculos.innerHTML = '';
  const cap√≠tulo = bibliaActual[libroActivo][capituloActivo];
  
  cap√≠tulo.forEach((versiculo, index) => {
    const button = document.createElement('button');
    button.textContent = versiculo.verse;
    button.dataset.versiculo = index;
    elementos.grillaVersiculos.appendChild(button);
  });
}

/**
 * Selecciona un vers√≠culo
 */
function seleccionarVersiculo(event) {
  if (event.target.dataset.versiculo) {
    const versiculoIndex = parseInt(event.target.dataset.versiculo);
    versiculoActivoIndex = versiculoIndex;
    
    // Resaltar vers√≠culo seleccionado
    elementos.grillaVersiculos.querySelectorAll('button').forEach(btn => {
      btn.classList.remove('selected');
    });
    event.target.classList.add('selected');
    
    resaltarCard(versiculoIndex);
    enviarVersiculoAlProyector(versiculoIndex);
  }
}

/**
 * Filtra himnos seg√∫n el texto ingresado
 */
async function filtrarHimnos() {
  const texto = elementos.buscarHimno.value;
  const textoNormalizado = normalizarTexto(texto.toLowerCase());

  // Si el usuario busca solo por n√∫mero
  const esNumero = /^\d+$/.test(textoNormalizado);

  // Preparamos una lista de himnos con su relevancia
  let himnosConRelevancia = indiceHimnos.map(himno => {
    const tituloNormalizado = normalizarTexto(himno.title.toLowerCase());
    let relevancia = 1000; // valor alto por defecto
    let posicion = tituloNormalizado.length;

    // Coincidencia exacta (t√≠tulo completo)
    if (tituloNormalizado === textoNormalizado) {
      relevancia = 0;
      posicion = 0;
    } else if (esNumero && himno.number === textoNormalizado.padStart(3, '0')) {
      // Coincidencia exacta por n√∫mero
      relevancia = 0;
      posicion = 0;
    } else if (tituloNormalizado.includes(textoNormalizado)) {
      // Coincidencia parcial en el t√≠tulo
      relevancia = 1;
      posicion = tituloNormalizado.indexOf(textoNormalizado);
    } else if (himno.number.includes(textoNormalizado)) {
      // Coincidencia parcial en el n√∫mero
      relevancia = 2;
      posicion = 0;
    }
    return { ...himno, relevancia, posicion };
  });

  // Filtrar solo los que tienen alguna coincidencia
  himnosConRelevancia = himnosConRelevancia.filter(h => h.relevancia < 1000);

  // Ordenar por relevancia y posici√≥n de la coincidencia
  himnosConRelevancia.sort((a, b) => {
    if (a.relevancia !== b.relevancia) return a.relevancia - b.relevancia;
    if (a.posicion !== b.posicion) return a.posicion - b.posicion;
    // Si todo es igual, ordenar por n√∫mero
    return a.number.localeCompare(b.number);
  });

  himnoSugeridoIndex = -1; // Reiniciar selecci√≥n al filtrar
  await mostrarListaHimnos(himnosConRelevancia);
}

/**
 * Muestra la lista de himnos filtrados
 */
async function mostrarListaHimnos(himnos) {
  elementos.listaHimnos.innerHTML = '';
  
  // Filtrar himnos que realmente existen
  const himnosValidos = [];
  for (const himno of himnos) {
    try {
      const response = await fetch(`/src/assets/himnos/letra/${himno.file}`, { method: 'HEAD' });
      if (response.ok) {
        himnosValidos.push(himno);
      } else {
        console.warn(`Himno no encontrado: ${himno.file}`);
      }
    } catch (error) {
      console.warn(`Error al verificar himno ${himno.file}:`, error);
    }
  }
  
  // Mostrar solo los himnos v√°lidos
  himnosValidos.slice(0, 20).forEach((himno, idx) => {
    const div = document.createElement('div');
    div.textContent = `${himno.number} - ${himno.title}`;
    div.dataset.himno = himno.file;
    if (idx === himnoSugeridoIndex) div.classList.add('selected');
    elementos.listaHimnos.appendChild(div);
  });
  
  if (himnosValidos.length > 0) {
    elementos.listaHimnos.style.display = 'block';
  } else {
    elementos.listaHimnos.style.display = 'none';
  }
}

/**
 * Selecciona un himno
 */
async function seleccionarHimno(event) {
  let target = event.target;
  // Permitir selecci√≥n por teclado
  if (event.type === 'keydown' && event.selectedDiv) {
    target = event.selectedDiv;
  }
  
  if (target && target.dataset.himno) {
    const himnoFile = target.dataset.himno;
    
    try {
      // Cargar el himno
      himnoActivo = await parseHymn(himnoFile);
      if (himnoActivo) {
        // Usar el t√≠tulo tal cual viene del JSON
        const tituloLimpio = himnoActivo.titulo;
        
        // Debug: Log para verificar el t√≠tulo
        console.log('üîç Debug t√≠tulo (seleccionarHimno):', {
          tituloLimpio: tituloLimpio,
          numero: himnoActivo.numero
        });
        
        // Actualizar el input con el t√≠tulo del himno
        elementos.buscarHimno.value = `${himnoActivo.numero} - ${tituloLimpio}`;
        elementos.listaHimnos.style.display = 'none';
        himnoSugeridoIndex = -1;
        
        // Cargar en vista previa
        cargarHimnoEnVistaPrevia();
        
        // Enviar t√≠tulo al proyector
        enviarEstrofaAlProyector(0);
      }
    } catch (error) {
      console.error('Error al cargar himno:', error);
    }
  }
}

/**
 * Carga un himno en la vista previa
 */
function cargarHimnoEnVistaPrevia() {
  if (!himnoActivo) return;
  
  elementos.vistaPrevia.innerHTML = '';
  
  // Usar el t√≠tulo tal cual viene del JSON
  const tituloLimpio = himnoActivo.titulo;
  
  // Debug: Log para verificar el t√≠tulo
  console.log('üîç Debug t√≠tulo (cargarHimnoEnVistaPrevia):', {
    tituloLimpio: tituloLimpio,
    numero: himnoActivo.numero
  });
  
  himnoActivo.estrofas.forEach((estrofa, index) => {
    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.estrofa = index;
  
    if (index === 0) {
      // Es el t√≠tulo
      card.innerHTML = `<strong>${himnoActivo.numero} | ${tituloLimpio}</strong>`;
    } else {
      // Es una estrofa
      const versoText = estrofa.verso === 'coro' ? 'Coro' : `Verso ${estrofa.verso}`;
      card.innerHTML = `<strong>${versoText}</strong><br>${estrofa.texto}`;
    }
    
    elementos.vistaPrevia.appendChild(card);
    
    // Agregar evento de clic
    card.addEventListener('click', manejarClicCard);
  });
  
  // Seleccionar la primera estrofa por defecto (t√≠tulo)
  estrofaActivaIndex = 0;
  resaltarCard(0);
  
  // Mostrar el bot√≥n de reproducci√≥n
  actualizarBotonPlayHimno();
}

/**
 * Maneja el clic en una card de estrofa/vers√≠culo
 */
function manejarClicCard(event) {
  const card = event.currentTarget;
  const estrofaIndex = parseInt(card.dataset.estrofa);
  
  if (esModoBiblia()) {
    // Modo Biblia
    versiculoActivoIndex = estrofaIndex;
    resaltarCard(estrofaIndex);
    enviarVersiculoAlProyector(estrofaIndex);
  } else {
    // Modo Himnario
    estrofaActivaIndex = estrofaIndex;
    resaltarCard(estrofaIndex);
    enviarEstrofaAlProyector(estrofaIndex);
  }
}

/**
 * Actualiza el bot√≥n de play del himno
 */
function actualizarBotonPlayHimno() {
  if (!himnoActivo) {
    ocultarPlayFooter();
    actualizarBotonPlayMiniProyector();
    return;
  }
  
  // Verificar si existe audio para este himno
  const numeroFormateado = himnoActivo.numero.padStart(3, '0');
  const rutaAudio = construirRutaAudio(numeroFormateado, himnoActivo.titulo);
  
  // Mostrar bot√≥n de play
  const playHimnoFooter = document.getElementById('playHimnoFooter');
  if (playHimnoFooter) {
    playHimnoFooter.style.display = 'block';
    
    // Actualizar el estado del bot√≥n seg√∫n si est√° sonando o no
    if (himnoSonando) {
      playHimnoFooter.textContent = '‚èπÔ∏è Detener Himno';
      playHimnoFooter.style.background = '#dc3545';
    } else {
      playHimnoFooter.textContent = '‚ñ∂Ô∏è Reproducir Himno';
      playHimnoFooter.style.background = '#28a745';
    }
  }
  actualizarBotonPlayMiniProyector();
}

/**
 * Construye la ruta del archivo de audio
 */
function construirRutaAudio(numeroFormateado, titulo) {
  const tituloNormalizado = titulo.toLowerCase()
    .replace(/[^a-z0-9]/g, ' ')
    .trim()
    .replace(/\s+/g, ' ');
  
  return `/src/assets/himnos/musica/${audioMode}/${numeroFormateado}.mp3`;
}

/**
 * Reproduce o detiene un himno
 */
async function reproducirHimno() {
  if (!himnoActivo) return;
  
  if (himnoSonando) {
    // Si est√° sonando, detener con fadeout
    console.log('‚èπÔ∏è Deteniendo himno con fadeout...');
    
    // Enviar comando de detenci√≥n al proyector (PC)
    enviarMensajeProyector('detenerAudio', {
      fadeout: true,
      duracion: 2000 // 2 segundos de fadeout
    });
    
    himnoSonando = false;
    
    // Cambiar el estado del bot√≥n
    const playHimnoFooter = document.getElementById('playHimnoFooter');
    if (playHimnoFooter) {
      playHimnoFooter.textContent = '‚ñ∂Ô∏è Reproducir Himno';
      playHimnoFooter.style.background = '#28a745';
    }
    
    console.log('‚úÖ Comando de detenci√≥n enviado al proyector');
    
  } else {
    // Si no est√° sonando, reproducir
    const numeroFormateado = himnoActivo.numero.padStart(3, '0');
    const rutaAudio = construirRutaAudio(numeroFormateado, himnoActivo.titulo);
    
    try {
      console.log('üéµ Reproduciendo himno:', {
        numero: himnoActivo.numero,
        titulo: himnoActivo.titulo,
        ruta: rutaAudio
      });
      
      // Enviar comando de reproducci√≥n al proyector (PC)
      enviarMensajeProyector('reproducirAudio', {
        ruta: rutaAudio,
        himno: himnoActivo.numero,
        titulo: himnoActivo.titulo
      });
      
      // NO reproducir en el panel de control (celular)
      // El audio solo debe reproducirse en la PC
      
      himnoSonando = true;
      
      // Cambiar el estado del bot√≥n
      const playHimnoFooter = document.getElementById('playHimnoFooter');
      if (playHimnoFooter) {
        playHimnoFooter.textContent = '‚èπÔ∏è Detener Himno';
        playHimnoFooter.style.background = '#dc3545';
      }
      
      console.log('‚úÖ Comando de reproducci√≥n enviado al proyector');
      
    } catch (error) {
      console.error('‚ùå Error al reproducir himno:', error);
    }
  }
  actualizarBotonPlayMiniProyector();
}

/**
 * Navega entre estrofas/vers√≠culos
 */
function navegar(direccion) {
  if (esModoBiblia()) {
    // Modo Biblia
    if (!bibliaActual || !libroActivo || capituloActivo === null || versiculoActivoIndex < 0) return;
    
    const cap√≠tulo = bibliaActual[libroActivo][capituloActivo];
    const totalVersiculos = cap√≠tulo.length;
    
    versiculoActivoIndex += direccion;
    
    if (versiculoActivoIndex < 0) {
      versiculoActivoIndex = totalVersiculos - 1;
    } else if (versiculoActivoIndex >= totalVersiculos) {
      versiculoActivoIndex = 0;
    }
    
    resaltarCard(versiculoActivoIndex);
    enviarVersiculoAlProyector(versiculoActivoIndex);
  } else {
    // Modo Himnario
    if (!himnoActivo || estrofaActivaIndex < 0) return;
    
    const totalEstrofas = himnoActivo.estrofas.length;
    
    estrofaActivaIndex += direccion;
    
    if (estrofaActivaIndex < 0) {
      estrofaActivaIndex = totalEstrofas - 1;
    } else if (estrofaActivaIndex >= totalEstrofas) {
      estrofaActivaIndex = 0;
    }
    
    // Resaltar la card seleccionada
    const cards = document.querySelectorAll('.card');
    cards.forEach((card, index) => {
      card.classList.toggle('selected', index === estrofaActivaIndex);
    });
    
    enviarEstrofaAlProyector(estrofaActivaIndex);
  }
  actualizarVistaProyector();
}

/**
 * Resalta un vers√≠culo en la vista previa
 */
function resaltarCard(versiculoIndex) {
  const cards = document.querySelectorAll('.card');
  cards.forEach((card, index) => {
    if (index === versiculoIndex) {
      card.classList.add('selected');
    } else {
      card.classList.remove('selected');
    }
  });
}

/**
 * Limpia la vista previa
 */
function limpiarVistaPrevia() {
  console.log('üßπ Limpiando vista previa...');
  elementos.vistaPrevia.innerHTML = '';
  versiculoActivoIndex = -1;
  estrofaActivaIndex = -1;
  himnoActivo = null;
  libroActivo = null;
  capituloActivo = null;
  ocultarPlayFooter();
  actualizarVistaProyector();
}

/**
 * Limpia las grillas de cap√≠tulos y vers√≠culos
 */
function limpiarGrillas() {
  console.log('üßπ Limpiando grillas...');
  elementos.grillaCapitulos.innerHTML = '';
  elementos.grillaVersiculos.innerHTML = '';
  capituloActivo = null;
  versiculoActivoIndex = -1;
}

/**
 * Oculta el footer de reproducci√≥n del himno
 */
function ocultarPlayFooter(forceHide = false) {
  const playHimnoFooter = document.getElementById('playHimnoFooter');
  if (playHimnoFooter) {
    playHimnoFooter.style.display = forceHide ? 'none' : 'none';
  }
}

/**
 * Limpia el texto del proyector
 */
function limpiarProyector() {
  console.log('üßπ Limpiando proyector...');
  enviarMensajeProyector('update_text', {
    texto: '',
    ref: '',
    soloReferencia: false
  });
}

/**
 * Limpia los campos de b√∫squeda
 */
function limpiarCamposBusqueda() {
  console.log('üßπ Limpiando campos de b√∫squeda...');
  if (elementos.buscarLibro) {
    elementos.buscarLibro.value = '';
  }
  if (elementos.buscarHimno) {
    elementos.buscarHimno.value = '';
  }
  if (elementos.sugerenciasLibros) {
    elementos.sugerenciasLibros.style.display = 'none';
  }
  if (elementos.listaHimnos) {
    elementos.listaHimnos.style.display = 'none';
  }
}

/**
 * Normaliza el texto para comparaciones
 */
function normalizarTexto(texto) {
  return texto.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
}

/**
 * Inicializa el modo de audio
 */
function inicializarAudioMode() {
  // Implementa la inicializaci√≥n del modo de audio
}

/**
 * Maneja teclas de navegaci√≥n en sugerencias de libros
 */
function manejarTeclasSugerenciasLibros(event) {
  if (["ArrowUp", "ArrowDown", "Enter"].includes(event.key)) {
    const sugerencias = document.querySelectorAll('.sugerenciasLibros div');
    let index = Array.from(sugerencias).findIndex(div => div.classList.contains('selected'));
    
    if (event.key === "ArrowUp") {
      index = (index - 1 + sugerencias.length) % sugerencias.length;
    } else if (event.key === "ArrowDown") {
      index = (index + 1) % sugerencias.length;
    } else if (event.key === "Enter") {
      const selectedDiv = sugerencias[index];
      if (selectedDiv) {
        seleccionarLibro({ type: 'click', selectedDiv });
      }
    }
    
  sugerencias.forEach((div, idx) => {
      div.classList.toggle('selected', idx === index);
    });
  }
}

/**
 * Maneja teclas de navegaci√≥n en lista de himnos
 */
function manejarTeclasListaHimnos(event) {
  if (["ArrowUp", "ArrowDown", "Enter"].includes(event.key)) {
    const himnos = document.querySelectorAll('.listaHimnos div');
    let index = Array.from(himnos).findIndex(div => div.classList.contains('selected'));
    
    if (event.key === "ArrowUp") {
      index = (index - 1 + himnos.length) % himnos.length;
    } else if (event.key === "ArrowDown") {
      index = (index + 1) % himnos.length;
    } else if (event.key === "Enter") {
      const selectedDiv = himnos[index];
      if (selectedDiv) {
        seleccionarHimno({ type: 'click', target: selectedDiv });
      }
    }
    
  himnos.forEach((div, idx) => {
      div.classList.toggle('selected', idx === index);
    });
  }
}

/**
 * Alterna entre la vista lista y la vista tipo proyector
 */
function alternarVistaPrevisualizacion() {
  const botonera = document.getElementById('botoneraNavegacion');
  const playMini = document.getElementById('playHimnoMiniProyector');
  if (vistaActual === 'lista') {
    vistaActual = 'proyector';
    if (vistaPrevia) vistaPrevia.style.display = 'none';
    if (vistaProyector) vistaProyector.style.display = 'flex';
    if (botonera) botonera.style.display = 'none';
    // Mostrar bot√≥n play/stop solo si es himnario
    if (playMini) playMini.style.display = (!esModoBiblia() ? 'block' : 'none');
    actualizarVistaProyector();
    if (btnCambiarVista) {
      const icono = btnCambiarVista.querySelector('i');
      const texto = btnCambiarVista.querySelector('span');
      if (icono) {
        icono.className = 'fa-solid fa-list';
      }
      if (texto) {
        texto.textContent = 'Lista';
      }
    }
  } else {
    vistaActual = 'lista';
    if (vistaPrevia) vistaPrevia.style.display = 'block';
    if (vistaProyector) vistaProyector.style.display = 'none';
    if (botonera) botonera.style.display = 'flex';
    if (playMini) playMini.style.display = 'none';
    if (btnCambiarVista) {
      const icono = btnCambiarVista.querySelector('i');
      const texto = btnCambiarVista.querySelector('span');
      if (icono) {
        icono.className = 'fa-solid fa-expand';
      }
      if (texto) {
        texto.textContent = 'Proyector';
      }
    }
  }
  actualizarTopBarTitulo();
  actualizarBotonPlayMiniProyector();
}

/**
 * Actualiza el contenido de la vista tipo proyector
 */
function actualizarVistaProyector() {
  if (!proyectorPreviewContent) return;
  let texto = '';
  let referencia = '';
  let isBiblia = esModoBiblia();
  if (isBiblia) {
    // Mostrar vers√≠culo actual
    if (bibliaActual && libroActivo && capituloActivo !== null && versiculoActivoIndex >= 0) {
      const versiculo = bibliaActual[libroActivo][capituloActivo][versiculoActivoIndex];
      referencia = `${libroActivo} ${capituloActivo + 1}:${versiculo.verse}`;
      texto = versiculo.text;
    } else {
      referencia = '';
      texto = '<span style="color:#ffd700;">Selecciona un vers√≠culo</span>';
    }
    // Video de fondo Biblia
    if (miniProyectorVideo) {
      if (miniProyectorVideo.src.indexOf('verso-bg.mp4') === -1) {
        miniProyectorVideo.src = '/src/assets/videos/verso-bg.mp4';
      }
    }
  } else {
    // Mostrar estrofa actual
    if (himnoActivo && estrofaActivaIndex >= 0) {
      const estrofa = himnoActivo.estrofas[estrofaActivaIndex];
      if (estrofaActivaIndex === 0) {
        referencia = `Himno ${himnoActivo.numero}`;
        texto = himnoActivo.titulo;
      } else {
        const versoText = estrofa.verso === 'coro' ? 'Coro' : `Verso ${estrofa.verso}`;
        referencia = `${himnoActivo.numero} - ${versoText}`;
        texto = estrofa.texto.replace(/\n/g, '<br>');
      }
    } else {
      referencia = '';
      texto = '<span style="color:#ffd700;">Selecciona un himno</span>';
    }
    // Video de fondo Himnario
    if (miniProyectorVideo) {
      if (miniProyectorVideo.src.indexOf('himno-bg.mp4') === -1) {
        miniProyectorVideo.src = '/src/assets/videos/himno-bg.mp4';
      }
    }
  }
  // Ajustar fuente y estilos igual que el proyector real
  let fontSize = isBiblia ? '2.2em' : '2.2em';
  let fontFamily = isBiblia ? "'Qwigley', 'RobotoSlab-Bold', serif" : "'RobotoSlab-Bold', serif";
  if (isBiblia) {
    fontSize = '1.3em'; // M√°s peque√±o en modo Biblia
  }
  proyectorPreviewContent.style.fontSize = fontSize;
  proyectorPreviewContent.style.fontFamily = fontFamily;
  proyectorPreviewContent.innerHTML = (referencia ? `<span class='referencia'>${referencia}</span>` : '') + `<span>${texto}</span>`;
}

/**
 * Actualiza el t√≠tulo de la barra superior seg√∫n el modo y la vista
 */
function actualizarTopBarTitulo() {
  if (!topBarTitulo) return;
  let modo = esModoBiblia() ? 'Biblia' : 'Himnario';
  if (vistaActual === 'proyector') {
    topBarTitulo.textContent = `${modo} (Proyector)`;
  } else {
    topBarTitulo.textContent = modo;
  }
}

function actualizarBotonPlayMiniProyector() {
  const playMini = document.getElementById('playHimnoMiniProyector');
  if (!playMini) return;
  if (vistaActual === 'proyector' && !esModoBiblia() && himnoActivo) {
    playMini.style.display = 'block';
    if (himnoSonando) {
      playMini.textContent = '‚èπÔ∏è Detener Himno';
      playMini.style.background = '#dc3545';
    } else {
      playMini.textContent = '‚ñ∂Ô∏è Reproducir Himno';
      playMini.style.background = '#28a745';
    }
  } else {
    playMini.style.display = 'none';
  }
}

function ajustarRelacionAspectoMiniProyector() {
  if (miniProyectorContainer) {
    miniProyectorContainer.style.aspectRatio = miniProyectorAspect;
    // Fallback para navegadores sin aspect-ratio
    if (!('aspectRatio' in document.body.style)) {
      // fallback: height = width / aspect
      const width = miniProyectorContainer.offsetWidth;
      miniProyectorContainer.style.height = (width / miniProyectorAspect) + 'px';
    } else {
      miniProyectorContainer.style.height = '';
    }
  }
}

// Llamar tambi√©n al hacer resize en el panel de control
window.addEventListener('resize', ajustarRelacionAspectoMiniProyector);

// Escuchar eventos de sincronizaci√≥n de proyector
// Elimina el bloque duplicado de listeners de socket para proyectorAbierto/proyectorCerrado si existe fuera de inicializarSocketIO

// Hacer la funci√≥n cambiarModoGlobal disponible globalmente
window.cambiarModoGlobal = cambiarModoGlobal;

// Inicializar la aplicaci√≥n cuando el DOM est√© listo
console.log('üìã DOM cargado, iniciando aplicaci√≥n...');
document.addEventListener('DOMContentLoaded', () => {
  console.log('üéØ DOMContentLoaded disparado, llamando a inicializar()...');
  inicializar().then(() => {
    if (vistaPrevia) vistaPrevia.style.display = 'block';
    if (vistaProyector) vistaProyector.style.display = 'none';
    vistaActual = 'lista';
    actualizarTopBarTitulo();
    const botonera = document.getElementById('botoneraNavegacion');
    if (botonera) botonera.style.display = 'flex';
    const playMini = document.getElementById('playHimnoMiniProyector');
    if (playMini) {
      playMini.addEventListener('click', () => {
        reproducirHimno();
        actualizarBotonPlayMiniProyector();
      });
    }
    actualizarVisibilidadBotonProyector();
  }).catch(error => {
    console.error('‚ùå Error al inicializar la aplicaci√≥n:', error);
  });
});

function actualizarVisibilidadBotonProyector() {
  const boton = document.getElementById('abrirProyector');
  const body = document.body;
  if (!boton) return;
  if (proyectorWindow && !proyectorWindow.closed && proyectorPendienteClick) {
    boton.classList.add('proyector-abierto');
    boton.classList.remove('proyector-normal');
    boton.style.display = '';
    boton.textContent = 'No olvides hacer click en el proyector';
    boton.style.pointerEvents = 'none';
    boton.style.cursor = 'not-allowed';
    body.classList.add('con-boton-proyector');
  } else if (proyectorWindow && !proyectorWindow.closed && !proyectorPendienteClick) {
    boton.classList.remove('proyector-abierto');
    boton.classList.add('proyector-normal');
    boton.style.display = '';
    boton.textContent = 'Abrir Ventana de Proyecci√≥n';
    boton.style.pointerEvents = '';
    boton.style.cursor = '';
    body.classList.remove('con-boton-proyector');
  } else {
    boton.classList.remove('proyector-abierto');
    boton.classList.add('proyector-normal');
    boton.style.display = '';
    boton.textContent = 'Abrir Ventana de Proyecci√≥n';
    boton.style.pointerEvents = '';
    boton.style.cursor = '';
    body.classList.add('con-boton-proyector');
  }
}



// church_display/src\js\proyector.js
// 1. Conectarse al servidor SocketIO
const socket = io();
const videoBg = document.getElementById('video-bg');
const textoPrincipal = document.getElementById('texto-principal');
const referencia = document.getElementById('referencia');
const contadorSeccion = document.getElementById('contador-seccion');
const indicadorEstrofa = document.getElementById('indicador-estrofa');

// Verificar que los elementos existen
console.log('üîç Elementos del proyector:', {
    videoBg: !!videoBg,
    textoPrincipal: !!textoPrincipal,
    referencia: !!referencia,
    contadorSeccion: !!contadorSeccion,
    indicadorEstrofa: !!indicadorEstrofa
});

// Elemento de audio para reproducir himnos
let audioElement = null;

// 2. Eventos de conexi√≥n
socket.on('connect', () => {
    console.log('‚úÖ Proyector conectado al servidor SocketIO - ID:', socket.id);
});

socket.on('disconnect', () => {
    console.log('‚ùå Proyector desconectado del servidor SocketIO');
});

// Agregar logging para todos los eventos recibidos
socket.onAny((eventName, ...args) => {
    console.log('üì• Evento recibido:', eventName, args);
});

// 3. Escuchar mensajes del panel de control
socket.on('update_text', (data) => {
    console.log('üì• Recibido update_text:', data);
    
    // Aplicar transici√≥n suave
    textoPrincipal.classList.add('fade-out');
    referencia.classList.add('fade-out');
    contadorSeccion.classList.remove('visible');
    indicadorEstrofa.classList.remove('visible');
    
    setTimeout(() => {
        // Determinar el modo y aplicar clases CSS correspondientes
        const contenido = document.getElementById('contenido');
        
        if (data.soloReferencia) {
            // Modo solo referencia (vers√≠culo)
            contenido.classList.remove('modo-himno');
            contenido.classList.add('modo-versiculo');
            
            textoPrincipal.innerHTML = data.texto;
            referencia.style.display = 'none';
            // Ocultar indicadores de himno
            contadorSeccion.style.display = 'none';
            indicadorEstrofa.style.display = 'none';
            // Quitar clase de vers√≠culo b√≠blico
            textoPrincipal.classList.remove('versiculo-biblia');
        } else {
            if (data.himnoData) {
                // Modo himno
                contenido.classList.remove('modo-versiculo');
                contenido.classList.add('modo-himno');
                
                textoPrincipal.innerHTML = data.texto;
                referencia.textContent = `Himno ${data.himnoData.numero} - ${data.himnoData.titulo}`;
                // Quitar clase de vers√≠culo b√≠blico si es himno
                textoPrincipal.classList.remove('versiculo-biblia');
                referencia.style.display = 'none';
                
                // Manejar indicadores de himno
                mostrarIndicadoresHimno(data.himnoData);
                // Aseguramos que el indicador de vers√≠culo se oculte si no corresponde
                if (!data.himnoData.verso) {
                    indicadorEstrofa.style.display = 'none';
                    indicadorEstrofa.classList.remove('visible');
                }
            } else {
                // Modo vers√≠culo normal
                contenido.classList.remove('modo-himno');
                contenido.classList.add('modo-versiculo');
                
                textoPrincipal.innerHTML = data.texto;
                referencia.textContent = data.ref;
                // Aplicar clase de vers√≠culo b√≠blico si es modo Biblia
                textoPrincipal.classList.add('versiculo-biblia');
                // Si no hay texto ni referencia, ocultar la barra
                if (!data.texto && !data.ref) {
                    referencia.style.display = 'none';
                } else {
                    referencia.style.display = '';
                }
                
                // Ocultar indicadores si no es himno
                contadorSeccion.style.display = 'none';
                indicadorEstrofa.style.display = 'none';
                

            }
        }
        
        // Remover clases de fade-out para mostrar el nuevo texto
        textoPrincipal.classList.remove('fade-out');
        referencia.classList.remove('fade-out');
    }, 150); // La mitad del tiempo de transici√≥n CSS (300ms / 2)
});

socket.on('change_mode', (data) => {
    console.log('üì• Recibido change_mode:', data);
    if (data.videoSrc) {
        try {
            console.log('[VIDEO] Intentando cambiar video de fondo a:', data.videoSrc);
            console.log('[VIDEO] Estado actual del video:', {
                currentSrc: videoBg.currentSrc,
                readyState: videoBg.readyState,
                networkState: videoBg.networkState,
                paused: videoBg.paused,
                ended: videoBg.ended
            });
            
            // Pausar el video actual antes de cambiar
            if (!videoBg.paused) {
                videoBg.pause();
            }
            
            // Eliminar el <source> actual
            while (videoBg.firstChild) {
                console.log('[VIDEO] Eliminando source anterior:', videoBg.firstChild);
                videoBg.removeChild(videoBg.firstChild);
            }
            
            // Crear un nuevo <source> con el src y tipo adecuado
            const newSource = document.createElement('source');
            newSource.src = data.videoSrc;
            // Detectar tipo MIME por extensi√≥n
            if (data.videoSrc.endsWith('.mp4')) {
                newSource.type = 'video/mp4';
            } else if (data.videoSrc.endsWith('.mkv')) {
                newSource.type = 'video/x-matroska';
            } else {
                newSource.type = '';
            }
            console.log('[VIDEO] Nuevo source creado:', newSource);
            videoBg.appendChild(newSource);
            
            // Funci√≥n para cargar y reproducir el video
            const loadAndPlayVideo = () => {
                console.log('[VIDEO] Llamando a videoBg.load()');
                videoBg.load();
                
                // Esperar a que el video est√© listo antes de reproducir
                const playVideo = () => {
                    console.log('[VIDEO] Intentando reproducir video...');
                    console.log('[VIDEO] Estado antes de play:', {
                        readyState: videoBg.readyState,
                        networkState: videoBg.networkState,
                        paused: videoBg.paused
                    });
                    
                    videoBg.play().then(() => {
                        console.log('[VIDEO] ‚úÖ Video reproducido exitosamente');
                    }).catch(e => {
                        console.log('[VIDEO] ‚ùå No se pudo hacer play autom√°ticamente:', e);
                        // Intentar reproducir despu√©s de un delay
                        setTimeout(() => {
                            videoBg.play().catch(e2 => {
                                console.log('[VIDEO] ‚ùå Segundo intento fall√≥:', e2);
                            });
                        }, 1000);
                    });
                };
                
                // Si el video ya est√° listo, reproducir inmediatamente
                if (videoBg.readyState >= 2) {
                    playVideo();
                } else {
                    // Esperar a que el video est√© listo
                    videoBg.addEventListener('canplay', playVideo, { once: true });
                    videoBg.addEventListener('error', (e) => {
                        console.error('[VIDEO] ‚ùå Error al cargar video:', e);
                    }, { once: true });
                }
            };
            
            // Ejecutar la carga y reproducci√≥n
            loadAndPlayVideo();
            
            setTimeout(() => {
                console.log('[VIDEO] Estado final del video:', {
                    currentSrc: videoBg.currentSrc,
                    readyState: videoBg.readyState,
                    networkState: videoBg.networkState,
                    paused: videoBg.paused,
                    ended: videoBg.ended
                });
            }, 1000);
            
        } catch (err) {
            console.error('[VIDEO] Error al cambiar el video de fondo:', err);
        }
    } else {
        console.warn('[VIDEO] No se recibi√≥ data.videoSrc en change_mode');
    }
});

socket.on('config', (data) => {
    console.log('üì• Recibido config:', data);
    console.log('üîç Tipo de data:', typeof data);
    console.log('üîç Data.config existe:', !!data.config);
    console.log('üîç Data completa:', JSON.stringify(data));
    
    // Verificar que los elementos existen antes de procesar
    if (!textoPrincipal) {
        console.error('‚ùå Elemento textoPrincipal no encontrado');
        return;
    }
    if (!referencia) {
        console.error('‚ùå Elemento referencia no encontrado');
        return;
    }
    
    if (data.config) {
        console.log('üîç Configuraci√≥n recibida:', data.config);
        
        // Aplicar tama√±o de fuente al texto principal
        const fontSize = data.config.fontsize || 5;
        console.log('üî§ Aplicando tama√±o de fuente:', fontSize + 'vw');
        
        // Estrategia 1: Usar CSS custom properties
        textoPrincipal.style.setProperty('--override-font-size', fontSize + 'vw');
        textoPrincipal.classList.add('override-font-size');
        
        const refFontSize = (fontSize * 0.7);
        referencia.style.setProperty('--override-ref-font-size', refFontSize + 'vw');
        referencia.classList.add('override-font-size');
        
        // Estrategia 2: Tambi√©n aplicar estilos inline como respaldo
        textoPrincipal.style.fontSize = fontSize + 'vw';
        referencia.style.fontSize = refFontSize + 'vw';
        
        console.log('üî§ Tama√±o de fuente aplicado:', fontSize + 'vw');
        
        // Verificar que el estilo se aplic√≥
        const computedStyle = window.getComputedStyle(textoPrincipal);
        console.log('üîç Tama√±o de fuente computado:', computedStyle.fontSize);
        
        console.log('üî§ Tama√±o de referencia aplicado:', refFontSize + 'vw');
        
        // Verificar que el estilo se aplic√≥
        const refComputedStyle = window.getComputedStyle(referencia);
        console.log('üîç Tama√±o de referencia computado:', refComputedStyle.fontSize);
        
    } else {
        console.warn('‚ö†Ô∏è No se recibi√≥ data.config en el mensaje config');
        console.log('üîç Intentando procesar data directamente...');
        
        // Intentar procesar data directamente si no tiene la estructura esperada
        if (data.fontsize) {
            console.log('üîç Procesando data directa con fontsize:', data.fontsize);
            const fontSize = data.fontsize;
            
            // Estrategia 1: Usar CSS custom properties
            textoPrincipal.style.setProperty('--override-font-size', fontSize + 'vw');
            textoPrincipal.classList.add('override-font-size');
            
            const refFontSize = (fontSize * 0.7);
            referencia.style.setProperty('--override-ref-font-size', refFontSize + 'vw');
            referencia.classList.add('override-font-size');
            
            // Estrategia 2: Tambi√©n aplicar estilos inline como respaldo
            textoPrincipal.style.fontSize = fontSize + 'vw';
            referencia.style.fontSize = refFontSize + 'vw';
            
            // Verificar inmediatamente despu√©s de aplicar
            setTimeout(() => {
                const computedPrincipal = window.getComputedStyle(textoPrincipal);
                const computedRef = window.getComputedStyle(referencia);
                console.log('üîç Verificaci√≥n de estilos aplicados:', {
                    fontSizeSolicitado: fontSize + 'vw',
                    fontSizeAplicado: computedPrincipal.fontSize,
                    refFontSizeSolicitado: refFontSize + 'vw',
                    refFontSizeAplicado: computedRef.fontSize,
                    styleInline: textoPrincipal.style.fontSize,
                    refStyleInline: referencia.style.fontSize,
                    customProperty: textoPrincipal.style.getPropertyValue('--override-font-size'),
                    refCustomProperty: referencia.style.getPropertyValue('--override-ref-font-size')
                });
            }, 100);
            
            console.log('‚úÖ Estilos aplicados desde data directa');
        }
    }
});

socket.on('reproducirAudio', (data) => {
    console.log('üì• Recibido reproducirAudio:', data);
    reproducirAudioHimno(data.ruta, data.himno, data.titulo);
});

socket.on('detenerAudio', (data) => {
    console.log('üì• Recibido detenerAudio:', data);
    detenerAudioHimno(data.fadeout, data.duracion);
});

/**
 * Muestra los indicadores espec√≠ficos para himnos
 * @param {Object} himnoData - Datos del himno { esTitulo, numero, titulo, verso, estrofaIndex, totalEstrofas, seccionActual, totalSecciones }
 */
function mostrarIndicadoresHimno(himnoData) {
    if (himnoData.esTitulo) {
        // Es el t√≠tulo del himno - mostrar formato especial
        textoPrincipal.classList.add('titulo-himno');
        textoPrincipal.innerHTML = `${himnoData.numero} | ${himnoData.titulo}`;
        
        // Ocultar indicadores
        contadorSeccion.style.display = 'none';
        indicadorEstrofa.style.display = 'none';
    } else {
        // Es una estrofa - mostrar indicadores
        textoPrincipal.classList.remove('titulo-himno');
        
        // Mostrar contador de secci√≥n
        if (himnoData.seccionActual !== undefined && himnoData.totalSecciones !== undefined) {
            contadorSeccion.textContent = `${himnoData.seccionActual}/${himnoData.totalSecciones}`;
            contadorSeccion.style.display = '';
            contadorSeccion.classList.add('visible');
        } else {
            contadorSeccion.style.display = 'none';
        }
        
        // Mostrar indicador de estrofa SOLO si corresponde a himno (puede ser √∫til para "Coro" o versos)
        if (himnoData.verso === 'coro') {
            indicadorEstrofa.textContent = 'Coro';
            indicadorEstrofa.style.display = '';
            indicadorEstrofa.classList.add('visible');
        } else if (himnoData.verso) {
            indicadorEstrofa.textContent = `Verso ${himnoData.verso}`;
            indicadorEstrofa.style.display = '';
            indicadorEstrofa.classList.add('visible');
        } else {
            // Si no hay verso, ocultar
            indicadorEstrofa.style.display = 'none';
            indicadorEstrofa.classList.remove('visible');
        }
    }
}

/**
 * Reproduce el audio de un himno
 * @param {string} ruta - Ruta del archivo de audio
 * @param {string} himno - N√∫mero del himno
 * @param {string} titulo - T√≠tulo del himno
 */
function reproducirAudioHimno(ruta, himno, titulo) {
    try {
        console.log('üéµ Reproduciendo audio:', { ruta, himno, titulo });
        
        // Crear elemento de audio si no existe
        if (!audioElement) {
            audioElement = new Audio();
            audioElement.preload = 'auto';
            
            // Eventos del audio
            audioElement.addEventListener('loadstart', () => {
                console.log('üîÑ Cargando audio...');
            });
            
            audioElement.addEventListener('canplay', () => {
                console.log('‚úÖ Audio listo para reproducir');
            });
            
            audioElement.addEventListener('play', () => {
                console.log('‚ñ∂Ô∏è Audio reproduci√©ndose');
            });
            
            audioElement.addEventListener('error', (e) => {
                console.error('‚ùå Error al reproducir audio:', e);
                console.error('üîç Detalles del error:', audioElement.error);
                console.error('üîç C√≥digo de error:', audioElement.error ? audioElement.error.code : 'N/A');
                console.error('üîç Mensaje de error:', audioElement.error ? audioElement.error.message : 'N/A');
                
                // Mostrar mensaje de error m√°s detallado
                let errorMsg = 'Error al reproducir audio';
                if (audioElement.error) {
                    switch(audioElement.error.code) {
                        case 1:
                            errorMsg = 'Error: Archivo de audio no encontrado';
                            break;
                        case 2:
                            errorMsg = 'Error: Red no disponible';
                            break;
                        case 3:
                            errorMsg = 'Error: Formato de audio no soportado';
                            break;
                        case 4:
                            errorMsg = 'Error: Archivo de audio corrupto';
                            break;
                        default:
                            errorMsg = `Error: ${audioElement.error.message}`;
                    }
                }
                textoPrincipal.innerHTML = `${errorMsg}<br><small>${ruta}</small>`;
            });
            
            audioElement.addEventListener('ended', () => {
                console.log('‚èπÔ∏è Audio terminado');
                // Notificar al panel de control que el audio termin√≥
                socket.emit('audioTerminado', {
                    himno: himnoActivo ? himnoActivo.numero : 'desconocido'
                });
            });
            
            audioElement.addEventListener('load', () => {
                console.log('üì¶ Audio cargado completamente');
            });
            
            audioElement.addEventListener('canplaythrough', () => {
                console.log('üéØ Audio puede reproducirse completamente');
            });
        }
        
        // Detener audio anterior si est√° reproduci√©ndose
        if (!audioElement.paused) {
            audioElement.pause();
            audioElement.currentTime = 0;
        }
        
        // Configurar y reproducir el nuevo audio
        audioElement.src = ruta;
        audioElement.volume = 1.0;
        
        // Verificar si el archivo existe antes de intentar reproducir
        fetch(ruta, { method: 'HEAD' })
            .then(response => {
                if (response.ok) {
                    console.log('‚úÖ Archivo de audio encontrado, intentando reproducir...');
                    
                    // Funci√≥n para intentar reproducir el audio
                    const attemptPlay = () => {
                        const playPromise = audioElement.play();
                        
                        if (playPromise !== undefined) {
                            playPromise
                                .then(() => {
                                    console.log('‚úÖ Audio iniciado correctamente');
                                })
                                .catch(error => {
                                    console.error('‚ùå Error al iniciar audio:', error);
                                    console.error('üîç Tipo de error:', error.name);
                                    console.error('üîç Mensaje:', error.message);
                                    
                                    // Si el error es por permisos de audio, intentar habilitarlo
                                    if (error.name === 'NotAllowedError' || error.name === 'NotSupportedError') {
                                        console.log('üîÑ Intentando habilitar contexto de audio...');
                                        
                                        // Intentar habilitar el contexto de audio
                                        if (window.enableAudioContext) {
                                            window.enableAudioContext()
                                                .then(() => {
                                                    console.log('‚úÖ Contexto de audio habilitado, reintentando reproducci√≥n...');
                                                    // Reintentar reproducci√≥n despu√©s de un breve delay
                                                    setTimeout(() => {
                                                        attemptPlay();
                                                    }, 100);
                                                })
                                                .catch(enableError => {
                                                    console.error('‚ùå No se pudo habilitar el contexto de audio:', enableError);
                                                    textoPrincipal.innerHTML = `Error: Permisos de audio denegados.<br><small>Haga clic en la p√°gina para habilitar audio.</small><br><small>${ruta}</small>`;
                                                });
                                        } else {
                                            textoPrincipal.innerHTML = `Error: Permisos de audio denegados.<br><small>Haga clic en la p√°gina para habilitar audio.</small><br><small>${ruta}</small>`;
                                        }
                                    } else {
                                        // Mostrar mensaje de error espec√≠fico
                                        let errorMsg = 'No se pudo reproducir el audio';
                                        if (error.name === 'NotAllowedError') {
                                            errorMsg = 'Error: Permisos de audio denegados. Haga clic en la p√°gina para habilitar audio.';
                                        } else if (error.name === 'NotSupportedError') {
                                            errorMsg = 'Error: Formato de audio no soportado';
                                        }
                                        
                                        textoPrincipal.innerHTML = `${errorMsg}<br><small>${ruta}</small>`;
                                    }
                                });
                        }
                    };
                    
                    // Intentar reproducir
                    attemptPlay();
                    
                } else {
                    console.error('‚ùå Archivo de audio no encontrado:', ruta);
                    textoPrincipal.innerHTML = `Error: Archivo de audio no encontrado<br><small>${ruta}</small>`;
                }
            })
            .catch(error => {
                console.error('‚ùå Error al verificar archivo de audio:', error);
                textoPrincipal.innerHTML = `Error: No se pudo acceder al archivo de audio<br><small>${ruta}</small>`;
            });
        
    } catch (error) {
        console.error('‚ùå Error en reproducirAudioHimno:', error);
        textoPrincipal.innerHTML = `Error: ${error.message}<br><small>${ruta}</small>`;
    }
}

/**
 * Detiene el audio de un himno con fadeout opcional
 * @param {boolean} fadeout - Si debe hacer fadeout antes de detener
 * @param {number} duracion - Duraci√≥n del fadeout en milisegundos
 */
function detenerAudioHimno(fadeout = true, duracion = 2000) {
    try {
        console.log('‚èπÔ∏è Deteniendo audio:', { fadeout, duracion });
        
        if (!audioElement) {
            console.log('‚ÑπÔ∏è No hay audio reproduci√©ndose');
            return;
        }
        
        if (audioElement.paused) {
            console.log('‚ÑπÔ∏è Audio ya est√° pausado');
            return;
        }
        
        if (fadeout) {
            // Hacer fadeout gradual
            console.log('üîâ Iniciando fadeout...');
            
            const volumenInicial = audioElement.volume;
            const pasos = 20; // N√∫mero de pasos para el fadeout
            const volumenPorPaso = volumenInicial / pasos;
            const intervalo = duracion / pasos;
            
            let pasoActual = 0;
            
            const fadeoutInterval = setInterval(() => {
                pasoActual++;
                const nuevoVolumen = Math.max(0, volumenInicial - (volumenPorPaso * pasoActual));
                
                audioElement.volume = nuevoVolumen;
                console.log(`üîâ Fadeout paso ${pasoActual}/${pasos}, volumen: ${nuevoVolumen.toFixed(2)}`);
                
                if (pasoActual >= pasos || nuevoVolumen <= 0) {
                    clearInterval(fadeoutInterval);
                    
                    // Detener completamente el audio
                    audioElement.pause();
                    audioElement.currentTime = 0;
                    audioElement.volume = 1.0; // Restaurar volumen para futuras reproducciones
                    
                    console.log('‚èπÔ∏è Audio detenido completamente despu√©s del fadeout');
                    
                    // Notificar al panel de control que el audio termin√≥
                    socket.emit('audioTerminado', {
                        himno: 'detenido_por_usuario'
                    });
                }
            }, intervalo);
            
        } else {
            // Detener inmediatamente
            audioElement.pause();
            audioElement.currentTime = 0;
            console.log('‚èπÔ∏è Audio detenido inmediatamente');
            
            // Notificar al panel de control que el audio termin√≥
            socket.emit('audioTerminado', {
                himno: 'detenido_por_usuario'
            });
        }
        
    } catch (error) {
        console.error('‚ùå Error en detenerAudioHimno:', error);
    }
}

// Funci√≥n para enviar la relaci√≥n de aspecto al panel de control
function enviarRelacionAspecto() {
    const width = window.innerWidth;
    const height = window.innerHeight;
    const aspect = width / height;
    socket.emit('aspect_ratio', { width, height, aspect });
    console.log('üì§ Enviando relaci√≥n de aspecto:', { width, height, aspect });
}

// Enviar al cargar
window.addEventListener('DOMContentLoaded', enviarRelacionAspecto);
// Enviar al cambiar tama√±o
window.addEventListener('resize', enviarRelacionAspecto);

document.addEventListener('click', function() {
    socket.emit('proyectorClick');
});




// church_display/src\proyector.html
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Proyector</title>
    <link rel="stylesheet" href="/css/proyector.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.1/socket.io.min.js"></script>
    <style>
        /* Estilos para el bot√≥n de habilitaci√≥n de audio */
        #audio-enabler {
            position: fixed;
            top: -100px;
            left: -100px;
            width: 1px;
            height: 1px;
            opacity: 0;
            pointer-events: none;
            z-index: -1;
        }
        
        #audio-status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
            display: none;
        }
        
        #audio-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #d32f2f; /* rojo por defecto */
            box-shadow: 0 0 12px 2px rgba(0,0,0,0.5);
            z-index: 9999;
            border: 3px solid #111;
            display: none;
            transition: background 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }
        #audio-indicator.enabled {
            background: #43a047; /* verde */
            box-shadow: 0 0 16px 4px rgba(67,160,71,0.6);
        }
        #audio-indicator::after {
            content: attr(data-tooltip);
            position: absolute;
            top: 110%;
            right: 50%;
            transform: translateX(50%);
            background: #222;
            color: #fff;
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 13px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }
        #audio-indicator:hover::after {
            opacity: 1;
        }
        
        /* C√≠rculo rojo en esquina superior derecha */
        #circulo-indicador {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff0000; /* rojo */
            box-shadow: 0 0 8px 2px rgba(255,0,0,0.4);
            z-index: 99999; /* z-index m√°s alto posible */
            border: 1px solid #ffffff;
            transition: all 0.3s ease;
            display: block;
        }
        
        #circulo-indicador.verde {
            background: #00ff00; /* verde */
            box-shadow: 0 0 12px 3px rgba(0,255,0,0.6);
        }
        
        #circulo-indicador.oculto {
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <video autoplay muted loop id="video-bg">
        <source src="/src/assets/videos/verso-bg.mp4" type="video/mp4">
        <!-- El src se cambiar√° con JS -->
    </video>
    
    <!-- Bot√≥n invisible para habilitar audio -->
    <button id="audio-enabler" type="button">Habilitar Audio</button>
    
    <!-- Indicador de estado del audio -->
    <div id="audio-status">Audio: Deshabilitado</div>
    
    <!-- Indicador de audio -->
    <div id="audio-indicator" data-tooltip="Haz clic para habilitar el audio"></div>
    
    <!-- C√≠rculo indicador en esquina superior derecha -->
    <div id="circulo-indicador"></div>
    
    <div id="contenido">
        <!-- Contador de secci√≥n (arriba a la derecha) -->
        <div id="contador-seccion"></div>
        
        <!-- Indicador de estrofa (centrado arriba) -->
        <div id="indicador-estrofa"></div>
        
        <p id="texto-principal"></p>
        <footer id="referencia"></footer>
    </div>
    
    <!-- Script para habilitar audio autom√°ticamente -->
    <script>
        // Variable global para el estado del audio
        window.audioEnabled = false;
        const audioStatus = document.getElementById('audio-status');
        const audioEnabler = document.getElementById('audio-enabler');
        const audioIndicator = document.getElementById('audio-indicator');
        
        // Funci√≥n para actualizar el indicador de estado
        function updateAudioStatus(enabled) {
            window.audioEnabled = enabled;
            audioStatus.textContent = `Audio: ${enabled ? 'Habilitado' : 'Deshabilitado'}`;
            audioStatus.style.display = 'block';
            audioStatus.style.background = enabled ? 'rgba(0,255,0,0.7)' : 'rgba(255,0,0,0.7)';
            
            // Ocultar el indicador despu√©s de 3 segundos si est√° habilitado
            if (enabled) {
                setTimeout(() => {
                    audioStatus.style.display = 'none';
                }, 3000);
            }
        }
        
        function showAudioIndicator(enabled) {
            if (enabled) {
                audioIndicator.classList.add('enabled');
                audioIndicator.setAttribute('data-tooltip', 'Audio habilitado');
                audioIndicator.style.display = 'block';
                setTimeout(() => {
                    audioIndicator.style.display = 'none';
                }, 2500);
            } else {
                audioIndicator.classList.remove('enabled');
                audioIndicator.setAttribute('data-tooltip', 'Haz clic para habilitar el audio');
                audioIndicator.style.display = 'block';
            }
        }
        
        // Funci√≥n para habilitar el contexto de audio
        function enableAudioContext() {
            if (window.audioEnabled) return Promise.resolve();
            
            return new Promise((resolve, reject) => {
                try {
                    // Estrategia 1: Crear un audio temporal y reproducirlo
                    const tempAudio = new Audio();
                    tempAudio.volume = 0;
                    
                    // Estrategia 2: Usar Web Audio API si est√° disponible
                    let audioContext = null;
                    if (window.AudioContext || window.webkitAudioContext) {
                        try {
                            audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        } catch (e) {
                            console.log('Web Audio API no disponible:', e);
                        }
                    }
                    
                    // Intentar reproducir el audio temporal
                    const playPromise = tempAudio.play();
                    
                    if (playPromise !== undefined) {
                        playPromise
                            .then(() => {
                                console.log('‚úÖ Audio habilitado exitosamente');
                                updateAudioStatus(true);
                                showAudioIndicator(true);
                                
                                // Si tenemos AudioContext, tambi√©n lo resumimos
                                if (audioContext && audioContext.state === 'suspended') {
                                    audioContext.resume();
                                }
                                
                                resolve();
                            })
                            .catch(error => {
                                console.log('‚ö†Ô∏è No se pudo habilitar audio autom√°ticamente:', error);
                                
                                // Estrategia 3: Intentar con AudioContext
                                if (audioContext && audioContext.state === 'suspended') {
                                    audioContext.resume().then(() => {
                                        console.log('‚úÖ Audio habilitado via AudioContext');
                                        updateAudioStatus(true);
                                        showAudioIndicator(true);
                                        resolve();
                                    }).catch(reject);
                                } else {
                                    updateAudioStatus(false);
                                    showAudioIndicator(false);
                                    reject(error);
                                }
                            });
                    } else {
                        // Fallback para navegadores m√°s antiguos
                        console.log('‚ÑπÔ∏è Navegador no soporta play() promise');
                        updateAudioStatus(true);
                        showAudioIndicator(true);
                        resolve();
                    }
                } catch (error) {
                    console.error('‚ùå Error al habilitar audio:', error);
                    updateAudioStatus(false);
                    showAudioIndicator(false);
                    reject(error);
                }
            });
        }
        
        // Habilitar audio al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Intentando habilitar audio autom√°ticamente...');
            
            // Intentar habilitar audio inmediatamente
            enableAudioContext().catch(() => {
                console.log('‚ÑπÔ∏è Audio no se pudo habilitar autom√°ticamente');
            });
            
            // Tambi√©n intentar cuando el usuario interact√∫e con la p√°gina
            const enableOnInteraction = () => {
                enableAudioContext().then(() => {
                    // Remover los event listeners una vez que el audio est√© habilitado
                    document.removeEventListener('click', enableOnInteraction);
                    document.removeEventListener('keydown', enableOnInteraction);
                    document.removeEventListener('touchstart', enableOnInteraction);
                }).catch(() => {
                    // Si falla, mantener los listeners activos
                });
            };
            
            document.addEventListener('click', enableOnInteraction);
            document.addEventListener('keydown', enableOnInteraction);
            document.addEventListener('touchstart', enableOnInteraction);
        });
        
        // Habilitar audio al hacer clic en cualquier parte de la p√°gina
        document.addEventListener('click', function() {
            if (!window.audioEnabled) {
                enableAudioContext().catch(() => {
                    console.log('‚ÑπÔ∏è Audio ya habilitado o no disponible');
                });
            }
        }, { once: false });
        
        // Exponer la funci√≥n globalmente para que pueda ser usada desde proyector.js
        window.enableAudioContext = enableAudioContext;
    </script>
    
    <!-- Script para el c√≠rculo indicador -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const circuloIndicador = document.getElementById('circulo-indicador');
            
            // Funci√≥n para manejar el clic en cualquier parte de la pantalla
            function manejarClicPantalla() {
                // Cambiar a verde
                circuloIndicador.classList.add('verde');
                
                // Eliminar el elemento del DOM despu√©s de 3 segundos
                setTimeout(() => {
                    circuloIndicador.remove();
                }, 3000);
            }
            
            // Agregar event listener para el clic en cualquier parte de la pantalla
            document.addEventListener('click', manejarClicPantalla);
        });
    </script>
    
    <script src="/src/js/proyector.js"></script>
    
    <!-- Script de prueba de configuraci√≥n -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Eliminar botones de prueba
        });
    </script>
</body>
</html>



